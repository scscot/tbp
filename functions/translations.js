const translations = {
  en: {
    milestoneDirectTitle: "ðŸŽ‰ Amazing Progress!",
    milestoneDirectMessage: "Congratulations, {firstName}! You've reached {directCount} direct sponsors! Just {remainingTeam} more team member{pluralTeam} needed to unlock your {bizName} invitation. Keep building!",
    milestoneTeamTitle: "ðŸš€ Incredible Growth!",
    milestoneTeamMessage: "Amazing progress, {firstName}! You've built a team of {teamCount}! Just {remainingDirect} more direct sponsor{pluralDirect} needed to qualify for {bizName}. You're so close!",

    subscriptionActiveTitle: "âœ… Subscription Active",
    subscriptionActiveMessage: "Your subscription is now active until {expiryDate}.",
    subscriptionCancelledTitle: "âš ï¸ Subscription Cancelled",
    subscriptionCancelledMessage: "Your subscription has been cancelled but remains active until {expiryDate}.",
    subscriptionExpiredTitle: "âŒ Subscription Expired",
    subscriptionExpiredMessage: "Your subscription has expired. Renew now to keep building your team and accessing all recruiting tools.",
    subscriptionExpiringSoonTitle: "â° Subscription Expiring Soon",
    subscriptionExpiringSoonMessage: "Your subscription expires on {expiryDate}. Renew now to avoid interruption.",
    subscriptionPausedTitle: "â¸ï¸ Subscription Paused",
    subscriptionPausedMessage: "Your subscription has been paused. Resume in the App Store to restore access to all features.",
    subscriptionPaymentIssueTitle: "âš ï¸ Payment Issue",
    subscriptionPaymentIssueMessage: "Your subscription is on hold due to a payment issue. Please update your payment method in the App Store.",

    chatMessageTitle: "New Message from {senderName}",
    teamActivityTitle: "ðŸ‘€ Team Member Activity",
    teamActivityMessage: "{firstName} {lastName} from your team visited their {bizName} link!",
    bizOppCompletionTitle: "ðŸŽ‰ Team Member Joined {bizName}!",
    bizOppCompletionMessage: "{firstName} {lastName} completed their {bizName} registration! Welcome them to the opportunity and help them get started.",
  },

  es: {
    milestoneDirectTitle: "ðŸŽ‰ Â¡Progreso IncreÃ­ble!",
    milestoneDirectMessage: "Â¡Felicidades, {firstName}! Â¡Has alcanzado {directCount} patrocinadores directos! Solo {remainingTeam} miembro{pluralTeam} mÃ¡s del equipo necesario para desbloquear tu invitaciÃ³n a {bizName}. Â¡Sigue construyendo!",
    milestoneTeamTitle: "ðŸš€ Â¡Crecimiento IncreÃ­ble!",
    milestoneTeamMessage: "Â¡Progreso asombroso, {firstName}! Â¡Has construido un equipo de {teamCount}! Solo {remainingDirect} patrocinador{pluralDirect} directo mÃ¡s necesario para calificar para {bizName}. Â¡EstÃ¡s muy cerca!",

    subscriptionActiveTitle: "âœ… SuscripciÃ³n Activa",
    subscriptionActiveMessage: "Tu suscripciÃ³n estÃ¡ ahora activa hasta {expiryDate}.",
    subscriptionCancelledTitle: "âš ï¸ SuscripciÃ³n Cancelada",
    subscriptionCancelledMessage: "Tu suscripciÃ³n ha sido cancelada pero permanece activa hasta {expiryDate}.",
    subscriptionExpiredTitle: "âŒ SuscripciÃ³n Expirada",
    subscriptionExpiredMessage: "Tu suscripciÃ³n ha expirado. Renueva ahora para seguir construyendo tu equipo y accediendo a todas las herramientas de reclutamiento.",
    subscriptionExpiringSoonTitle: "â° SuscripciÃ³n Por Expirar",
    subscriptionExpiringSoonMessage: "Tu suscripciÃ³n expira el {expiryDate}. Renueva ahora para evitar interrupciones.",
    subscriptionPausedTitle: "â¸ï¸ SuscripciÃ³n Pausada",
    subscriptionPausedMessage: "Tu suscripciÃ³n ha sido pausada. Reanuda en el App Store para restaurar el acceso a todas las funciones.",
    subscriptionPaymentIssueTitle: "âš ï¸ Problema de Pago",
    subscriptionPaymentIssueMessage: "Tu suscripciÃ³n estÃ¡ en espera debido a un problema de pago. Por favor actualiza tu mÃ©todo de pago en el App Store.",

    chatMessageTitle: "Nuevo Mensaje de {senderName}",
    teamActivityTitle: "ðŸ‘€ Actividad del Miembro del Equipo",
    teamActivityMessage: "Â¡{firstName} {lastName} de tu equipo visitÃ³ su enlace de {bizName}!",
    bizOppCompletionTitle: "ðŸŽ‰ Â¡Miembro del Equipo se UniÃ³ a {bizName}!",
    bizOppCompletionMessage: "Â¡{firstName} {lastName} completÃ³ su registro en {bizName}! Dales la bienvenida a la oportunidad y ayÃºdales a comenzar.",
  },

  pt: {
    milestoneDirectTitle: "ðŸŽ‰ Progresso IncrÃ­vel!",
    milestoneDirectMessage: "ParabÃ©ns, {firstName}! VocÃª alcanÃ§ou {directCount} patrocinadores diretos! Apenas {remainingTeam} membro{pluralTeam} da equipe necessÃ¡rio para desbloquear seu convite para {bizName}. Continue construindo!",
    milestoneTeamTitle: "ðŸš€ Crescimento IncrÃ­vel!",
    milestoneTeamMessage: "Progresso incrÃ­vel, {firstName}! VocÃª construiu uma equipe de {teamCount}! Apenas {remainingDirect} patrocinador{pluralDirect} direto necessÃ¡rio para se qualificar para {bizName}. VocÃª estÃ¡ muito perto!",

    subscriptionActiveTitle: "âœ… Assinatura Ativa",
    subscriptionActiveMessage: "Sua assinatura estÃ¡ ativa atÃ© {expiryDate}.",
    subscriptionCancelledTitle: "âš ï¸ Assinatura Cancelada",
    subscriptionCancelledMessage: "Sua assinatura foi cancelada, mas permanece ativa atÃ© {expiryDate}.",
    subscriptionExpiredTitle: "âŒ Assinatura Expirada",
    subscriptionExpiredMessage: "Sua assinatura expirou. Renove agora para continuar construindo sua equipe e acessando todas as ferramentas de recrutamento.",
    subscriptionExpiringSoonTitle: "â° Assinatura Expirando Em Breve",
    subscriptionExpiringSoonMessage: "Sua assinatura expira em {expiryDate}. Renove agora para evitar interrupÃ§Ãµes.",
    subscriptionPausedTitle: "â¸ï¸ Assinatura Pausada",
    subscriptionPausedMessage: "Sua assinatura foi pausada. Retome na App Store para restaurar o acesso a todos os recursos.",
    subscriptionPaymentIssueTitle: "âš ï¸ Problema de Pagamento",
    subscriptionPaymentIssueMessage: "Sua assinatura estÃ¡ em espera devido a um problema de pagamento. Por favor, atualize seu mÃ©todo de pagamento na App Store.",

    chatMessageTitle: "Nova Mensagem de {senderName}",
    teamActivityTitle: "ðŸ‘€ Atividade do Membro da Equipe",
    teamActivityMessage: "{firstName} {lastName} da sua equipe visitou o link de {bizName}!",
    bizOppCompletionTitle: "ðŸŽ‰ Membro da Equipe Entrou em {bizName}!",
    bizOppCompletionMessage: "{firstName} {lastName} completou o registro em {bizName}! DÃª as boas-vindas Ã  oportunidade e ajude-os a comeÃ§ar.",
  },

  de: {
    milestoneDirectTitle: "ðŸŽ‰ Erstaunlicher Fortschritt!",
    milestoneDirectMessage: "Herzlichen GlÃ¼ckwunsch, {firstName}! Sie haben {directCount} direkte Sponsoren erreicht! Nur noch {remainingTeam} Teammitglied{pluralTeam} benÃ¶tigt, um Ihre {bizName}-Einladung freizuschalten. Machen Sie weiter!",
    milestoneTeamTitle: "ðŸš€ Unglaubliches Wachstum!",
    milestoneTeamMessage: "Erstaunlicher Fortschritt, {firstName}! Sie haben ein Team von {teamCount} aufgebaut! Nur noch {remainingDirect} direkter Sponsor{pluralDirect} benÃ¶tigt, um sich fÃ¼r {bizName} zu qualifizieren. Sie sind so nah dran!",

    subscriptionActiveTitle: "âœ… Abonnement Aktiv",
    subscriptionActiveMessage: "Ihr Abonnement ist jetzt bis {expiryDate} aktiv.",
    subscriptionCancelledTitle: "âš ï¸ Abonnement GekÃ¼ndigt",
    subscriptionCancelledMessage: "Ihr Abonnement wurde gekÃ¼ndigt, bleibt aber bis {expiryDate} aktiv.",
    subscriptionExpiredTitle: "âŒ Abonnement Abgelaufen",
    subscriptionExpiredMessage: "Ihr Abonnement ist abgelaufen. Erneuern Sie jetzt, um Ihr Team weiter aufzubauen und auf alle Recruiting-Tools zuzugreifen.",
    subscriptionExpiringSoonTitle: "â° Abonnement LÃ¤uft Bald Ab",
    subscriptionExpiringSoonMessage: "Ihr Abonnement lÃ¤uft am {expiryDate} ab. Erneuern Sie jetzt, um Unterbrechungen zu vermeiden.",
    subscriptionPausedTitle: "â¸ï¸ Abonnement Pausiert",
    subscriptionPausedMessage: "Ihr Abonnement wurde pausiert. Setzen Sie es im App Store fort, um den Zugriff auf alle Funktionen wiederherzustellen.",
    subscriptionPaymentIssueTitle: "âš ï¸ Zahlungsproblem",
    subscriptionPaymentIssueMessage: "Ihr Abonnement ist aufgrund eines Zahlungsproblems gesperrt. Bitte aktualisieren Sie Ihre Zahlungsmethode im App Store.",

    chatMessageTitle: "Neue Nachricht von {senderName}",
    teamActivityTitle: "ðŸ‘€ Teammitglied-AktivitÃ¤t",
    teamActivityMessage: "{firstName} {lastName} aus Ihrem Team hat ihren {bizName}-Link besucht!",
    bizOppCompletionTitle: "ðŸŽ‰ Teammitglied ist {bizName} beigetreten!",
    bizOppCompletionMessage: "{firstName} {lastName} hat die {bizName}-Registrierung abgeschlossen! HeiÃŸen Sie sie in der Gelegenheit willkommen und helfen Sie ihnen beim Einstieg.",
  },
};

function getTranslation(key, lang = 'en', params = {}) {
  const langCode = normalizeLanguageCode(lang);
  const langTranslations = translations[langCode] || translations.en;
  let text = langTranslations[key] || translations.en[key] || key;

  Object.keys(params).forEach(paramKey => {
    const placeholder = `{${paramKey}}`;
    text = text.replace(new RegExp(placeholder, 'g'), params[paramKey]);
  });

  return text;
}

function normalizeLanguageCode(lang) {
  if (!lang) return 'en';

  const code = lang.toLowerCase().split(/[-_]/)[0];

  const validLanguages = ['en', 'es', 'pt', 'de'];
  return validLanguages.includes(code) ? code : 'en';
}

function getNotificationText(key, lang, params = {}) {
  return getTranslation(key, lang, params);
}

module.exports = {
  getTranslation,
  getNotificationText,
  normalizeLanguageCode,
  translations,
};
