<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Build Pro | AI-driven direct sales team building.</title>
    <meta name="description" content="Help recruiting prospects build momentum before Day 1 and empower existing team members to accelerate their growth. Works with your existing business.">
    <meta name="keywords" content="direct sales,ai recruiting,prospecting,team building,ai coaching,network marketing,downline,contacts">
    <meta name="author" content="Team Build Pro">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Team Build Pro | Recruit Better. Build Faster.">
    <meta property="og:description" content="AI-driven direct sales team building.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://teambuildpro.com">
    <meta property="og:image" content="https://teambuildpro.com/assets/icons/team-build-pro.png">
    <meta property="og:site_name" content="Team Build Pro">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Team Build Pro">
    <meta name="twitter:description" content="AI-driven direct sales team building.">
    <meta name="twitter:image" content="https://teambuildpro.com/assets/icons/team-build-pro.png">
    <meta name="twitter:site" content="@teambuildpro">
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Google Material Symbols (for consistent icons) -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Favicon -->
    <link rel="icon" href="assets/icons/team-build-pro.png" type="image/png" />
    <!-- Apple Touch Icon for Universal Links -->
    <link rel="apple-touch-icon" href="assets/icons/team-build-pro.png" />
    <link rel="stylesheet" href="css/style.css?v=2" />
    <link rel="stylesheet" href="css/downline-animation.css" />

    <!-- reCAPTCHA Enterprise Script -->
    <script
        src="https://www.google.com/recaptcha/enterprise.js?render=6Lfwj5orAAAAADS--lFfBYWuz1b4LiQVUlOHZiyE"></script>

    <!-- All styles consolidated in external CSS file -->
</head>

<body>
    <!-- Top Invite Bar (populated by JavaScript when referral exists) -->
    <div id="top-invite-bar" class="top-invite-bar"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <a href="https://teambuildpro.com" class="logo">
                <img src="assets/icons/team-build-pro.png" alt="Team Build Pro" style="width: 32px; height: 32px; border-radius: 50%;">
                <span>Team Build Pro</span>
            </a>
            <!-- Sandwich Menu Button -->
            <button id="menu-btn" class="menu-btn" aria-label="Open menu" aria-haspopup="true" aria-expanded="false">
                <span class="material-symbols-outlined">menu</span>
            </button>
            <!-- Dropdown Menu -->
            <div id="mobile-menu" class="mobile-menu" role="menu">
                <a href="#screenshots" role="menuitem">Screenshots</a>
                <a href="#pricing" role="menuitem">Pricing</a>
                <a href="/faq.html" role="menuitem">FAQ</a>
                <a href="/contact_us.html" role="menuitem">Contact Us</a>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero gradient-bg">
            <div class="container">
                <div class="hero-content-enhanced">
                    <div id="personal-invite-container"></div>

                    <!-- Trust badge row -->
                    <div class="hero-trust">
                        <span class="platform-badge" aria-label="Compatibility badge">
                            Recruit Better. Build Faster.
                        </span>
                    </div>

                    <h1 id="hero-headline" data-dynamic="hero-headline">
                        AI-Driven Recruiting System for Direct Sales Leaders
                    </h1>

                    <p id="hero-subheadline" data-dynamic="hero-subheadline">
                        Customize Team Build Pro with your company name and link ‚Äî an AI-powered recruiting companion your prospects will love.
                    </p>

                    <p class="ai-proof-microcopy" id="ai-proof-text" data-dynamic="ai-proof-text">
                        Drafts your messages ‚Ä¢ Times your follow-ups ‚Ä¢ Tracks momentum ‚Ä¢ Coaches every prospect
                    </p>

                    <p class="hero-promise" id="hero-promise" data-dynamic="hero-promise">
                        Stand out as a sponsor. Give your prospects a real system that builds momentum.
                    </p>

                    <p class="bridge-text reveal-on-scroll" id="bridge-text" data-dynamic="bridge-text" style="display: none;">
                        When you join your sponsor, you'll already have the same AI tools they use to grow and duplicate success.
                    </p>
                    <!-- Early Adopter badges (hidden when all spots claimed) -->
                    <div id="early-adopter-badges" class="hero-early-adopter-badges" style="display: none;">
                        <span class="early-adopter-badge special" aria-label="Early adopter special">
                            üéÅ Early Adopter Special: FREE FOR LIFE!
                        </span>
                        <span class="early-adopter-badge urgency" aria-label="Spots remaining">
                            üî• Only <span id="spots-remaining">--</span> spots remaining
                        </span>
                    </div>

                    <!-- Trial offer badge -->
                    <div class="hero-trial-badge">
                        <span class="trial-badge" aria-label="Trial offer">
                             Free 30-day trial, then only $4.99/mo. Cancel anytime.
                        </span>
                    </div>

                    <div class="hero-buttons">
                        <div class="download-buttons" id="download-container">
                            <!-- Dynamically populated based on device detection -->
                        </div>
                        <div class="secondary-download" id="secondary-container">
                            <!-- Secondary option with smaller styling -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sponsor Benefits Section (AI Recruiting Advantage) -->
        <section class="sponsor-benefits section-gray" id="sponsor-benefits">
            <div class="container">
                <h2 class="reveal-on-scroll">The AI Recruiting Advantage</h2>
                <div class="grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue">
                                <span class="material-symbols-outlined">psychology</span>
                            </div>
                            <h3>AI-Powered Differentiation</h3>
                        </div>
                        <p>Set yourself apart from every competitor. Offer prospects a proven system, not just a pitch.</p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple">
                                <span class="material-symbols-outlined">group_add</span>
                            </div>
                            <h3>Pre-Qualified Leaders</h3>
                        </div>
                        <p>Prospects who pre-build their teams are motivated, vetted, and ready to succeed from Day 1.</p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon green">
                                <span class="material-symbols-outlined">autorenew</span>
                            </div>
                            <h3>AI-Driven Duplication</h3>
                        </div>
                        <p>The system coaches every recruit automatically. Your team culture scales effortlessly.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Prospect Benefits Section (Your Pre-Building Advantage) -->
        <section class="prospect-benefits section-gray" id="prospect-benefits" style="display: none;">
            <div class="container">
                <h2 class="reveal-on-scroll">Your Pre-Building Advantage</h2>
                <div class="grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue">
                                <span class="material-symbols-outlined">rocket_launch</span>
                            </div>
                            <h3>Start Strong from Day 1</h3>
                        </div>
                        <p>Build your team before you officially join. Launch with momentum instead of starting from zero.</p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple">
                                <span class="material-symbols-outlined">psychology</span>
                            </div>
                            <h3>AI Guides Your Every Step</h3>
                        </div>
                        <p>Get personalized coaching on who to contact, what to say, and when to follow up. No guesswork.</p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon green">
                                <span class="material-symbols-outlined">verified</span>
                            </div>
                            <h3>Proven System, Not Empty Promises</h3>
                        </div>
                        <p>Use the same AI tools your sponsor uses. Learn the system before you join, succeed from the start.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Meet AI Coach Section ---->
        <section id="ai-coach" class="section section-white">
            <div class="container">
                <div class="section-header">
                    <h2>Meet AI Coach</h2>
                    <p>Your private coaching companion who knows your team, understands your goals, and guides your next move.
                    </p>
                </div>
        
                <div class="grid grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue"><span class="material-symbols-outlined">psychology</span></div>
                            <h3>Personalized Guidance</h3>
                        </div>
                        <p>Ask anything about your team, strategy, or challenges. Get advice tailored to your specific situation
                            and current progress.
                        </p>
                    </div>
        
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon green"><span class="material-symbols-outlined">route</span></div>
                            <h3>Roadmap Coaching</h3>
                        </div>
                        <p>Understands exactly where you are in your journey and provides step-by-step guidance for your next
                            milestone.</p>
                    </div>
        
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple"><span class="material-symbols-outlined">group</span></div>
                            <h3>Team-Specific Insights</h3>
                        </div>
                        <p>Knows your team members, their progress, and their needs. Get coaching on specific people and
                            situations in real-time.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Industry Challenge Section (Original - Hidden) -->
        <section id="industry-challenge-old" class="section section-gray" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2>The Direct Sales Reality</h2>
                    <p>
                        Industry data reveals a consistent pattern: people struggle not because they lack ability, but because they lack the right system.
                    </p>
                </div>
                <div class="grid grid-2">
                    <div class="challenge-stats">
                        <div class="stat-card reveal-on-scroll">
                            <div class="stat-number">90%</div>
                            <div class="stat-label">struggle with recruiting new team members</div>
                        </div>
                        <div class="stat-card reveal-on-scroll" style="display: none;">
                        <div class="stat-number">#1</div>
                        <div class="stat-label">challenge is consistent team building</div>
                        </div>
                    </div>
                    <div class="solution-content">
                        <h3>Why 90% Struggle</h3>
                        <p>Too many talented professionals are handed an opportunity, but no blueprint. They're essentially starting a race from a standstill, struggling to gain the crucial momentum they need to succeed and avoid frustration.</p>

                        <h4>Team Build Pro Changes This</h4>
                        <ul class="solution-list">
                            <li><strong>Innovative Approach:</strong> Highly personalized technology-driven team building.</li>
                            <li><strong>No Guesswork:</strong> Know exactly what to do, and when to do it at every stage.</li>
                            <li><strong>Universal System:</strong> Works with any company or opportunity.</li>
                        </ul>
                        <p>With Team Build Pro, you're not just getting another app‚Äîyou're getting a complete system designed to help you build, manage, and grow your team effectively from day one.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Industry Challenge Section (Simplified) -->
        <section id="industry-challenge" class="section section-gray">
            <div class="container">
                <div class="section-header">
                    <h2>The Direct Sales Reality</h2>
                    <p>Most direct sales representatives struggle‚Äînot from lack of ability, but from lack of system.</p>
                </div>
                <div class="challenge-stats" style="display: flex; gap: 20px; justify-content: center; max-width: 800px; margin: 0 auto;">
                    <div class="stat-card reveal-on-scroll">
                        <div class="stat-number">90%</div>
                        <div class="stat-label">struggle with recruiting new team members</div>
                    </div>
                    <div class="stat-card reveal-on-scroll" style="display: none;">
                        <div class="stat-number">#1</div>
                        <div class="stat-label">challenge is consistent team building</div>
                    </div>
                </div>
                <div class="section-header" style="margin-top: 40px; margin-bottom: 0;">
                    <p>Team Build Pro brings an innovative, mobile-first approach to creating and sustaining real momentum‚Äîno matter your experience level or opportunity.</p>
                </div>
            </div>
        </section>

        <!-- "How It Works" Section -->
        <section id="how-it-works" class="section section-white">
            <div class="container">
                <div class="section-header">
                    <h2>How It Works</h2>
                    <p>Four simple steps to build unstoppable momentum.</p>
                </div>
                <div class="grid grid-4">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue">
                                <span class="material-symbols-outlined">foundation</span>
                            </div>
                            <h3>Set Your Foundation</h3>
                        </div>
                        <p>
                            Customize the app with your opportunity details and referral link. This sets the stage for immediate and sustained growth.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple">
                                <span class="material-symbols-outlined">auto_awesome</span>
                            </div>
                            <h3>AI Coach Guides You</h3>
                        </div>
                        <p>
                            Get suggested messages, timing cues, and next steps. One tap to send targeted messages to recruiting prospects.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon green">
                                <span class="material-symbols-outlined">group_add</span>
                            </div>
                            <h3>Build Smart, Not Hard</h3>
                        </div>
                        <p>
                            Share with your recruiting prospects and current team members. Momentum quickly builds as messages and follow-ups stay on track.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon orange">
                                <span class="material-symbols-outlined">verified</span>
                            </div>
                            <h3>Automatic Qualification</h3>
                        </div>
                        <p>
                            When recruiting prospects hit achievable growth milestones, they're automatically invited to join your opportunity under you!
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dual Downline Animation Section -->
        <section id="downline-animation-section" class="downline-animation-section">

            <div class="downline-container">
                <div class="downline-header">
                    <h2>See How Pre-Building Creates Momentum</h2>
                    <p>Watch how recruiting prospects build their team BEFORE joining‚Äîpositioning themselves for immediate success while feeding your business growth.</p>
                </div>

                <div class="downlines-wrapper">
                    <!-- Left Side - Pre-Build Downline -->
                    <div class="downline-side downline-left">
                        <div class="downline-title">Recriting Prospects<br />Pre-Build with Team Build Pro</div>
                        <div class="downline-tree" id="downline-left">
                            <div class="downline-level downline-level-0"></div>
                            <div class="downline-level downline-level-1"></div>
                            <div class="downline-level downline-level-2"></div>
                        </div>
                        <div class="benefit-callout left" id="left-benefit">
                            <strong>Prospect Advantage:</strong>
                            Build team momentum before Day 1
                        </div>
                    </div>

                    <!-- Right Side - Business Opportunity Downline -->
                    <div class="downline-side downline-right">
                        <div class="downline-title">Recriting Prospects<br />Join Opportunity With Momentum</div>
                        <div class="downline-tree" id="downline-right">
                            <div class="downline-level downline-level-0"></div>
                            <div class="downline-level downline-level-1"></div>
                            <div class="downline-level downline-level-2"></div>
                        </div>
                        <div class="benefit-callout right" id="right-benefit">
                            <strong>Your Advantage:</strong>
                            Their pre-built team feeds your downline
                        </div>
                    </div>
                </div>

                <div class="downline-stats">
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="stat-number">2x</div>
                            <div class="stat-label">Faster Team Growth</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">Win-Win</div>
                            <div class="stat-label">Both Sponsor & Prospect Benefit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">Day 1</div>
                            <div class="stat-label">Immediate Momentum</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

                <!-- App Screenshots -->
                <section id="screenshots" class="section section-white">
                    <div class="container">
                        <div class="section-header">
                            <h2>Your Complete Team Building System</h2>
                            <p>Fully customizable for your opportunity. Built to grow with you at every stage.</p>
                        </div>
                        <div class="shots-grid" aria-label="App screenshots">
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp1.jpg" alt="Control Center" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp2.jpg" alt="Team Reports" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp3.jpg" alt="Recruiting Prospects" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp4.jpg" alt="Current Business Members" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp5.jpg" alt="Personalized AI Coaching" loading="lazy">
                                </div>
                            </figure>
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp6.jpg" alt="Personalized AI Coaching" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp7.jpg" alt="Team Member Profiles" loading="lazy">
                                </div>
                            </figure>
                
                            <figure class="shot">
                                <div class="phone">
                                    <img src="assets/images/screenshots/tbp8.jpg" alt="Notifications Center" loading="lazy">
                                </div>
                            </figure>
                        </div>
                    </div>
                </section>
                
<!-- "Roadmap To Success" Section -->
        <section id="the-why" class="section section-white" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2 id="why-headline">Roadmap To Success</h2>
                    <p id="why-subheadline">
                        The biggest hurdle in direct sales: building momentum from day one.
                    </p>
                </div>
                <div class="grid grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon red"><span class="material-symbols-outlined">group_add</span></div>
                            <h3 id="why-card1-headline">Roadmap To Success</h3>
                        </div>
                        <p id="why-card1-text">
                            Starting from zero is tough. Professionals often struggle to find motivated prospects and
                            build momentum quickly, leading to frustration and slow growth.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue"><span class="material-symbols-outlined">lightbulb</span>
                            </div>
                            <h3 id="why-card2-headline">The Solution</h3>
                        </div>
                        <p id="why-card2-text">
                            Team Build Pro offers a unique system for pre-building your team, allowing you to cultivate
                            a
                            network of interested prospects before you even launch.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon green"><span class="material-symbols-outlined">trending_up</span>
                            </div>
                            <h3 id="why-card3-headline">The Results</h3>
                        </div>
                        <p id="why-card3-text">
                            By focusing on relationships first, our platform creates genuine momentum. Prospects in a
                            growing community are more engaged, motivated, and prepared for success.
                        </p>
                    </div>
                </div>
            </div>
        </section>




        <!-- "Who It's For" Section -->
        <section id="who-its-for" class="section section-white" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2 id="who-headline">Built for Every Stage</h2>
                    <p id="who-subheadline">
                        Whether you're an aspiring leader, an active builder, or a seasoned mentor, our tools grow with
                        you.
                    </p>
                </div>
                <div class="grid grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon orange"><span
                                    class="material-symbols-outlined">rocket_launch</span></div>
                            <h3 id="who-card1-headline">For Aspiring Leaders</h3>
                        </div>
                        <p id="who-card1-text">
                            Get a powerful head start. Begin building your team before you officially join an
                            opportunity
                            and launch with unstoppable momentum.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue"><span class="material-symbols-outlined">monitoring</span>
                            </div>
                            <h3 id="who-card2-headline">For Active Team Builders</h3>
                        </div>
                        <p id="who-card2-text">
                            Efficiently track, manage, and expand your organization with powerful analytics and
                            seamless,
                            secure communication tools.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple"><span class="material-symbols-outlined">groups</span></div>
                            <h3 id="who-card3-headline">For Seasoned Mentors</h3>
                        </div>
                        <p id="who-card3-text">
                            Cultivate a thriving global network, mentor emerging leaders, and ensure sustainable growth
                            across your entire organization.
                        </p>
                    </div>
                </div>
            </div>
        </section>


        <!-- "Features / Why Choose Us" Section -->
        <section id="features" class="section section-gray" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2>High-Performance<br>Team Building Tools</h2>
                    <p>Everything successful direct sales professionals need to dominate their market.</p>
                </div>
                <div class="grid grid-3">
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon blue"><span class="material-symbols-outlined">hub</span></div>
                            <h3>Complete Team Development</h3>
                        </div>
                        <p>
                            Expand your team worldwide, monitor qualification progress, and foster collaborative relationships with powerful, intuitive tools.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon purple"><span class="material-symbols-outlined">security</span>
                            </div>
                            <h3>Mobile-First Professional Platform</h3>
                        </div>
                        <p>
                            Built for today's mobile-first professional. Enterprise-grade security, lightning-fast performance, and 24/7 reliable access to your business.
                        </p>
                    </div>
                    <div class="feature-card reveal-on-scroll">
                        <div class="feature-card-header">
                            <div class="feature-icon emerald"><span class="material-symbols-outlined">chat</span></div>
                            <h3>Secure Global Communication</h3>
                        </div>
                        <p>
                            Secure messaging, daily progress updates, milestone tracking, and team coordination tools that work across all time zones and languages.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="section section-gray">
            <div class="container">
                <div class="section-header">
                    <h2>Risk-Free 30-Day Trial</h2>
                    <p>One plan, all features. Start your free trial today, no credit card required.</p>
                </div>
                <div class="trust-grid trust-grid-two">
                    <div class="trust-item">
                        <div class="trust-icon">
                            <span class="material-symbols-outlined">credit_card_off</span>
                        </div>
                        <h4>No Credit Card Required</h4>
                        <p>Start your trial immediately, decide later</p>
                    </div>
                    <div class="trust-item">
                        <div class="trust-icon">
                            <span class="material-symbols-outlined">schedule</span>
                        </div>
                        <h4>Cancel Anytime</h4>
                        <p>No long-term contracts or hidden fees</p>
                    </div>
                </div>
                <div class="pricing-card">
                    <h3>Subscription Plan</h3>
                    <p class="subtitle">Full access to all our premium features.</p>
                    <div class="price">
                        <span class="amount">$4.99</span>
                        <span class="period">/ month</span>
                    </div>
                    <div class="free-trial-badge">
                        <span class="trial-text">30-Day Free Trial</span>
                    </div>
                    <ul class="features-list">
                        <li><span class="material-symbols-outlined">check_circle</span>Unlimited Team Members</li>
                        <li><span class="material-symbols-outlined">check_circle</span>Real-time Analytics</li>
                        <li><span class="material-symbols-outlined">check_circle</span>Secure Messaging</li>
                        <li><span class="material-symbols-outlined">check_circle</span>Global Team Building</li>
                        <li><span class="material-symbols-outlined">check_circle</span>24/7 Customer Support</li>
                    </ul>
                    <a href="#" id="cta-pricing" class="pricing-button cta-button">Try AI Coach Free for 30 Days</a>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="section section-white">
            <div class="container">
                <div class="section-header">
                    <h2>Frequently Asked Questions</h2>
                    <p>
                        Have questions? We've got answers. If you have other questions, feel free to reach out.
                    </p>
                </div>
                <div class="faq">
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(1)">
                            <span>Is Team Build Pro a business opportunity?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-1">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-1">
                            No. Team Build Pro is not a business opportunity or income platform of any kind. We are a
                            software tool designed exclusively to help professionals build and track their teams. We do
                            not provide any form of user compensation.
                        </div>
                    </div>
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(2)">
                            <span>Who is this platform for?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-2">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-2">
                            Our platform is perfect for direct sales professionals, affiliate marketers, team leaders,
                            and any entrepreneur looking to build a collaborative organization. Whether you're just
                            starting or you're a seasoned mentor, our tools scale with you.
                        </div>
                    </div>
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(3)">
                            <span>Do I need a credit card for the free trial?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-3">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-3">
                            No. You can enjoy full access to all premium features for 30 days completely free, with no
                            credit card required to start. You can decide to subscribe at any point during or after your
                            trial.
                        </div>
                    </div>
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(4)">
                            <span>Can I cancel my subscription at any time?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-4">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-4">
                            Yes. You can cancel your subscription at any time with no long-term commitments or
                            cancellation fees. You will retain access until the end of your current billing period.
                        </div>
                    </div>
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(5)">
                            <span>What exactly does AI Coach do?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-5">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-5">
                            AI Coach helps you navigate the Team Build Pro app, answers questions about features and qualification requirements, provides team building guidance, and can suggest which app sections to visit for specific tasks.
                        </div>
                    </div>
                    <div class="faq-item">
                        <button class="faq-button" onclick="toggleFAQ(6)">
                            <span>Is my data private?</span>
                            <span class="material-symbols-outlined faq-icon" id="icon-6">expand_more</span>
                        </button>
                        <div class="faq-content" id="content-6">
                            Yes. AI Coach works within your workspace context. Messages are only used to generate your responses and suggestions; nothing is shared with any company you recruit for.
                        </div>
                    </div>
                </div>
                
                <!-- Link to comprehensive FAQ page -->
                <div class="section-footer" style="text-align: center; margin-top: 40px;">
                    <a href="/faq.html" class="cta-button secondary-cta" style="display: inline-block; padding: 16px 32px; background: transparent; border: 2px solid #2563EB; color: #2563EB; text-decoration: none; border-radius: 12px; font-weight: 600; transition: all 0.3s ease;">
                        View All Questions & Answers ‚Üí
                    </a>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section gradient-bg">
            <div class="container">
                <h2 id="cta-final-headline">Ready to Build Your Empire?</h2>
                <p id="cta-final-subheadline">
                    Join thousands of professionals who are building their teams faster than ever before. Start your
                    30-day free trial today.
                </p>
                <a href="#" id="cta-final" class="cta-button">Get AI Coach + Team Building Tools<br>Try Free for 30 Days!</a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-logo">
                <img src="assets/icons/team-build-pro.png" alt="Team Build Pro" style="width: 32px; height: 32px; border-radius: 50%;">
                <span>Team Build Pro</span>
            </div>
            <div class="footer-links">
                <a href="/#pricing">Pricing</a>
                <a href="/faq.html">FAQ</a>
                <a href="/contact_us.html">Contact</a>
                <a href="/privacy_policy.html">Privacy Policy</a>
                <a href="/terms_of_service.html">Terms of Service</a>
            </div>


            <p>&copy; <span id="currentYear"></span> Team Build Pro. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- COMING SOON MODAL -->
    <div id="comingSoonModal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="signup-form">
                <h2 id="modal-header">üöÄ Available Soon!</h2>
                <p id="modal-description">
                    Launching soon on Google Play<br>Get notified when it's available!
                </p>
                <form id="notificationForm" onsubmit="handleNotificationSignup(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" id="notificationFirstName" placeholder="First Name" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="notificationLastName" placeholder="Last Name" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="email" id="notificationEmail" placeholder="Enter your email address" required>
                    </div>
                    <!-- Demo Interest Section -->
                    <div class="form-group demo-section">
                        <label class="checkbox-label">
                            <input type="checkbox" id="demoInterest" tabindex="-1">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">Get FREE lifetime access (normally $4.99/mo) by previewing the app before official launch</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="signup-btn" tabindex="0">
                        <span id="signup-btn-text">Notify Me When It's Ready!</span>
                    </button>
                </form>
                <button class="modal-close-btn" onclick="closeModal()">Maybe Later</button>
            </div>
            
            <div id="success-message" style="display: none;">
                <h2>‚úÖ You're All Set!</h2>
                <div id="success-content">
                    <!-- Content will be dynamically inserted -->
                </div>
                <button class="modal-close-btn" onclick="closeModal()">Awesome!</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Smart App Banner will be configured by Joe's hardened implementation below

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA45ZN9KUuaYT0OHYZ9DmX2Jc8028Ftcvc",
            authDomain: "teambuilder-plus-fe74d.firebaseapp.com",
            projectId: "teambuilder-plus-fe74d",
            storageBucket: "teambuilder-plus-fe74d.firebasestorage.app",
            messagingSenderId: "312163687148",
            appId: "1:312163687148:web:43385dff773dab0b3763c9",
            measurementId: "G-G4E4TBBPZ7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ============================================================================
        // EARLY ADOPTER LIVE COUNTDOWN
        // ============================================================================
        async function updateEarlyAdopterBadges() {
            try {
                const earlyAdopterDoc = await db.collection('settings').doc('earlyAdopter').get();

                if (!earlyAdopterDoc.exists) {
                    console.log('Early adopter settings not found');
                    return;
                }

                const data = earlyAdopterDoc.data();
                const { totalGranted = 0, limit = 50, enabled = true } = data;
                const remaining = limit - totalGranted;

                const badgesContainer = document.getElementById('early-adopter-badges');
                const spotsElement = document.getElementById('spots-remaining');
                const trialBadge = document.querySelector('.hero-trial-badge');

                if (enabled && remaining > 0) {
                    spotsElement.textContent = remaining;
                    badgesContainer.style.display = 'flex';
                    trialBadge.style.display = 'none';
                    console.log(`Early adopter: ${remaining} spots remaining`);
                } else {
                    badgesContainer.style.display = 'none';
                    trialBadge.style.display = 'flex';
                    console.log('Early adopter program full or disabled');
                }
            } catch (error) {
                console.error('Error fetching early adopter data:', error);
            }
        }

        // Update badges on page load
        updateEarlyAdopterBadges();

        // ============================================================================
        // FIREBASE AUTH ACTION HANDLER FOR CUSTOM DOMAIN
        // ============================================================================

        // Check if this is a Firebase Auth action URL
        function handleFirebaseAuthActions() {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            const actionCode = urlParams.get('oobCode');
            const continueUrl = urlParams.get('continueUrl');

            if (mode && actionCode) {
                console.log('Firebase Auth action detected:', mode);

                // Hide the main website content and show auth action UI
                const mainElement = document.querySelector('main');
                const headerElement = document.querySelector('header');
                const footerElement = document.querySelector('footer');
                const comingSoonModal = document.getElementById('comingSoonModal');
                const bodyChildren = document.body.children;

                // Hide all main body content
                for (let i = 0; i < bodyChildren.length; i++) {
                    const child = bodyChildren[i];
                    if (child.tagName !== 'SCRIPT' && child.id !== 'auth-action-container') {
                        child.style.display = 'none';
                    }
                }

                // Specifically hide key elements if they exist
                if (mainElement) mainElement.style.display = 'none';
                if (headerElement) headerElement.style.display = 'none';
                if (footerElement) footerElement.style.display = 'none';
                if (comingSoonModal) comingSoonModal.style.display = 'none';

                // Create auth action container
                const authContainer = document.createElement('div');
                authContainer.id = 'auth-action-container';
                authContainer.style.cssText = `
                    min-height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    padding: 20px;
                `;

                const authCard = document.createElement('div');
                authCard.style.cssText = `
                    background: white;
                    border-radius: 12px;
                    padding: 40px;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                    max-width: 500px;
                    width: 100%;
                    text-align: center;
                `;

                authCard.innerHTML = `
                    <img src="assets/icons/team-build-pro.png" alt="Team Build Pro" style="width: 64px; height: 64px; border-radius: 50%; margin-bottom: 20px;">
                    <h2 style="color: #333; margin-bottom: 20px;">Team Build Pro</h2>
                    <div id="auth-message">Processing your request...</div>
                `;

                authContainer.appendChild(authCard);
                document.body.appendChild(authContainer);

                // Handle different action modes
                switch (mode) {
                    case 'resetPassword':
                        handlePasswordReset(actionCode, continueUrl);
                        break;
                    case 'verifyEmail':
                        handleEmailVerification(actionCode, continueUrl);
                        break;
                    case 'recoverEmail':
                        handleEmailRecovery(actionCode, continueUrl);
                        break;
                    default:
                        showAuthError('Unknown action type. Please contact support.');
                }

                return true; // Indicates auth action was handled
            }

            return false; // No auth action found
        }

        // Handle password reset
        function handlePasswordReset(actionCode, continueUrl) {
            const messageDiv = document.getElementById('auth-message');

            // Verify the action code first
            auth.verifyPasswordResetCode(actionCode)
                .then((email) => {
                    messageDiv.innerHTML = `
                        <h3 style="color: #333; margin-bottom: 20px;">Reset Your Password</h3>
                        <p style="color: #666; margin-bottom: 20px;">Enter a new password for ${email}</p>
                        <form id="password-reset-form">
                            <input type="password" id="new-password" placeholder="New Password" required
                                   style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                            <input type="password" id="confirm-password" placeholder="Confirm Password" required
                                   style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                            <button type="submit" style="width: 100%; padding: 12px; margin: 20px 0 10px 0; background: #4F46E5; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                                Update Password
                            </button>
                        </form>
                        <p style="color: #666; font-size: 14px;">After updating your password, you can sign in to the Team Build Pro app.</p>
                    `;

                    // Handle form submission
                    document.getElementById('password-reset-form').addEventListener('submit', (e) => {
                        e.preventDefault();

                        const newPassword = document.getElementById('new-password').value;
                        const confirmPassword = document.getElementById('confirm-password').value;

                        if (newPassword !== confirmPassword) {
                            alert('Passwords do not match. Please try again.');
                            return;
                        }

                        if (newPassword.length < 6) {
                            alert('Password must be at least 6 characters long.');
                            return;
                        }

                        // Confirm password reset
                        auth.confirmPasswordReset(actionCode, newPassword)
                            .then(() => {
                                showAuthSuccess('Password updated successfully! You can now sign in to the Team Build Pro app with your new password.');
                            })
                            .catch((error) => {
                                console.error('Password reset error:', error);
                                showAuthError('Failed to update password. The link may have expired. Please request a new password reset.');
                            });
                    });
                })
                .catch((error) => {
                    console.error('Invalid action code:', error);
                    showAuthError('Invalid or expired reset link. Please request a new password reset from the app.');
                });
        }

        // Handle email verification
        function handleEmailVerification(actionCode, continueUrl) {
            auth.applyActionCode(actionCode)
                .then(() => {
                    showAuthSuccess('Email verified successfully! You can now use all features of Team Build Pro.');
                })
                .catch((error) => {
                    console.error('Email verification error:', error);
                    showAuthError('Invalid or expired verification link. Please request a new verification email from the app.');
                });
        }

        // Handle email recovery
        function handleEmailRecovery(actionCode, continueUrl) {
            auth.checkActionCode(actionCode)
                .then((info) => {
                    const restoredEmail = info.data.email;

                    return auth.applyActionCode(actionCode).then(() => {
                        showAuthSuccess(`Email address ${restoredEmail} has been restored to your account.`);
                    });
                })
                .catch((error) => {
                    console.error('Email recovery error:', error);
                    showAuthError('Invalid or expired recovery link. Please contact support.');
                });
        }

        // Show success message
        function showAuthSuccess(message) {
            const messageDiv = document.getElementById('auth-message');
            messageDiv.innerHTML = `
                <div style="color: #10B981; font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                <h3 style="color: #333; margin-bottom: 20px;">Success!</h3>
                <p style="color: #666; margin-bottom: 30px;">${message}</p>
                <button onclick="window.close()" style="padding: 12px 24px; background: #4F46E5; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-right: 10px;">
                    Close
                </button>
                <a href="https://teambuildpro.com" style="padding: 12px 24px; background: #F3F4F6; color: #4F46E5; border: none; border-radius: 6px; font-weight: 600; text-decoration: none; display: inline-block;">
                    Visit Website
                </a>
            `;
        }

        // Show error message
        function showAuthError(message) {
            const messageDiv = document.getElementById('auth-message');
            messageDiv.innerHTML = `
                <div style="color: #EF4444; font-size: 48px; margin-bottom: 20px;">‚ùå</div>
                <h3 style="color: #333; margin-bottom: 20px;">Action Failed</h3>
                <p style="color: #666; margin-bottom: 30px;">${message}</p>
                <a href="https://teambuildpro.com" style="padding: 12px 24px; background: #4F46E5; color: white; border: none; border-radius: 6px; font-weight: 600; text-decoration: none; display: inline-block;">
                    Back to Website
                </a>
            `;
        }

        // Initialize auth action handling on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check if this is an auth action URL before initializing normal website
            if (!handleFirebaseAuthActions()) {
                // Only initialize normal website if no auth action was detected
                (async () => {
                    await initializePage();
                })();
            }
        });

        // ============================================================================
        // DYNAMIC CONTENT FOR DIFFERENT USER JOURNEYS
        // ============================================================================
        // Function to determine if mobile line break should be used
        function shouldUseMobileLineBreak() {
            return window.innerWidth <= 768;
        }

        // Function to get responsive heroBadge text
        function getResponsiveHeroBadgeText() {
            return "Try Free for 30 Days";
        }

        const contentFor = {
            partner: {
                heroBadge: getResponsiveHeroBadgeText(),
                heroHeadline: `Most Direct Sales Professionals Struggle with Team Building<br><span class="accent">Old methods fade. AI-driven recruiting builds teams that last.</span>`,
                heroSubheadline:
                    "Help recruiting prospects build momentum before Day 1.<br>Help existing team members accelerate their growth.",
                whoHeadline: "Built for Success at Every Level",
                whoSubheadline:
                    "Whether you're an aspiring leader, an active builder, or a seasoned mentor, our tools grow with you.",
                whoCard1Headline: "For Aspiring Leaders",
                whoCard1Text:
                    "Get a powerful head start. Begin building your team before you officially join an opportunity and launch with unstoppable momentum.",
                whoCard2Headline: "For Active Team Builders",
                whoCard2Text:
                    "Efficiently track, manage, and expand your organization with powerful analytics and seamless, secure communication tools.",
                whoCard3Headline: "For Seasoned Mentors",
                whoCard3Text:
                    "Cultivate a thriving global network, mentor emerging leaders, and ensure sustainable growth across your entire organization.",
                whyHeadline: "Roadmap To Success",
                whySubheadline: "We solve the biggest hurdle in direct sales: creating growth and sustaining momentum.",
                whyCard1Headline: "Team Growth",
                whyCard1Text:
                    "Creating and sustaining team growth is difficult. Without a simple system to follow, momentum stalls and growth becomes a struggle.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro provides your entire organization with a simple, unified system to follow, ensuring everyone can build effectively from day one.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "By providing a clear roadmap and powerful tools for everyone, we remove the guesswork from team building, leading to faster, more sustainable duplication.",
                ctaFinalHeadline: "Ready to Build Faster?",
                ctaFinalSubheadline:
                    "Give your entire organization the tools they need to succeed. Start your 30-day free trial today.",
            },
            new: {
                heroBadge: "Your Head Start to Success",
                heroHeadline: `Build Your Foundation <br> <span class="accent">Before Day One</span>`,
                heroSubheadline:
                    "The ultimate system to pre-build a large team BEFORE joining the business opportunity, positioning you for immediate success.",
                whoHeadline: "Pre-Launch Your Business",
                whoSubheadline:
                    "This isn't just an app; it's a strategic advantage for ambitious professionals ready to start strong.",
                whoCard1Headline: "Pre-Build Your Team",
                whoCard1Text:
                    "Use our system to invite and organize a network of interested prospects before you even join the business. No more starting from zero.",
                whoCard2Headline: "Create Real Momentum",
                whoCard2Text:
                    "Cultivate a thriving community that's ready to launch with you. When your team sees growth from day one, their belief and motivation skyrockets.",
                whoCard3Headline: "Launch with Confidence",
                whoCard3Text:
                    "Step into your new opportunity with a pre-built foundation, ready to achieve success and earn income from the very beginning.",
                whyHeadline: "Experience Early Success",
                whySubheadline: "We solve the biggest hurdle in direct sales: building momentum from day one.",
                whyCard1Headline: "Roadmap To Success",
                whyCard1Text:
                    "Starting a new business from zero is the biggest hurdle. It's a slow, uphill battle to build initial momentum, often leading to frustration.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro lets you build a network of motivated prospects first. You cultivate a ready-to-go team that can launch with you.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "By focusing on community and momentum before the sale, you de-risk the opportunity for your prospects and ensure a powerful, successful launch.",
                ctaFinalHeadline: "Ready to Build Your Foundation?",
                ctaFinalSubheadline:
                    "Join thousands of professionals who are building their teams faster than ever before. Start building your team for free today.",
            },
            // Targeted content variants based on share message types
            "t1": {
                heroBadge: "Your Head Start to Success",
                heroHeadline: `Past Struggles Don't Define <br> <span class="accent">Your Future Success</span>`,
                heroSubheadline:
                    "We understand the direct sales journey can feel overwhelming. This time is different - build your foundation before you even start.",
                whoHeadline: "A Different Approach This Time",
                whoSubheadline:
                    "No more starting from zero. No more cold calling strangers. Build your team with people who are already excited about team building.",
                whoCard1Headline: "Pre-Build Your Team",
                whoCard1Text:
                    "Use our system to invite and organize a network of interested prospects before you even join the business. No more starting from zero.",
                whoCard2Headline: "Create Real Momentum",
                whoCard2Text:
                    "Cultivate a thriving community that's ready to launch with you. When your team sees growth from day one, their belief and motivation skyrockets.",
                whoCard3Headline: "Launch with Confidence",
                whoCard3Text:
                    "Step into your new opportunity with a pre-built foundation, ready to achieve success and earn income from the very beginning.",
                whyHeadline: "Experience Early Success",
                whySubheadline: "We solve the biggest hurdle in direct sales: building momentum from day one.",
                whyCard1Headline: "Past Struggles",
                whyCard1Text:
                    "Previous attempts may have felt overwhelming or discouraging. It's natural to feel hesitant after experiencing setbacks in direct sales.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro lets you build confidence and skills in a supportive environment before making any commitments. Practice makes perfect.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "By building experience and a support network first, you enter opportunities with proven skills and established relationships.",
                ctaFinalHeadline: "Ready for a Different Experience?",
                ctaFinalSubheadline:
                    "This time can be different. Start building your foundation with confidence and support. Begin your 30-day free trial today.",
            },
            "t2": {
                heroBadge: "Your Head Start to Success", 
                heroHeadline: `You Don't Need to Be a Salesperson <br> <span class="accent">To Build Successfully</span>`,
                heroSubheadline:
                    "Team Build Pro is designed for authentic relationship builders, not pushy salespeople. Build through genuine connections.",
                whoHeadline: "Authentic Team Building",
                whoSubheadline:
                    "Focus on what you do best - building relationships and helping others succeed. The system handles the rest.",
                whoCard1Headline: "Build Authentically",
                whoCard1Text:
                    "No sales scripts or pushy tactics required. Build your team through genuine relationships and authentic connections with like-minded professionals.",
                whoCard2Headline: "Focus on Relationships",
                whoCard2Text:
                    "Concentrate on what you do naturally - helping others succeed. The system provides the structure while you provide the heart.",
                whoCard3Headline: "Natural Growth",
                whoCard3Text:
                    "Watch your team grow organically as you connect with people who share your values and approach to business building.",
                whyHeadline: "Authentic Beats Aggressive",
                whySubheadline: "Success comes from genuine connections, not sales pressure.",
                whyCard1Headline: "Sales Pressure",
                whyCard1Text:
                    "Many people avoid direct sales because they don't want to be pushy or use high-pressure tactics that don't align with their values.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro emphasizes relationship building and authentic connections. You can succeed by being genuinely helpful and supportive.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "When you build through authentic relationships, your team is stronger, more loyal, and more likely to duplicate your approach.",
                ctaFinalHeadline: "Ready to Build Authentically?",
                ctaFinalSubheadline:
                    "Join a community that values genuine relationships over sales pressure. Start your 30-day free trial today.",
            },
            "t3": {
                heroBadge: "Your Head Start to Success",
                heroHeadline: `Hope After Disappointment <br> <span class="accent">Your Breakthrough Awaits</span>`,
                heroSubheadline:
                    "Those past experiences taught you valuable lessons. Now use that wisdom with a system that actually works.",
                whoHeadline: "Experience Meets Opportunity",
                whoSubheadline:
                    "Your journey has prepared you for this moment. Build with confidence using proven strategies that eliminate common pitfalls.",
                whoCard1Headline: "Wisdom From Experience",
                whoCard1Text:
                    "Your past experiences, even the difficult ones, have taught you valuable lessons about what works and what doesn't in team building.",
                whoCard2Headline: "Avoid Past Mistakes",
                whoCard2Text:
                    "Use Team Build Pro's proven system to sidestep the common pitfalls that may have caused setbacks in previous opportunities.",
                whoCard3Headline: "Your Breakthrough Moment",
                whoCard3Text:
                    "This time can be different. With the right system and your hard-earned wisdom, success is within reach.",
                whyHeadline: "Turn Experience Into Success",
                whySubheadline: "Your past disappointments become your future advantages.",
                whyCard1Headline: "Past Disappointments",
                whyCard1Text:
                    "Previous setbacks can create doubt and hesitation. It's natural to wonder if this time will be any different from past experiences.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro addresses the common causes of failure in direct sales: lack of system, poor training, and starting from zero.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "Your experience combined with our proven system creates a powerful foundation for sustainable success and breakthrough results.",
                ctaFinalHeadline: "Ready for Your Breakthrough?",
                ctaFinalSubheadline:
                    "Your experience has prepared you for this moment. Turn past lessons into future success. Start your 30-day free trial today.",
            },
            "t4": {
                heroBadge: "Your Head Start to Success",
                heroHeadline: `Build Your Foundation <br> <span class="accent">Before Day One</span>`,
                heroSubheadline:
                    "The ultimate system to pre-build a large team BEFORE joining the business opportunity, positioning you for immediate success.",
                whoHeadline: "Pre-Launch Your Business",
                whoSubheadline:
                    "This isn't just an app; it's a strategic advantage for ambitious professionals ready to start strong.",
                whoCard1Headline: "Pre-Build Your Team",
                whoCard1Text:
                    "Use our system to invite and organize a network of interested prospects before you even join the business. No more starting from zero.",
                whoCard2Headline: "Create Real Momentum",
                whoCard2Text:
                    "Cultivate a thriving community that's ready to launch with you. When your team sees growth from day one, their belief and motivation skyrockets.",
                whoCard3Headline: "Launch with Confidence",
                whoCard3Text:
                    "Step into your new opportunity with a pre-built foundation, ready to achieve success and earn income from the very beginning.",
                whyHeadline: "Experience Early Success",
                whySubheadline: "We solve the biggest hurdle in direct sales: building momentum from day one.",
                whyCard1Headline: "Starting from Zero",
                whyCard1Text:
                    "Most people struggle because they start with no team, no momentum, and no proven system. It's an uphill battle from day one.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro lets you build a network of motivated prospects first. You cultivate a ready-to-go team that can launch with you.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "By focusing on community and momentum before the sale, you de-risk the opportunity for your prospects and ensure a powerful, successful launch.",
                ctaFinalHeadline: "Ready to Build Your Foundation?",
                ctaFinalSubheadline:
                    "Join thousands of professionals who are building their teams faster than ever before. Start building your team for free today.",
            },
            "t5": {
                heroBadge: "Your Blueprint for Team Growth",
                heroHeadline: `Re-Engage Your Warm Market <br> <span class="accent">With Fresh Opportunities</span>`,
                heroSubheadline:
                    "Transform how you approach your existing contacts by offering them a new way to build momentum and success before joining anything.",
                whoHeadline: "Re-Engage Your Network Effectively",
                whoSubheadline:
                    "Transform how you approach your existing contacts with a compelling new opportunity for pre-building success.",
                whoCard1Headline: "Fresh Approach to Contacts",
                whoCard1Text:
                    "Re-approach your personal and professional network with an innovative way to build momentum before joining any opportunity.",
                whoCard2Headline: "Quality Conversations",
                whoCard2Text:
                    "Give your contacts something genuinely valuable - the ability to build their team and create momentum before making any commitments.",
                whoCard3Headline: "Renewed Interest",
                whoCard3Text:
                    "Even contacts who weren't interested before may engage when they can build success first without the pressure of immediate joining.",
                whyHeadline: "Overcome Warm Market Challenges",
                whySubheadline: "Transform previous 'no's into new opportunities with a better approach.",
                whyCard1Headline: "Warm Market Exhaustion",
                whyCard1Text:
                    "You've already talked to most people you know, and many have said no or shown little interest in direct sales opportunities.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro gives you a new way to approach the same contacts - offering them a tool to build momentum and success before joining anything.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "People who previously said no may be interested when they can experience success first, removing risk and pressure from the equation.",
                ctaFinalHeadline: "Ready to Re-Engage Your Network?",
                ctaFinalSubheadline:
                    "Give your existing contacts a new reason to say yes. Transform your warm market approach. Start your 30-day free trial today.",
            },
            "t6": {
                heroBadge: "Your Blueprint for Team Growth",
                heroHeadline: `Stop the Expensive Systems <br> <span class="accent">Start Smart Building</span>`,
                heroSubheadline:
                    "No more costly lead generation. No more complex funnels. Just a simple system that your entire team can afford and duplicate.",
                whoHeadline: "Affordable Excellence",
                whoSubheadline:
                    "Professional-grade team building tools at a fraction of the cost of traditional recruiting systems.",
                whoCard1Headline: "Stop the Spending",
                whoCard1Text:
                    "No more expensive lead generation, costly advertising, or complex funnel systems that drain your budget without guaranteed results.",
                whoCard2Headline: "Simple and Affordable",
                whoCard2Text:
                    "One low monthly fee gives your entire team access to professional-grade tools that actually work, without breaking the bank.",
                whoCard3Headline: "Team Can Duplicate",
                whoCard3Text:
                    "Your team members can afford the same tools you use, creating true duplication and consistent results across your organization.",
                whyHeadline: "Smart Building Beats Expensive Systems",
                whySubheadline: "Effective doesn't have to mean expensive.",
                whyCard1Headline: "Expensive Systems",
                whyCard1Text:
                    "Many teams struggle because effective marketing and recruiting systems are too expensive for most team members to duplicate.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro provides professional-grade capabilities at a price point that allows true duplication throughout your organization.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "When your entire team can afford the same effective tools, duplication becomes natural and growth accelerates exponentially.",
                ctaFinalHeadline: "Ready to Build Smart?",
                ctaFinalSubheadline:
                    "Stop overspending on systems your team can't duplicate. Smart building starts here. Begin your 30-day free trial today.",
            },
            "t7": {
                heroBadge: "Your Blueprint for Team Growth",
                heroHeadline: `Simple System <br> <span class="accent">Your Team Can Actually Copy</span>`,
                heroSubheadline:
                    "Finally, a system so straightforward that every member of your team can duplicate it successfully, regardless of experience level.",
                whoHeadline: "True Duplication at Last",
                whoSubheadline:
                    "Mobile-first, easy to share, and designed for team members at every skill level to achieve consistent results.",
                whoCard1Headline: "Simple for Everyone",
                whoCard1Text:
                    "Designed to be easily understood and implemented by team members at any experience level, from complete beginners to seasoned professionals.",
                whoCard2Headline: "Mobile-First Design",
                whoCard2Text:
                    "Everything works perfectly on mobile devices, making it easy for your team to build their business anywhere, anytime.",
                whoCard3Headline: "Consistent Results",
                whoCard3Text:
                    "When your system is simple enough for everyone to follow, your entire team gets consistent results and true duplication happens naturally.",
                whyHeadline: "Simplicity Drives Duplication",
                whySubheadline: "The best system is one your entire team can actually use.",
                whyCard1Headline: "Complex Systems Fail",
                whyCard1Text:
                    "Many leaders use systems that work for them but are too complex for their team members to duplicate, limiting overall growth.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro is designed for simplicity without sacrificing effectiveness. Every feature is intuitive and easy to duplicate.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "When your team can easily duplicate your methods, growth becomes exponential and sustainable across your entire organization.",
                ctaFinalHeadline: "Ready for True Duplication?",
                ctaFinalSubheadline:
                    "Give your team a system they can actually copy. Simple, effective, and duplicatable. Start your 30-day free trial today.",
            },
            "t8": {
                heroBadge: "Your Blueprint for Team Growth",
                 heroHeadline: `Most Direct Sales Professionals Struggle with Team Building<br><span class="accent">Old methods fade. AI-driven recruiting builds teams that last.</span>`,
                heroSubheadline:
                    "Help recruiting prospects build momentum before Day 1.<br>Help existing team members accelerate their growth.",
                whoHeadline: "Built for Success at Every Level",
                whoSubheadline:
                    "Whether you're an aspiring leader, an active builder, or a seasoned mentor, our tools grow with you.",
                whoCard1Headline: "For Aspiring Leaders",
                whoCard1Text:
                    "Get a powerful head start. Begin building your team before you officially join an opportunity and launch with unstoppable momentum.",
                whoCard2Headline: "For Active Team Builders",
                whoCard2Text:
                    "Efficiently track, manage, and expand your organization with powerful analytics and seamless, secure communication tools.",
                whoCard3Headline: "For Seasoned Mentors",
                whoCard3Text:
                    "Cultivate a thriving global network, mentor emerging leaders, and ensure sustainable growth across your entire organization.",
                whyHeadline: "Roadmap To Success",
                whySubheadline: "We solve the biggest hurdle in direct sales: creating growth and sustaining momentum.",
                whyCard1Headline: "Team Growth Challenge",
                whyCard1Text:
                    "Creating and sustaining team growth is difficult. Without a simple system to follow, momentum stalls and growth becomes a struggle.",
                whyCard2Headline: "The Solution",
                whyCard2Text:
                    "Team Build Pro provides your entire organization with a simple, unified system to follow, ensuring everyone can build effectively from day one.",
                whyCard3Headline: "The Results",
                whyCard3Text:
                    "By providing a clear roadmap and powerful tools for everyone, we remove the guesswork from team building, leading to faster, more sustainable duplication.",
                ctaFinalHeadline: "Ready to Build Faster?",
                ctaFinalSubheadline:
                    "Give your entire organization the tools they need to succeed. Professional team building made simple. Start your 30-day free trial today.",
            },
        };

        // Function to validate targeting parameter
        function isValidTargeting(targeting) {
            if (!targeting) return false;
            const validTargets = ['1', '2', '3', '4', '5', '6', '7', '8'];
            return validTargets.includes(targeting);
        }

        // Function to update the DOM with dynamic content
        function updatePageContent(type = "partner", targeting = null) {
            // If targeting parameter is provided and valid, use targeted content
            if (targeting && isValidTargeting(targeting) && contentFor[`t${targeting}`]) {
                const content = contentFor[`t${targeting}`];
                console.log(`Using targeted content for message type: ${targeting} with referral type: ${type}`);
                updateContentElements(content);
                return;
            }
            
            // Fallback handling for invalid targeting parameters
            if (targeting && !isValidTargeting(targeting)) {
                console.warn(`Invalid targeting parameter: ${targeting}. Falling back to ${type} content.`);
            }
            
            // Default behavior for non-targeted content based on referral type
            // Refresh heroBadge text for current screen size
            if (contentFor.partner) {
                contentFor.partner.heroBadge = getResponsiveHeroBadgeText();
            }
            const content = contentFor[type] || contentFor.partner;
            console.log(`Using default ${type} content (no targeting parameter)`);
            updateContentElements(content);
        }

        // Helper function to update DOM elements
        function updateContentElements(content) {

            // Helper to safely update element content
            const updateElement = (id, content, isHtml = false) => {
                const element = document.getElementById(id);
                if (element) {
                    if (isHtml) {
                        element.innerHTML = content;
                    } else {
                        element.textContent = content;
                    }
                }
            };

            // Update Hero Section (legacy support)
            updateElement("hero-badge", content.heroBadge, true); // Enable HTML for heroBadge

            // Note: hero-headline and hero-subheadline are now handled by applyDualAudienceMessaging()
            // to support the new sponsor/prospect strategy with data-dynamic attributes
            if (!document.querySelector('[data-dynamic="hero-headline"]')) {
                // Fallback for old pages without data-dynamic attributes
                updateElement("hero-headline", content.heroHeadline, true);
                updateElement("hero-subheadline", content.heroSubheadline, true);
            }

            // Update "Who It's For" Section
            updateElement("who-headline", content.whoHeadline);
            updateElement("who-subheadline", content.whoSubheadline);
            updateElement("who-card1-headline", content.whoCard1Headline);
            updateElement("who-card1-text", content.whoCard1Text);
            updateElement("who-card2-headline", content.whoCard2Headline);
            updateElement("who-card2-text", content.whoCard2Text);
            updateElement("who-card3-headline", content.whoCard3Headline);
            updateElement("who-card3-text", content.whoCard3Text);

            // Update "The Why" Section
            updateElement("why-headline", content.whyHeadline);
            updateElement("why-subheadline", content.whySubheadline);
            updateElement("why-card1-headline", content.whyCard1Headline);
            updateElement("why-card1-text", content.whyCard1Text);
            updateElement("why-card2-headline", content.whyCard2Headline);
            updateElement("why-card2-text", content.whyCard2Text);
            updateElement("why-card3-headline", content.whyCard3Headline);
            updateElement("why-card3-text", content.whyCard3Text);

            // Update Final CTA
            updateElement("cta-final-headline", content.ctaFinalHeadline);
            updateElement("cta-final-subheadline", content.ctaFinalSubheadline);

            // CTA buttons are now handled by smart device detection in updateCTAs()
            // No longer using static content for CTA text
        }

        // ============================================================================
        // REFERRAL LOGIC
        // ============================================================================

        function getReferralInfo() {
            if (window.location.protocol === "file:") return null;
            const urlParams = new URLSearchParams(window.location.search);
            const newProspectCode = urlParams.get("new");
            const partnerCode = urlParams.get("ref");
            const targetingParam = urlParams.get("t");

            if (newProspectCode && isValidReferralCode(newProspectCode)) {
                return { code: newProspectCode, type: "new", targeting: targetingParam };
            }
            if (partnerCode && isValidReferralCode(partnerCode)) {
                return { code: partnerCode, type: "partner", targeting: targetingParam };
            }
            return null;
        }

        function isValidReferralCode(code) {
            return (
                code &&
                code.trim().length >= 3 &&
                code.length <= 50 &&
                !/[:/\\]/.test(code) &&
                !/^(file|C:)/.test(code)
            );
        }

        function createInviteSection(firstName, lastName, referralType, bizOppName, photoUrl) {
            const inviteContainer = document.getElementById('personal-invite-container');
            const heroHeadline = document.getElementById('hero-headline');
            const heroSubheadline = document.getElementById('hero-subheadline');
            const ctaHero = document.getElementById('cta-hero');

            if (typeof kDebugMode !== 'undefined' && kDebugMode) {
                if (!inviteContainer || !heroHeadline || !heroSubheadline || !ctaHero) {
                    console.error("Hero elements not found for personalization.");
                }
            }

            
            const avatarUrl = photoUrl || 'assets/images/default_avatar.png';
            const referrerFullName = `${firstName} ${lastName}`;
            const opportunityName = `<strong>${bizOppName || 'their opportunity'}</strong>`;

            // 1. Create top fixed invite bar
            const topInviteBar = document.getElementById('top-invite-bar');
            if (topInviteBar) {
                topInviteBar.innerHTML = `
                    <img src="${avatarUrl}" alt="${referrerFullName}" class="top-invite-avatar" onerror="this.src='assets/images/default_avatar.png';">
                    <span class="top-invite-text">Invited by ${referrerFullName}</span>
                `;
                topInviteBar.classList.add('visible');
            }

            // 2. Hide the personal invite container in hero (we're using top bar now)
            inviteContainer.style.display = 'none';

            // 3. Hero content is now handled by applyDualAudienceMessaging()
            // This function only manages the top invite bar - no hero content updates

            // Hide the generic badge now that a personal invitation is shown
            const heroBadge = document.getElementById('hero-badge');
            if (heroBadge) {
                heroBadge.style.display = 'none';
            }
        }

        // Tolerant version that handles all photo field variations
        async function fetchUserAndDisplayInvite(referralInfo) {
            try {
                const url = `https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/getUserByReferralCode?code=${referralInfo.code}`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.error("Sponsor not found or server error:", response.status);
                    return;
                }

                const userData = await response.json();
                console.log("User data received:", userData);

                // Tolerant photo field resolution
                const photoUrl = userData.photoUrl || userData.photoURL || userData.profilePhotoUrl || null;
                console.log("Photo URL from database:", photoUrl);

                if (userData.firstName && userData.lastName) {
                    const bizOppName = userData.bizOppName || "their opportunity";
                    const validPhotoUrl = photoUrl && photoUrl.trim() !== '' ? photoUrl : null;
                    createInviteSection(
                        userData.firstName,
                        userData.lastName,
                        referralInfo.type,
                        bizOppName,
                        validPhotoUrl
                    );
                }
            } catch (error) {
                console.error("Error fetching user data by referral code:", error);
            }
        }

        // Setup Universal Link ‚Üí App Store fallback for invite handoff
        function setupInviteHandoff() {
            const UNIVERSAL_LINK_BASE = 'https://teambuildpro.com/';
            const urlParams = new URLSearchParams(window.location.search);
            const APP_STORE_URL = urlParams.has('new')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=2a144d9e-a5f0-4cac-a4ba-cf1c4f88e88a'
                : urlParams.has('ref')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=3a1d377a-09ec-4707-bdb8-0bd147b99c6f'
                : 'https://apps.apple.com/app/team-build-pro/id6751211622';

            const params = window.location.search || '';
            const universalLink = UNIVERSAL_LINK_BASE + (params.startsWith('?') ? params : ('?' + params));

            const openBtn = document.getElementById('openApp');
            if (!openBtn) return;

            openBtn.addEventListener('click', function () {
                openBtn.disabled = true;
                openBtn.style.opacity = '0.6';

                const start = Date.now();
                window.location.href = universalLink;

                setTimeout(function () {
                    const elapsed = Date.now() - start;
                    if (elapsed < 1600) {
                        window.location.replace(APP_STORE_URL);
                    }
                }, 1200);
            });
        }

        // --- OPEN APP OR FALL BACK TO APP STORE (iOS) ---
        // Universal Link attempt - fallback logic now on /claim page
        (function () {
            if (typeof window.openAppOrStore === 'function') return;

            window.openAppOrStore = function openAppOrStore() {
                const urlParams = new URLSearchParams(window.location.search);
                const APP_STORE_URL = urlParams.has('new')
                    ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=2a144d9e-a5f0-4cac-a4ba-cf1c4f88e88a'
                    : urlParams.has('ref')
                    ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=3a1d377a-09ec-4707-bdb8-0bd147b99c6f'
                    : 'https://apps.apple.com/app/team-build-pro/id6751211622';

                // Check if on iOS (including iPad desktop mode)
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

                if (!isIOS) {
                    // Desktop or Android - go straight to store
                    window.location.href = APP_STORE_URL;
                    return;
                }

                // Strip existing _ul parameter (prevent double-tap issues)
                const url = new URL(location.href);
                url.searchParams.delete('_ul');
                const params = url.search || '';
                const sep = params ? '&' : '?';
                const UNIVERSAL_LINK = 'https://teambuildpro.com/claim.html' + params + sep + '_ul=1';

                // Navigate to /claim.html - if app installed, handoff happens before page loads
                // If app not installed, /claim.html loads and runs fallback to App Store
                console.log('üîó Navigating to UL:', UNIVERSAL_LINK);
                window.location.href = UNIVERSAL_LINK;
            };
        })();

        // ============================================================================
        // INITIALIZATION & UTILITIES
        // ============================================================================

        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function getDeviceType() {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isAndroid = /Android/.test(userAgent);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            return {
                isIOS,
                isAndroid,
                isMobile,
                isDesktop: !isMobile
            };
        }

        // ==============================
        // TOKEN HANDOFF ATTRIBUTION SYSTEM
        // Privacy-compliant cross-device attribution using Firebase Cloud Functions
        // ==============================

        async function issueReferralToken(sponsorCode, source = 'web') {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const contentType = urlParams.get('t') || '1';

                const response = await fetch('https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/issueReferralV2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sponsorCode: sponsorCode,
                        t: contentType,
                        source: source
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('üìÑ Referral token issued (V2):', data.token);
                return data.token;
            } catch (error) {
                console.error('‚ùå Error issuing referral token (V2):', error);
                return null;
            }
        }


        async function copyTokenToPasteboard(token) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(token);
                    console.log('üìã Token copied via Clipboard API');
                } else {
                    // Fallback for older browsers or insecure contexts
                    const textArea = document.createElement('textarea');
                    textArea.value = token;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    console.log('üìã Token copied via fallback method');
                }
            } catch (error) {
                console.error('‚ùå Failed to copy token to pasteboard:', error);
            }
        }

        function generateQRCodeURL(token) {
            const appURL = `https://teambuildpro.com/claim.html?token=${encodeURIComponent(token)}`;
            return `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(appURL)}`;
        }

        function generateSMSHelper(token) {
            const appURL = `https://teambuildpro.com/claim.html?token=${encodeURIComponent(token)}`;
            const message = encodeURIComponent(`Download Team Build Pro and use this link to get your referral: ${appURL}`);
            return `sms:?body=${message}`;
        }

        async function createEnhancedReferralUI(sponsorCode) {
            const token = await issueReferralToken(sponsorCode, 'web-enhanced');
            if (!token) return '';

            const qrCodeURL = generateQRCodeURL(token);
            const smsURL = generateSMSHelper(token);
            const urlParams = new URLSearchParams(window.location.search);
            const appStoreUrl = urlParams.has('new')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=2a144d9e-a5f0-4cac-a4ba-cf1c4f88e88a'
                : urlParams.has('ref')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=3a1d377a-09ec-4707-bdb8-0bd147b99c6f'
                : 'https://apps.apple.com/app/team-build-pro/id6751211622';

            return `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 24px; border-radius: 16px; color: white; text-align: center; margin: 20px 0; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
                    <h3 style="margin: 0 0 16px 0; font-size: 20px;">üì± Get the App - Multiple Ways!</h3>

                    <div style="display: flex; gap: 20px; justify-content: center; align-items: center; flex-wrap: wrap;">
                        <!-- QR Code Option -->
                        <div style="text-align: center;">
                            <p style="margin: 0 0 8px 0; font-size: 14px; opacity: 0.9;">üì± Scan with Phone</p>
                            <img src="${qrCodeURL}" alt="QR Code" style="border: 3px solid white; border-radius: 8px;" />
                        </div>

                        <!-- SMS Helper Option -->
                        <div style="text-align: center;">
                            <p style="margin: 0 0 8px 0; font-size: 14px; opacity: 0.9;">üí¨ Send to Phone</p>
                            <a href="${smsURL}" style="display: inline-block; background: rgba(255,255,255,0.2); color: white; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">üì± Text Me Link</a>
                        </div>

                        <!-- Direct App Store -->
                        <div style="text-align: center;">
                            <p style="margin: 0 0 8px 0; font-size: 14px; opacity: 0.9;">üçé Direct Download</p>
                            <a href="${appStoreUrl}" target="_blank" rel="noopener" style="display: inline-block;">
                                <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="Download on the App Store" style="height: 50px; border-radius: 6px;" />
                            </a>
                        </div>
                    </div>

                    <p style="margin: 16px 0 0 0; font-size: 12px; opacity: 0.8;">üí° Your referral token: <code style="background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; font-family: monospace;">${token}</code></p>
                    <p style="margin: 8px 0 0 0; font-size: 11px; opacity: 0.7;">Token expires in 24 hours ‚Ä¢ Privacy-compliant attribution</p>
                </div>
            `;
        }

        async function createAppStoreBadge(isPrimary = true) {
            // All badges now try Universal Link ‚Üí App Store fallback via openAppOrStore()
            // Capture-phase handler still runs for analytics/token copy
            const urlParams = new URLSearchParams(window.location.search);
            const appStoreUrl = urlParams.has('new')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=2a144d9e-a5f0-4cac-a4ba-cf1c4f88e88a'
                : urlParams.has('ref')
                ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=3a1d377a-09ec-4707-bdb8-0bd147b99c6f'
                : 'https://apps.apple.com/app/team-build-pro/id6751211622';
            return `
                <a href="${appStoreUrl}" class="app-store-badge ${isPrimary ? 'primary' : 'secondary'}" onclick="openAppOrStore(); return false;" rel="noopener" style="display: inline-block; vertical-align: top;">
                    <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg"
                         alt="Download on the App Store" style="height: 60px;" />
                </a>
            `;
        }

        function createUnifiedComingSoonButton(isPrimary = true) {
            const buttonStyle = `
                background: linear-gradient(135deg, #4F46E5 0%, #2563EB 100%);
                color: white;
                border: 2px solid rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                padding: 18px 32px;
                font-size: 18px;
                font-weight: 600;
                line-height: 1.4;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
                text-align: center;
                min-width: 240px;
                font-family: inherit;
            `;
            
            const hoverStyle = `
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(79, 70, 229, 0.4)'; this.style.borderColor='rgba(255, 255, 255, 0.3)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(79, 70, 229, 0.3)'; this.style.borderColor='rgba(255, 255, 255, 0.2)'"
            `;
            
            return `
                <button style="${buttonStyle}" ${hoverStyle} onclick="openModal()">
                    Available Soon!<br>Get Notified!
                </button>
            `;
        }

        // Legacy functions kept for restoration purposes
        function createAppStoreComingSoonButton(isPrimary = true) {
            return `
                <button class="android-preview-btn ${isPrimary ? 'primary' : 'secondary'}" onclick="openModal()">
                    Available Soon on App Store<br>Get Notified!
                </button>
            `;
        }

        function createAndroidPreviewButton(isPrimary = true) {
            return `
                <a href="#" class="google-play-badge" onclick="event.preventDefault(); openModal();">
                    <img src="assets/images/Google-Play.png" alt="Get it on Google Play" />
                </a>
            `;
        }

        async function setupDownloadButtons() {
            const primaryContainer = document.getElementById('download-container');
            const secondaryContainer = document.getElementById('secondary-container');
            const device = getDeviceType();

            // Clear secondary container since we'll put both buttons in primary container
            secondaryContainer.innerHTML = '';

            // Set primary container to display buttons horizontally inline
            primaryContainer.style.display = 'flex';
            primaryContainer.style.flexWrap = 'wrap';
            primaryContainer.style.justifyContent = 'center';
            primaryContainer.style.alignItems = 'center';
            primaryContainer.style.gap = '12px';

            if (device.isIOS) {
                // iOS users get App Store download button first
                primaryContainer.innerHTML = await createAppStoreBadge(true) + createAndroidPreviewButton(false);
            } else if (device.isAndroid) {
                // Android users get preview button first
                primaryContainer.innerHTML = createAndroidPreviewButton(true) + await createAppStoreBadge(false);
            } else {
                // Desktop users get both options (iOS first, Android second)
                primaryContainer.innerHTML = await createAppStoreBadge(true) + createAndroidPreviewButton(false);
            }
        }

        const modal = document.getElementById("comingSoonModal");
        function openModal() {
            if (modal) {
                modal.style.display = "flex";
                
                // No device selection needed - they clicked Google Play button
                
                // Focus the first input when modal opens
                setTimeout(() => {
                    const firstInput = document.getElementById('notificationFirstName');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
        }
        function closeModal() {
            if (modal) {
                modal.style.display = "none";
                // Reset modal state when closing
                setTimeout(resetModal, 300); // Small delay for smooth closing
            }
        }
        window.addEventListener("keydown", (event) => {
            if (event.key === "Escape") closeModal();
        });
        
        // Handle tab trapping within modal
        function trapTabInModal(event) {
            if (!modal || modal.style.display === "none") return;
            
            if (event.key === "Tab") {
                const focusableElements = modal.querySelectorAll(
                    'input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];
                
                if (event.shiftKey) {
                    // Shift + Tab (backwards)
                    if (document.activeElement === firstElement) {
                        event.preventDefault();
                        lastElement.focus();
                    }
                } else {
                    // Tab (forwards)
                    if (document.activeElement === lastElement) {
                        event.preventDefault();
                        firstElement.focus();
                    }
                }
            }
        }
        
        document.addEventListener("keydown", trapTabInModal);

        async function setupBottomCTAs() {
            const ctaIds = ["cta-pricing", "cta-final"];

            for (const id of ctaIds) {
                const button = document.getElementById(id);
                if (!button) continue;

                // Create container with both buttons (similar to hero section)
                const buttonsContainer = `
                    <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 12px;">
                        <div style="height: 60px; display: flex; align-items: center;">
                            ${await createAppStoreBadge(true)}
                        </div>
                        <div style="height: 60px; display: flex; align-items: center;">
                            ${createAndroidPreviewButton(false)}
                        </div>
                    </div>
                `;

                button.outerHTML = buttonsContainer;
            }
        }

        async function updateCTAs() {
            // Setup the smart download buttons in hero section
            await setupDownloadButtons();

            // Setup the bottom CTAs with smart device detection
            await setupBottomCTAs();
        }

        // ============================================================================
        // DUAL-AUDIENCE AI MESSAGING STRATEGY
        // ============================================================================
        // Implements sponsor vs. prospect messaging based on referral type
        // Per Joe's recommendations: DOM batching, dynamic SEO, bridge text visibility

        async function applyDualAudienceMessaging(referralInfo, userData) {
            const hero = document.querySelector('.hero');
            if (!hero) return;

            const referralType = referralInfo ? referralInfo.type : null;
            const isProspect = referralType === 'new' && userData;

            // Prepare content based on audience type
            let heroHeadline, heroSubheadline, heroCorePromise, heroCTA, aiProofText, bridgeText;

            if (isProspect) {
                // PROSPECT VIEW - Arrived via ?new= referral link
                const referrerFullName = `${userData.firstName} ${userData.lastName}`;
                const bizOppName = userData.bizOppName || 'their opportunity';

                heroHeadline = 'Build Your Team Before You Join ‚Äî AI Coach Guides You Every Step';
                heroSubheadline = `${referrerFullName} from ${bizOppName} has invited you to start strong. Use Team Build Pro to pre-build your foundation before you officially join.`;
                heroCorePromise = 'Build momentum before Day 1. Launch with your team already in place.';
                heroCTA = 'Accept Invite & Start Building Your Foundation';
                aiProofText = 'Drafts your messages ‚Ä¢ Times your follow-ups ‚Ä¢ Tracks your momentum';
                bridgeText = 'When you join your sponsor, you\'ll already have the same AI tools they use to grow and duplicate success.';

                // Dynamic SEO for prospects
                document.title = `Build Your ${bizOppName} Team Before Day 1 | Team Build Pro`;
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content', `${referrerFullName} invites you to pre-build your ${bizOppName} team with Team Build Pro's AI Coach.`);
                }

                // Update Open Graph tags
                const ogTitle = document.querySelector('meta[property="og:title"]');
                const ogDesc = document.querySelector('meta[property="og:description"]');
                if (ogTitle) ogTitle.setAttribute('content', `Build Your ${bizOppName} Team Before Day 1`);
                if (ogDesc) ogDesc.setAttribute('content', `${referrerFullName} invites you to pre-build your ${bizOppName} team with Team Build Pro's AI Coach.`);

            } else {
                // SPONSOR VIEW - Default audience (direct traffic or ?ref= partner link)
                heroHeadline = 'AI-Driven Recruiting System for Direct Sales Leaders';
                heroSubheadline = 'Customize Team Build Pro with your company name and link ‚Äî an AI-powered recruiting companion your prospects will love.';
                heroCorePromise = 'Stand out as a sponsor. Give your prospects a real system that builds momentum.';
                heroCTA = 'Try AI Recruiting Free for 30 Days';
                aiProofText = 'Drafts messages ‚Ä¢ Times follow-ups ‚Ä¢ Tracks momentum ‚Ä¢ Coaches your prospects';
                bridgeText = ''; // Hidden for sponsors
            }

            // DOM Batching - Single hero query, batch updates
            const elementsToUpdate = {
                '[data-dynamic="hero-headline"]': heroHeadline,
                '[data-dynamic="hero-subheadline"]': heroSubheadline,
                '[data-dynamic="hero-promise"]': heroCorePromise,
                '[data-dynamic="ai-proof-text"]': aiProofText,
                '[data-dynamic="bridge-text"]': bridgeText
            };

            Object.keys(elementsToUpdate).forEach(selector => {
                const element = hero.querySelector(selector);
                if (element) {
                    element.innerHTML = elementsToUpdate[selector];

                    // Show/hide bridge text based on audience
                    if (selector === '[data-dynamic="bridge-text"]') {
                        element.style.display = isProspect ? 'block' : 'none';
                    }
                }
            });

            // Show/hide appropriate benefits section based on audience
            const sponsorBenefits = document.getElementById('sponsor-benefits');
            const prospectBenefits = document.getElementById('prospect-benefits');

            if (isProspect) {
                // PROSPECT VIEW - Show prospect benefits, hide sponsor benefits
                if (sponsorBenefits) sponsorBenefits.style.display = 'none';
                if (prospectBenefits) prospectBenefits.style.display = 'block';
            } else {
                // SPONSOR VIEW - Show sponsor benefits, hide prospect benefits
                if (sponsorBenefits) sponsorBenefits.style.display = 'block';
                if (prospectBenefits) prospectBenefits.style.display = 'none';
            }

            console.log(`‚úÖ Applied ${isProspect ? 'PROSPECT' : 'SPONSOR'} messaging with DOM batching`);
        }

        async function initializePage() {
            const referralInfo = getReferralInfo();
            const referralType = referralInfo ? referralInfo.type : "partner";
            const targeting = referralInfo ? referralInfo.targeting : null;

            // Apply legacy content updates (for non-hero sections)
            updatePageContent(referralType, targeting);

            // Fetch user data if referral exists
            let userData = null;
            if (referralInfo) {
                console.log("Processing referral:", referralInfo);

                // Fetch user data for dual-audience messaging
                try {
                    const url = `https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/getUserByReferralCode?code=${referralInfo.code}`;
                    const response = await fetch(url);
                    if (response.ok) {
                        userData = await response.json();
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                }

                // Apply dual-audience messaging strategy
                await applyDualAudienceMessaging(referralInfo, userData);

                // Display invite section (legacy)
                if (userData && userData.firstName && userData.lastName) {
                    const photoUrl = userData.photoUrl || userData.photoURL || userData.profilePhotoUrl || null;
                    const bizOppName = userData.bizOppName || "their opportunity";
                    const validPhotoUrl = photoUrl && photoUrl.trim() !== '' ? photoUrl : null;
                    createInviteSection(
                        userData.firstName,
                        userData.lastName,
                        referralInfo.type,
                        bizOppName,
                        validPhotoUrl
                    );
                }
            } else {
                console.log("No referral code found. Displaying default sponsor content.");
                // Apply sponsor messaging for direct traffic
                await applyDualAudienceMessaging(null, null);
            }

            await updateCTAs();
        }

        document.addEventListener("DOMContentLoaded", () => {
            const currentYearEl = document.getElementById("currentYear");
            if (currentYearEl) currentYearEl.textContent = new Date().getFullYear();
        });

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("revealed");
                    }
                });
            },
            { threshold: 0.1 }
        );

        document.querySelectorAll(".reveal-on-scroll").forEach((el) => observer.observe(el));

        // Handle responsive heroBadge text on window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const heroBadgeElement = document.getElementById('hero-badge');
                if (heroBadgeElement && !document.getElementById('personal-invite-container').hasChildNodes()) {
                    // Only update if no personal invite is showing
                    heroBadgeElement.innerHTML = getResponsiveHeroBadgeText();
                }
            }, 150); // Debounce resize events
        });

        // FAQ Toggle Function
        function toggleFAQ(index) {
            const content = document.getElementById(`content-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            for (let i = 1; i <= 6; i++) {
                if (i !== index) {
                    const otherContent = document.getElementById(`content-${i}`);
                    const otherIcon = document.getElementById(`icon-${i}`);
                    if (otherContent && otherIcon) {
                        otherContent.classList.remove("open");
                        otherIcon.textContent = 'expand_more';
                    }
                }
            }
            content.classList.toggle("open");
            icon.textContent = content.classList.contains('open') ? 'expand_less' : 'expand_more';
        }

        // Sandwich Menu Toggle
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = menuBtn.querySelector('.material-symbols-outlined');

        menuBtn.addEventListener('click', () => {
            const isOpen = mobileMenu.classList.toggle('open');
            menuBtn.setAttribute('aria-expanded', isOpen);
            menuIcon.textContent = isOpen ? 'close' : 'menu';
        });

        // Close menu when clicking outside
        document.addEventListener('click', (event) => {
            if (!mobileMenu.contains(event.target) && !menuBtn.contains(event.target)) {
                if (mobileMenu.classList.contains('open')) {
                    mobileMenu.classList.remove('open');
                    menuBtn.setAttribute('aria-expanded', 'false');
                    menuIcon.textContent = 'menu';
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = menuBtn.querySelector('.material-symbols-outlined');

            // Add click listeners to all menu links to close menu on selection
            const menuLinks = mobileMenu.querySelectorAll('a[role="menuitem"]');
            menuLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (mobileMenu.classList.contains('open')) {
                        mobileMenu.classList.remove('open');
                        menuBtn.setAttribute('aria-expanded', 'false');
                        menuIcon.textContent = 'menu';
                    }
                });
            });
        });

        // ============================================================================
        // NOTIFICATION SIGNUP FUNCTIONALITY
        // ============================================================================

        // No longer needed - device selection is simplified for Android only

        async function handleNotificationSignup(event) {
            event.preventDefault();
            
            const firstNameInput = document.getElementById('notificationFirstName');
            const lastNameInput = document.getElementById('notificationLastName');
            const emailInput = document.getElementById('notificationEmail');
            const demoCheckbox = document.getElementById('demoInterest');
            const submitBtn = document.querySelector('.signup-btn');
            const btnText = document.getElementById('signup-btn-text');
            const signupForm = document.getElementById('signup-form');
            const successMessage = document.getElementById('success-message');

            const firstName = firstNameInput.value.trim();
            const lastName = lastNameInput.value.trim();
            const email = emailInput.value.trim();
            const wantDemo = demoCheckbox.checked;
            const deviceType = 'android'; // Always Android since they clicked Google Play button

            if (!firstName || !lastName) {
                alert('Please enter your first and last name.');
                return;
            }

            if (!email || !isValidEmail(email)) {
                alert('Please enter a valid email address.');
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Verifying...';
            
            // Execute reCAPTCHA Enterprise with the same site key
            grecaptcha.enterprise.ready(async () => {
                try {
                    const token = await grecaptcha.enterprise.execute('6Lfwj5orAAAAADS--lFfBYWuz1b4LiQVUlOHZiyE', { action: 'notification_signup' });
                    
                    // Update loading text after reCAPTCHA
                    btnText.textContent = 'Signing you up...';
                    
                    // Add reCAPTCHA token to the signup process
                    await processNotificationSignup(firstName, lastName, email, wantDemo, deviceType, token, submitBtn, btnText, signupForm, successMessage);
                    
                } catch (error) {
                    console.error('reCAPTCHA error:', error);
                    alert('Security verification failed. Please try again.');
                    submitBtn.disabled = false;
                    btnText.textContent = 'Notify Me When It\'s Ready!';
                }
            });
        }
        
        async function processNotificationSignup(firstName, lastName, email, wantDemo, deviceType, recaptchaToken, submitBtn, btnText, signupForm, successMessage) {
            try {
                // Check if email already exists
                const existingQuery = await db.collection('launch_notifications')
                    .where('email', '==', email)
                    .limit(1)
                    .get();
                
                let isNewSignup = false;
                let shouldSendEmail = false;
                let existingDoc = null;
                
                if (existingQuery.empty) {
                    // New signup - create new document
                    const signupData = {
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        wantDemo: wantDemo,
                        deviceType: deviceType, // Always store device selection
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        source: 'website_modal',
                        userAgent: navigator.userAgent,
                        referrer: document.referrer || 'direct',
                        refUrl: window.location.href,
                        emailSent: false,
                        recaptchaToken: recaptchaToken
                    };
                    
                    const docRef = await db.collection('launch_notifications').add(signupData);
                    console.log('New signup successful:', `${firstName} ${lastName} (${email})` + (wantDemo ? ` - Demo requested (${deviceType})` : ''));
                    isNewSignup = true;
                    shouldSendEmail = true;

                    // Send demo notification email to admin
                    if (wantDemo) {
                        try {
                            const notificationResponse = await fetch('https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/sendDemoNotification', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    firstName: firstName,
                                    lastName: lastName,
                                    email: email,
                                    deviceType: deviceType
                                })
                            });

                            const notificationResult = await notificationResponse.json();
                            if (notificationResult.success) {
                                console.log('‚úÖ Demo notification email sent to admin');
                            } else {
                                console.warn('Failed to send notification:', notificationResult.error);
                            }
                        } catch (notificationError) {
                            console.error('Error sending demo notification:', notificationError);
                        }
                    }
                    
                } else {
                    // Email exists - check if demo is newly requested
                    existingDoc = existingQuery.docs[0];
                    const existingData = existingDoc.data();
                    const existingWantDemo = existingData.wantDemo || false;
                    
                    if (wantDemo && !existingWantDemo && deviceType) {
                        // Demo newly requested - update existing document
                        await existingDoc.ref.update({
                            wantDemo: true,
                            deviceType: deviceType,
                            demoRequestDate: firebase.firestore.FieldValue.serverTimestamp(),
                            refUrl: window.location.href,
                            emailSent: false,
                            recaptchaToken: recaptchaToken
                        });
                        console.log('Demo access added for existing user:', `${email} (${deviceType})`);
                        shouldSendEmail = true; // Send email with demo instructions

                        // Send demo notification email to admin for existing user
                        try {
                            const notificationResponse = await fetch('https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/sendDemoNotification', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    firstName: firstName,
                                    lastName: lastName,
                                    email: email,
                                    deviceType: deviceType
                                })
                            });

                            const notificationResult = await notificationResponse.json();
                            if (notificationResult.success) {
                                console.log('‚úÖ Demo notification email sent to admin for existing user');
                            } else {
                                console.warn('Failed to send notification for existing user:', notificationResult.error);
                            }
                        } catch (notificationError) {
                            console.error('Error sending demo notification for existing user:', notificationError);
                        }
                        
                    } else {
                        // Already registered, no new demo request
                        console.log('User already registered:', email);
                        showAlreadyRegisteredMessage();
                        signupForm.style.display = 'none';
                        successMessage.style.display = 'block';
                        return; // Exit early, don't send email
                    }
                }
                
                // Show appropriate success message
                if (isNewSignup) {
                    showSuccessMessage(wantDemo, deviceType);
                } else {
                    showDemoAddedMessage(deviceType);
                }
                
                signupForm.style.display = 'none';
                successMessage.style.display = 'block';
                
                // Send confirmation email via Cloud Function (only when appropriate)
                if (shouldSendEmail) {
                    try {
                        const response = await fetch('https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net/sendLaunchNotificationConfirmation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ 
                                firstName: firstName,
                                lastName: lastName,
                                email: email,
                                wantDemo: wantDemo,
                                deviceType: deviceType || null
                            })
                        });
                        
                        if (response.ok) {
                            console.log('Confirmation email sent successfully');
                        }
                    } catch (confirmationError) {
                        console.log('Confirmation email failed, but signup was saved:', confirmationError);
                    }
                }
                
            } catch (error) {
                console.error('Error signing up for notifications:', error);
                alert('Sorry, there was an error. Please try again later.');
                
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'Notify Me When It\'s Ready!';
            }
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function showSuccessMessage(wantDemo, deviceType) {
            const successContent = document.getElementById('success-content');
            
            if (wantDemo && deviceType) {
                const deviceName = deviceType === 'ios' ? 'iPhone' : 'Android';
                successContent.innerHTML = `
                    <p><strong>Perfect! You're all set!</strong></p>
                    <p>üìß <strong>Your demo access email will be sent shortly!</strong> Check your inbox for step-by-step instructions on how to download and preview the app on your Android device.</p>
                    <p style="margin: 15px 0;">We'll also notify you when Team Build Pro officially launches on Google Play.</p>
                    <p><strong>Thanks for being an early supporter!</strong></p>
                `;
            } else {
                successContent.innerHTML = `
                    <p>Thanks for your interest! We'll send you an email as soon as Team Build Pro is officially available on Google Play.</p>
                `;
            }
        }
        
        function showDemoAddedMessage(deviceType) {
            const successContent = document.getElementById('success-content');
            const deviceName = deviceType === 'ios' ? 'iPhone' : 'Android';
            
            successContent.innerHTML = `
                <p><strong>Great news!</strong> You're all set!</p>
                <p style="margin: 15px 0;">üìß <strong>Demo access email sent!</strong> Check your inbox for step-by-step instructions on how to download and preview the app on your Android device.</p>
                <p><strong>Thanks for your interest!</strong></p>
            `;
        }
        
        function showAlreadyRegisteredMessage() {
            const successContent = document.getElementById('success-content');
            
            successContent.innerHTML = `
                <p><strong>You've already registered - we've got you covered!</strong></p>
                <p style="margin: 15px 0;">We'll notify you as soon as Team Build Pro is officially available on App Store and Google Play.</p>
                <p>Thanks for your continued interest! üéâ</p>
            `;
        }
        
        function resetModal() {
            const signupForm = document.getElementById('signup-form');
            const successMessage = document.getElementById('success-message');
            const firstNameInput = document.getElementById('notificationFirstName');
            const lastNameInput = document.getElementById('notificationLastName');
            const emailInput = document.getElementById('notificationEmail');
            const demoCheckbox = document.getElementById('demoInterest');
            const submitBtn = document.querySelector('.signup-btn');
            const btnText = document.getElementById('signup-btn-text');
            const demoSection = document.querySelector('.demo-section');

            // Reset form visibility
            signupForm.style.display = 'block';
            successMessage.style.display = 'none';

            // Reset form state
            firstNameInput.value = '';
            lastNameInput.value = '';
            emailInput.value = '';
            demoCheckbox.checked = false;
            submitBtn.disabled = false;
            btnText.textContent = 'Notify Me When It\'s Ready!';
            
            // Hide demo section and reset its text
            if (demoSection) {
                demoSection.classList.remove('show');
                const demoText = demoSection.querySelector('.checkbox-text');
                if (demoText) {
                    demoText.textContent = "Get FREE lifetime access (normally $4.99/mo) by previewing the app before official launch";
                }
            }
            
            // Reset modal header and description
            const modalHeader = document.getElementById('modal-header');
            const modalDescription = document.getElementById('modal-description');
            if (modalHeader) {
                modalHeader.textContent = 'üöÄ Available Soon!';
            }
            if (modalDescription) {
                modalDescription.innerHTML = 'Launching soon on Google Play<br>Get notified when it\'s available!';
            }
        }

        // ============================================================================
        // EMAIL DETECTION & DEMO PROMPT FUNCTIONALITY
        // ============================================================================
        
        function setupEmailDetection() {
            const emailInput = document.getElementById('notificationEmail');
            const demoSection = document.querySelector('.demo-section');
            let emailDetectionTimeout;
            
            if (!emailInput || !demoSection) return;
            
            emailInput.addEventListener('input', function() {
                clearTimeout(emailDetectionTimeout);
                
                // Debounce email detection to avoid flickering
                emailDetectionTimeout = setTimeout(() => {
                    const email = emailInput.value.trim().toLowerCase();
                    
                    if (email.endsWith('@gmail.com')) {
                        showDemoSection();
                    } else {
                        hideDemoSection();
                    }
                }, 500); // Wait 500ms after user stops typing
            });
        }
        
        
        function hideDemoSection() {
            const demoSection = document.querySelector('.demo-section');
            const demoCheckbox = document.getElementById('demoInterest');
            
            if (demoSection && demoSection.classList.contains('show')) {
                demoSection.classList.remove('show');
                
                // Restore modal header and description for both platforms
                const modalHeader = document.getElementById('modal-header');
                const modalDescription = document.getElementById('modal-description');
                if (modalHeader) {
                    modalHeader.textContent = 'üöÄ Available Soon!';
                }
                if (modalDescription) {
                    modalDescription.innerHTML = 'Launching soon on Google Play<br>Get notified when it\'s available!';
                }
                
                // Reset checkbox when hiding and remove from tab order
                if (demoCheckbox) {
                    demoCheckbox.checked = false;
                    demoCheckbox.tabIndex = -1;
                }
            }
        }
        
        // ============================================================================
        // DEMO LIMIT CHECKING FUNCTIONALITY
        // ============================================================================

        let demoLimitReached = false; // Global variable to track demo limit

        async function checkDemoLimit() {
            try {
                // Temporarily check limit manually via Firestore query
                const db = firebase.firestore();
                const demoQuery = await db.collection('launch_notifications')
                    .where('wantDemo', '==', true)
                    .get();

                const currentCount = demoQuery.size;
                demoLimitReached = currentCount >= 100;

                console.log(`üìä DEMO_LIMIT: ${currentCount}/100 demo requests, Limit reached: ${demoLimitReached}`);

                // If limit is reached, hide demo section completely
                if (demoLimitReached) {
                    const demoSection = document.querySelector('.demo-section');
                    if (demoSection) {
                        demoSection.style.display = 'none';
                    }

                    // Update modal to reflect limit reached
                    const modalDescription = document.getElementById('modal-description');
                    if (modalDescription) {
                        modalDescription.textContent = 'Our demo is full (100 testers), but we\'ll notify you when the app launches on Google Play!';
                    }
                }
            } catch (error) {
                console.error('Error checking demo limit:', error);
                // Don't block the form if there's an error
                demoLimitReached = false;
            }
        }

        function showDemoSection() {
            // Don't show demo section if limit is reached
            if (demoLimitReached) {
                console.log('üìä DEMO_LIMIT: Not showing demo section - limit reached');
                return;
            }

            const demoSection = document.querySelector('.demo-section');
            if (demoSection && !demoSection.classList.contains('show')) {
                demoSection.classList.add('show');

                // Update modal header and description for Google Play focus
                const modalHeader = document.getElementById('modal-header');
                const modalDescription = document.getElementById('modal-description');
                if (modalHeader) {
                    modalHeader.textContent = 'üöÄ Get Google Play Preview!';
                }
                if (modalDescription) {
                    modalDescription.innerHTML = 'Launching soon on Google Play<br>Get notified when it\'s available!';
                }

                // Update the demo text to be more contextual
                const demoText = demoSection.querySelector('.checkbox-text');
                if (demoText) {
                    demoText.textContent = "Get FREE lifetime access (normally $4.99/mo) by previewing the app before official launch";
                }

                // Make demo checkbox focusable
                const demoCheckbox = document.getElementById('demoInterest');
                if (demoCheckbox) {
                    demoCheckbox.tabIndex = 0;
                }
            }
        }

        // Initialize email detection and demo limit check when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            await checkDemoLimit(); // Check demo limit first
            setupEmailDetection(); // Then set up email detection
        });


    </script>

    <!-- ==== Joe's Hardened Token Handoff Implementation ==== -->

    <!-- Fallback modal (shows when clipboard write is blocked) -->
    <style>
      #tbp-attrib-modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999}
      #tbp-attrib-card{width:min(520px,92vw);background:#fff;border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
      #tbp-toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111;color:#fff;padding:10px 16px;border-radius:8px;display:none;z-index:10000}
      .tbp-row{display:flex;gap:12px;align-items:center;margin-top:10px}
      .tbp-btn{background:#0a66ff;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
      .tbp-btn.secondary{background:#eee;color:#111}
      code.tbp-code{user-select:all;display:block;background:#f6f6f6;padding:8px;border-radius:6px;font-size:13px}
      img#tbp-qr{width:180px;height:180px;border:1px solid #eee;border-radius:8px}
    </style>

    <div id="tbp-attrib-modal" role="dialog" aria-modal="true" aria-labelledby="tbp-title">
      <div id="tbp-attrib-card">
        <h3 id="tbp-title" style="margin:0 0 8px">Copy invite to your phone</h3>
        <p style="margin:0 0 8px">Copy the invite below or send it to your phone. After you install, the app will offer to apply it.</p>
        <code id="tbp-code" class="tbp-code">TBP_REF:‚Äî;TKN:‚Äî;T:‚Äî</code>
        <div class="tbp-row">
          <button id="tbp-copy" class="tbp-btn">Copy</button>
          <a id="tbp-sms" class="tbp-btn secondary" href="#">Send via SMS</a>
        </div>
        <div class="tbp-row" style="margin-top:14px">
          <img id="tbp-qr" alt="QR code for invite">
          <div style="font-size:13px;color:#444">Scan on your iPhone to auto-copy and open the App Store.</div>
        </div>
        <div class="tbp-row" style="justify-content:flex-end;margin-top:16px">
          <button id="tbp-cancel" class="tbp-btn secondary">Cancel</button>
          <button id="tbp-open-store" class="tbp-btn">Continue to App Store</button>
        </div>
      </div>
    </div>

    <div id="tbp-toast" role="status" aria-live="polite">Invite copied. Opening App Store‚Ä¶</div>

    <!-- Hardened attribution script -->
    <script>
      // -------- CONFIG (set once) --------
      const TBP_FN_BASE   = 'https://us-central1-teambuilder-plus-fe74d.cloudfunctions.net';

      // -------- Helpers --------
      const QP = new URLSearchParams(location.search);
      const APP_STORE_URL = QP.has('new')
          ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=2a144d9e-a5f0-4cac-a4ba-cf1c4f88e88a'
          : QP.has('ref')
          ? 'https://apps.apple.com/us/app/team-build-pro/id6751211622?ppid=3a1d377a-09ec-4707-bdb8-0bd147b99c6f'
          : 'https://apps.apple.com/app/team-build-pro/id6751211622';
      const qp = k => QP.get(k) || '';

      // Toast with debouncing (Joe's recommendation - prevents stacking on double-tap)
      let __toastTimeout = null;
      const toast = msg => {
        const el = document.getElementById('tbp-toast');
        if (__toastTimeout) {
          clearTimeout(__toastTimeout);
        }
        el.textContent = msg;
        el.style.display = 'block';
        __toastTimeout = setTimeout(() => {
          el.style.display = 'none';
          __toastTimeout = null;
        }, 2200);
      };

      const $modal = () => document.getElementById('tbp-attrib-modal');

      function openFallbackModal(payload){
        const code = document.getElementById('tbp-code');
        const sms  = document.getElementById('tbp-sms');
        const qr   = document.getElementById('tbp-qr');

        code.textContent = payload;

        const smsText = encodeURIComponent(`Team Build Pro invite\n\n${payload}\n\nOpen the app after install and accept the prompt to set your sponsor.`);
        // iOS uses sms:&body=, Android uses sms:?body=
        const isAndroid = /Android/i.test(navigator.userAgent);
        sms.href = `sms:${isAndroid ? '?' : '&'}body=${smsText}`;

        const token   = (payload.match(/TKN:([A-Fa-f0-9]{32})/)||[])[1] || '';
        const t       = (payload.match(/T:([^;]*)$/)||[])[1] || '';
        const sponsor = qp('ref') || qp('new') || '';
        const claimUrl = `${location.origin}/claim.html?token=${encodeURIComponent(token)}&ref=${encodeURIComponent(sponsor)}&t=${encodeURIComponent(t)}`;
        qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(claimUrl)}`;

        document.getElementById('tbp-copy').onclick = async ()=> {
          try { await navigator.clipboard.writeText(payload); toast('Invite copied'); } catch(_) {}
        };
        document.getElementById('tbp-open-store').onclick = ()=> window.location.href = APP_STORE_URL;
        document.getElementById('tbp-cancel').onclick = ()=> $modal().style.display = 'none';

        $modal().style.display = 'flex';
      }

      // Auto-redeem for cross-device: /claim?token=... or /?tkn=...
      (async function autoRedeemFromQuery(){
        const token = qp('token') || qp('tkn');
        if (!token) return;
        const sponsor = qp('ref') || qp('new') || '';
        const t = qp('t') || '1';
        const payload = `TBP_REF:${sponsor};TKN:${token};T:${t}`;
        try {
          await navigator.clipboard.writeText(payload);
          const debug = (new URLSearchParams(location.search).get('debug') === '1');
          if (debug) {
            const claimUrl = `${location.origin}/claim.html?tkn=${encodeURIComponent(token)}&ref=${encodeURIComponent(sponsor)}&t=${encodeURIComponent(t)}`;
            toast('Invite copied. Opening claim page‚Ä¶');
            setTimeout(() => window.location.href = claimUrl, 600);
          } else {
            toast('Invite copied. Opening App Store‚Ä¶');
            setTimeout(() => window.location.href = APP_STORE_URL, 600);
          }
        } catch {
          openFallbackModal(payload);
        }
      })();

      // Analytics function with sendBeacon (non-blocking UI)
      function tbpLog(event, payload = {}) {
        try {
          const url = `${TBP_FN_BASE}/tbpEventLog`;
          const body = JSON.stringify({
            e: event,
            ts: Date.now(),
            path: location.pathname,
            ref: (qp('ref') || qp('new') || ''),
            ...payload
          });
          navigator.sendBeacon(url, body);
        } catch(_) {}
      }

      // Core: issue token ‚Üí copy payload ‚Üí go to store (must run in a click handler)
      async function copyAndGo(refParam, tParam){
        // Navigation latch: first-click wins (Joe's recommendation)
        if (window.__tbpNavLock) {
          console.log('‚ö†Ô∏è Navigation already in progress, ignoring duplicate click');
          return;
        }
        window.__tbpNavLock = true;

        // Auto-release latch after 4 seconds
        setTimeout(() => {
          window.__tbpNavLock = false;
          console.log('üîì Navigation latch released');
        }, 4000);

        const sponsor = (refParam || qp('ref') || qp('new') || '').trim();
        const t = (tParam || qp('t') || '1').trim();
        const debug = (new URLSearchParams(location.search).get('debug') === '1');

        console.log('üöÄ copyAndGo() called', { sponsor, t, debug });

        // Organic install: no referral ‚Üí skip UL/claim, go direct to App Store
        if (!sponsor && !debug) {
          console.log('üçé PROD MODE: Organic install ‚Üí App Store');
          toast('Opening App Store‚Ä¶');
          setTimeout(() => { window.location.href = APP_STORE_URL; }, 600);
          return;
        }

        // Analytics: distinguish organic vs referral installs
        const sourceType = sponsor ? 'web_button' : 'web_button_no_sponsor';
        if (!sponsor) {
          console.log('üîç Analytics: Organic install (no sponsor code)');
        }

        // AbortController for fetch (Joe's recommendation)
        const abortController = new AbortController();
        window.addEventListener('beforeunload', () => abortController.abort(), { once: true });

        // CRITICAL: Start fetch immediately but DON'T await yet (keeps user gesture context)
        console.log('üì° Starting issueReferralV2 fetch...', { sponsor, t, source: sourceType });
        const tokenPromise = fetch(`${TBP_FN_BASE}/issueReferralV2`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ sponsorCode: sponsor, t, source: sourceType }),
          signal: abortController.signal
        });

        // Try optimistic clipboard write with ref-only payload (Joe's recommendation)
        // This happens BEFORE any await, preserving the user gesture context
        // TKN: empty means app can still apply sponsor from ref alone
        const optimisticPayload = constructPayload(sponsor, '', t);
        const earlyClipSuccess = await tryClipboardWrite(optimisticPayload);

        // Log optimistic clipboard result separately (Joe's recommendation)
        tbpLog('clipboard_optimistic', {
          clipboard_optimistic_ok: earlyClipSuccess,
          payload_kind: 'ref_only',
          sponsor: sponsor || 'none'
        });

        if (earlyClipSuccess) {
          console.log('‚úÖ Optimistic clipboard write successful (ref-only)');
        }

        // Now await the token fetch
        try {
          const r = await tokenPromise;
          console.log('üì° issueReferralV2 response:', { ok: r.ok, status: r.status });

          if (!r.ok) {
            const errorText = await r.text();
            tbpLog('issue_failed', { status: r.status, sponsor, errorText });
            console.error('‚ùå issueReferralV2 failed:', r.status, errorText);

            // Only show modal in debug mode or true failure
            if (debug) {
              openFallbackModal(constructPayload(sponsor, 'fallback_token', t));
            } else {
              toast('Unable to copy invite. Please try again.');
            }
            return;
          }

          const j = await r.json();
          console.log('‚úÖ issueReferralV2 success:', { hasToken: !!j.token });

          if (!j.token) {
            tbpLog('issue_failed', { error: 'no_token', sponsor });
            console.error('‚ùå issueReferralV2: no token in response');

            if (debug) {
              openFallbackModal(constructPayload(sponsor, 'fallback_token', t));
            } else {
              toast('Unable to copy invite. Please try again.');
            }
            return;
          }

          // Now we have the real token - try to upgrade clipboard (best-effort)
          const finalPayload = `TBP_REF:${sponsor};TKN:${j.token};T:${t};V:2`;
          console.log('üìã Final payload constructed:', finalPayload.substring(0, 50) + '...');

          // Best-effort token upgrade: try both methods once (Joe's recommendation)
          let finalClipSuccess = false;

          // Try modern API first
          const modernSuccess = await tryClipboardWrite(finalPayload);
          if (modernSuccess) {
            finalClipSuccess = true;
            console.log('‚úÖ Final clipboard write successful (modern API)');
          } else {
            // Try legacy textarea fallback once
            try {
              const legacySuccess = await legacyClipboardCopy(finalPayload);
              if (legacySuccess) {
                finalClipSuccess = true;
                console.log('‚úÖ Final clipboard write successful (legacy fallback)');
              }
            } catch (e) {
              console.log('‚ùå Final clipboard write failed (both methods)');
            }
          }

          // Log final clipboard result separately (Joe's recommendation)
          tbpLog('clipboard_final', {
            clipboard_final_ok: finalClipSuccess,
            payload_kind: finalClipSuccess ? 'full_token' : 'ref_only',
            sponsor: sponsor || 'none'
          });

          // Consolidated result for backward compatibility
          tbpLog('clipboard_result', {
            success: finalClipSuccess,
            method: earlyClipSuccess ? 'optimistic' : 'late',
            sponsor: sponsor || 'none'
          });

          // Navigate to destination
          if (debug) {
            const claimUrl = `${location.origin}/claim.html?tkn=${encodeURIComponent(j.token)}&ref=${encodeURIComponent(sponsor)}&t=${encodeURIComponent(t)}`;
            tbpLog('web_claim_redirect', { sponsor, t });
            console.log('üîç DEBUG MODE: Redirecting to claim page');
            toast('Invite copied. Opening claim page‚Ä¶');
            setTimeout(() => window.location.href = claimUrl, 600);
          } else {
            if (sponsor) {
              console.log('üçé PROD MODE: Referral install ‚Üí UL ‚Üí /claim.html fallback');
              toast('Invite copied. Opening app‚Ä¶');
              setTimeout(() => {
                try {
                  openAppOrStore();
                } catch (err) {
                  // Inline safety: same behavior even if helper unavailable
                  console.error('openAppOrStore failed, using fallback navigation:', err);
                  const params = window.location.search || '';
                  const UNIVERSAL_LINK = 'https://teambuildpro.com/' + (params.startsWith('?') ? params : ('?' + params));
                  const t0 = Date.now();
                  window.location.href = UNIVERSAL_LINK;
                  setTimeout(() => {
                    const elapsed = Date.now() - t0;
                    if (elapsed < 2000) {
                      window.location.replace(APP_STORE_URL);
                    }
                  }, 1500);
                }
              }, 600);
            } else {
              // (Belt & suspenders; organic should already have returned above)
              console.log('üçé PROD MODE: Organic install ‚Üí App Store');
              toast('Opening App Store‚Ä¶');
              setTimeout(() => { window.location.href = APP_STORE_URL; }, 600);
            }
          }

        } catch (err) {
          tbpLog('issue_failed', { error: String(err), sponsor });
          console.error('‚ùå issueReferralV2 network error:', err);

          if (debug) {
            openFallbackModal(constructPayload(sponsor, 'fallback_token', t));
          } else {
            toast('Network error. Please try again.');
          }
        }
      }

      // Helper: construct fallback payload when issueReferralV2 fails
      function constructPayload(sponsor, token, t) {
        return `TBP_REF:${sponsor};TKN:${token};T:${t};V:2`;
      }

      // Helper: legacy clipboard fallback using hidden textarea (for iOS 16/17)
      async function legacyClipboardCopy(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();

        try {
          const success = document.execCommand('copy');
          document.body.removeChild(textarea);
          return success;
        } catch (err) {
          document.body.removeChild(textarea);
          throw err;
        }
      }

      // Helper: attempt clipboard write with fallback
      async function tryClipboardWrite(text) {
        // HTTPS + focus guard (Joe's recommendation)
        if (!window.isSecureContext || !document.hasFocus()) {
          console.log('Clipboard blocked: insecure context or no focus');
          return false;
        }

        // Try modern API first
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (e1) {
          console.log('Modern clipboard blocked, trying legacy method...');
          // Try legacy fallback
          try {
            return await legacyClipboardCopy(text);
          } catch (e2) {
            console.error('Both clipboard methods failed:', e1, e2);
            return false;
          }
        }
      }

      // Global capture-phase handler - intercepts ALL CTA clicks before any other handlers
      document.addEventListener('click', (e) => {
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.button !== 0) return; // let modified/right-clicks behave normally
        // Let the dedicated Open button run its own Universal Link logic
        if (e.target.closest('#openApp')) return;

        const target = e.target.closest('.js-appstore-btn, [data-appstore], #cta-hero, #cta-pricing, #cta-final, #cta-footer, .app-store-badge');
        if (!target) return;

        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();

        const q = new URLSearchParams(location.search);
        const sponsor = q.get('ref') || q.get('new') || '';
        const ctaIdentifier = target.id || target.className || 'unknown-cta';

        tbpLog('web_cta_click', {
          sponsorPresent: sponsor !== '',
          cta: ctaIdentifier,
          capturePhase: true
        });

        copyAndGo();
      }, { capture: true });

      // Fallback: DOMContentLoaded bindings for analytics confirmation
      document.addEventListener('DOMContentLoaded', () => {
        // Wait for dynamic CTAs to be created
        setTimeout(() => {
          const ctaCount = document.querySelectorAll('.js-appstore-btn, [data-appstore], #cta-hero, #cta-pricing, #cta-final, #cta-footer, .app-store-badge').length;
          tbpLog('web_cta_binding_success', { ctaCount });
          console.log(`‚úÖ Capture-phase handler bound to ${ctaCount} CTAs`);
        }, 1000);
      });

      // Smart App Banner: inject dynamically with real app-argument
      // Non-blocking pattern: set immediately with ref, optionally upgrade with token in background
      document.addEventListener('DOMContentLoaded', () => {
        const Q = new URLSearchParams(location.search);
        const sponsor = Q.get('ref') || Q.get('new') || '';
        const t = Q.get('t') || '1';

        // Helper to set/update banner meta tag
        function setBanner(url) {
          let tag = document.querySelector('meta[name="apple-itunes-app"]');
          if (!tag) {
            tag = document.createElement('meta');
            tag.setAttribute('name', 'apple-itunes-app');
            document.head.appendChild(tag);
          }
          tag.setAttribute('content', `app-id=6751211622, app-argument=${url}`);
          console.log('‚úÖ Smart App Banner configured:', url);
        }

        // Immediately set banner with ref-only (fast path - don't block on token)
        const argUrlRefOnly = `https://teambuildpro.com/claim.html?ref=${encodeURIComponent(sponsor)}&t=${encodeURIComponent(t)}&_ul=1`;
        setBanner(argUrlRefOnly);

        // Optional: best-effort upgrade with token in background (don't await)
        if (sponsor) {
          fetch(`${TBP_FN_BASE}/issueReferralV2`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ sponsorCode: sponsor, t, source: 'smart_app_banner' })
          })
          .then(r => r.json())
          .then(j => {
            if (j && j.token) {
              const argUrlWithToken = `${argUrlRefOnly}&tkn=${encodeURIComponent(j.token)}`;
              setBanner(argUrlWithToken);
            }
          })
          .catch(() => {
            // Silently fail - ref-only banner already set
          });
        }
      });
    </script>

    <!-- Patch A: Internal test banner (shows only with ?debug=1) -->
    <style>
      #tbp-debug-banner {
        position: fixed; top: 0; left: 0; right: 0;
        background: #1a3cff; color: #fff; z-index: 10001;
        font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        padding: 8px 12px; display: none;
        box-shadow: 0 2px 10px rgba(0,0,0,.15);
      }
      #tbp-debug-banner a { color:#fff; text-decoration: underline; }
    </style>
    <div id="tbp-debug-banner">
      <strong>Internal Test Mode</strong> ‚Äî CTAs will open <code>/claim.html</code> (not the App Store) to exercise referral handling.
      <span style="margin-left:10px">Remove <code>?debug=1</code> to return to normal.</span>
      <span style="float:right"><a href="#" id="tbp-exit-debug">Exit</a></span>
    </div>
    <script>
      (function(){
        const Q = new URLSearchParams(location.search);
        const isDebug = Q.get('debug') === '1';
        if (!isDebug) return;
        const bar = document.getElementById('tbp-debug-banner');
        bar.style.display = 'block';
        document.getElementById('tbp-exit-debug').onclick = (e)=>{
          e.preventDefault();
          Q.delete('debug');
          const base = location.origin + location.pathname + (Q.toString() ? ('?' + Q.toString()) : '');
          history.replaceState(null, '', base);
          location.reload();
        };
      })();
    </script>

    <!-- Downline Animation Script -->
    <script src="js/downline-animation.js"></script>

</body>

</html>