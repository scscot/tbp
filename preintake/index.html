<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V5DR80KWBP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-V5DR80KWBP');
    </script>
    <title>AI-Powered Legal Intake | PreIntake.ai</title>
    <meta name="description" content="Pre-screen every inquiry before it reaches your firm. AI-powered intake that assesses and delivers each inquiry with a case summary, qualification rating, and recommendation.">
    <meta name="keywords" content="legal intake software, intelligent legal intake, law firm client intake, automated legal screening, legal chatbot, virtual receptionist law firm, client intake automation, legal CRM integration, inquiry screening software">
    <meta name="author" content="PreIntake.ai">
    <link rel="canonical" href="https://preintake.ai/">
    <link rel="icon" type="image/svg+xml" href="images/icon.svg">
    <link rel="apple-touch-icon" href="images/icon.svg">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://preintake.ai/">
    <meta property="og:title" content="AI-Powered Legal Intake | PreIntake.ai">
    <meta property="og:description" content="Pre-screen every inquiry before it reaches your firm. AI-powered intake that assesses and delivers each inquiry with a case summary, qualification rating, and recommendation.">
    <meta property="og:image" content="https://preintake.ai/images/og-image.png">
    <meta property="og:site_name" content="PreIntake.ai">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://preintake.ai/">
    <meta name="twitter:title" content="AI-Powered Legal Intake | PreIntake.ai">
    <meta name="twitter:description" content="Pre-screen every inquiry before it reaches your firm. AI-powered intake that assesses and delivers each inquiry with a case summary, qualification rating, and recommendation.">
    <meta name="twitter:image" content="https://preintake.ai/images/og-image.png">

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "PreIntake.ai",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web",
        "description": "AI-powered legal intake that delivers complete case summaries, qualification assessments, and recommendations on every inquiry",
        "url": "https://preintake.ai",
        "offers": {
            "@type": "Offer",
            "price": "99.00",
            "priceCurrency": "USD",
            "priceValidUntil": "2026-12-31",
            "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.9",
            "ratingCount": "47"
        },
        "provider": {
            "@type": "Organization",
            "name": "PreIntake.ai",
            "url": "https://preintake.ai"
        }
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Shared Header/Footer Components -->
    <script src="js/components.js"></script>
    <style>
        /* Page-specific overrides can go here if needed */
    </style>
</head>
<body>
    <!-- Header -->
    <div id="preintake-header"></div>

    <!-- Campaign Welcome Banner (shown for ?demo= visitors) -->
    <div class="campaign-welcome" id="campaign-welcome">
        <p class="campaign-welcome-text">Welcome, <span id="campaign-firm-name">Your Firm</span>!</p>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-content">
            <div class="hero-badge">AI-Powered Legal Intake</div>
            <h1>Pre-Screen Every Inquiry <br class="desktop-only"><span>Before They Reach Your Firm</span></h1>
            <p class="hero-subtitle">
                Every inquiry assessed and delivered with a case summary tailored to your firm's practice area, a qualification rating, and a clear next-step recommendation‚Äîqualified, needs review, or not a fit.
            </p>
            <p class="hero-privacy"><strong>Zero Data Retention</strong> ‚Äî Inquiries processed and delivered, never stored.</p>
            <p class="hero-privacy">Branded to your firm. Seamless for your clients.</p>

            <!-- Campaign Hero CTA (shown for ?demo= visitors) -->
            <a href="#" class="hero-cta campaign-hero-cta" id="campaign-hero-cta" style="display: none;">
                Your demo is ready ‚Üí try it now!
            </a>

            <!-- Default Hero CTA (shown for non-campaign visitors) -->
            <a href="#demo" class="hero-cta" id="default-hero-cta">
                Create Your Custom Demo
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
            </a>
        </div>
    </section>

    <!-- Routing Section -->
    <section class="section section-dark">
        <div class="container">
            <div class="section-header">
                <h2>Intelligent Inquiry Assessment</h2>
                <p>Every inquiry is reviewed and assessed automatically. Your staff knows exactly how to prioritize each one.</p>
            </div>
            <div class="routing-grid">
                <div class="routing-card green">
                    <div class="routing-badge">GREEN</div>
                    <h3>Strong Case Indicators</h3>
                    <p>Clear liability, documented injuries, within SOL, no existing representation.</p>
                    <div class="routing-action">‚Üí Instant Calendar Booking</div>
                </div>
                <div class="routing-card yellow">
                    <div class="routing-badge">YELLOW</div>
                    <h3>Needs Documentation</h3>
                    <p>Promising case but missing key documents or unclear on certain facts.</p>
                    <div class="routing-action">‚Üí Queued for Records Review</div>
                </div>
                <div class="routing-card red">
                    <div class="routing-badge">RED</div>
                    <h3>Not a Fit</h3>
                    <p>Outside SOL, wrong jurisdiction, existing representation, or clear disqualifier.</p>
                    <div class="routing-action">‚Üí Inquiry Informed + Full Details Delivered</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Practice Areas -->
    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>Built Around Your Practice Areas</h2>
                <p>We configure custom intake logic based on how your firm evaluates cases. The practice areas shown below are examples of how PreIntake.ai adapts to different legal disciplines.</p>
            </div>
            <div class="practice-grid">
                <div class="practice-card">
                    <h3><span>üöó</span> Personal Injury</h3>
                    <ul>
                        <li>Vehicle accidents (Car, Motorcycle, Truck)</li>
                        <li>Rideshare incidents (Uber/Lyft)</li>
                        <li>Premises liability, Dog bites</li>
                    </ul>
                    <div class="practice-card-screening">Checks: SOL, fault, injuries, insurance, representation</div>
                </div>
                <div class="practice-card">
                    <h3><span>üåé</span> Immigration</h3>
                    <ul>
                        <li>Family-based (spouse, parent, sibling)</li>
                        <li>Employment-based (H-1B, L-1, PERM)</li>
                        <li>Asylum, VAWA, U-visa</li>
                    </ul>
                    <div class="practice-card-screening">Checks: Visa status, timeline, bars, violations</div>
                </div>
                <div class="practice-card">
                    <h3><span>üë®‚Äçüë©‚Äçüëß</span> Family Law</h3>
                    <ul>
                        <li>Divorce (contested/uncontested)</li>
                        <li>Child custody and support</li>
                        <li>Protective orders</li>
                    </ul>
                    <div class="practice-card-screening">Checks: Jurisdiction, children, assets, urgency</div>
                </div>
                <div class="practice-card">
                    <h3><span>üí≥</span> Bankruptcy</h3>
                    <ul>
                        <li>Chapter 7 (liquidation)</li>
                        <li>Chapter 13 (reorganization)</li>
                        <li>Means test pre-qualification</li>
                    </ul>
                    <div class="practice-card-screening">Checks: Income, debt type, prior filings</div>
                </div>
                <div class="practice-card">
                    <h3><span>‚öñÔ∏è</span> Criminal Defense</h3>
                    <ul>
                        <li>Misdemeanor and felony defense</li>
                        <li>DUI/DWI</li>
                        <li>Federal crimes</li>
                    </ul>
                    <div class="practice-card-screening">Checks: Charges, court dates, bail, representation</div>
                </div>
                <div class="practice-card">
                    <h3><span>üìä</span> Tax Litigation</h3>
                    <ul>
                        <li>IRS disputes and audits</li>
                        <li>State tax agency conflicts</li>
                        <li>Offer in Compromise</li>
                    </ul>
                    <div class="practice-card-screening">Checks: Tax type, amount, procedural posture</div>
                </div>
            </div>
        </div>
    </section>

    <!-- What You Receive Section -->
    <section class="section section-dark">
        <div class="container">
            <div class="section-header">
                <h2>What Your Firm Receives</h2>
                <p>Every intake arrives as a complete, actionable summary‚Äînot a data dump. Here's exactly what lands in your inbox.</p>
            </div>
            <div class="lead-examples">
                <!-- Qualified Lead Example -->
                <div class="lead-card">
                    <div class="lead-card-header qualified">
                        <span class="lead-badge qualified">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                            Qualified
                        </span>
                        <span class="lead-card-meta">Confidence: high ¬∑ Schedule Consultation</span>
                    </div>
                    <div class="lead-card-body">
                        <!-- Contact Information -->
                        <div class="lead-card-section contact-section">
                            <div class="lead-card-section-title">Contact Information</div>
                            <div class="contact-grid">
                                <div class="contact-item">
                                    <span class="contact-label">Name:</span>
                                    <span class="contact-value">Steve Martinez</span>
                                </div>
                                <div class="contact-item">
                                    <span class="contact-label">Phone:</span>
                                    <span class="contact-value">(415) 555-3874</span>
                                </div>
                                <div class="contact-item">
                                    <span class="contact-label">Email:</span>
                                    <span class="contact-value">steve@email.com</span>
                                </div>
                            </div>
                        </div>
                        <!-- Case Summary -->
                        <div class="lead-card-summary">
                            <div class="lead-card-summary-title">Case Summary</div>
                            <p>Received 30-day eviction notice last Friday alleging lease violation. Client believes notice is invalid. Minor alleged violation (plants on balcony). Not currently represented. Located in California. Time-sensitive matter requiring immediate attention.</p>
                        </div>
                        <!-- Case Information -->
                        <div class="lead-card-section">
                            <div class="lead-card-section-title">Case Information</div>
                            <div class="lead-card-details">
                                <div class="lead-detail">
                                    <div class="lead-detail-label">Case Type</div>
                                    <div class="lead-detail-value">Tenant Rights</div>
                                </div>
                                <div class="lead-detail">
                                    <div class="lead-detail-label">Date Occurred</div>
                                    <div class="lead-detail-value">Last Friday</div>
                                </div>
                            </div>
                        </div>
                        <!-- Key Factors -->
                        <div class="lead-card-factors">
                            <div class="lead-card-section-title">Key Factors</div>
                            <div class="factor-pills">
                                <span class="factor-pill positive">‚úì Recent eviction notice</span>
                                <span class="factor-pill positive">‚úì Believes notice invalid</span>
                                <span class="factor-pill positive">‚úì Within service area</span>
                                <span class="factor-pill positive">‚úì Not represented</span>
                            </div>
                        </div>
                    </div>
                    <div class="lead-card-transcript" id="transcript-qualified">
                        <div class="lead-card-transcript-title">Full Conversation Transcript</div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Hello! I'm here to help you with a free case evaluation. To get started, may I have your name?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">Steve:</div>
                            <div class="transcript-text">Steve Martinez</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Thank you, Steve. Could you briefly describe what happened and why you're seeking legal help?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">Steve:</div>
                            <div class="transcript-text">I got a 30-day eviction notice last Friday. They're saying I violated my lease but I think it's bogus.</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">I understand. What reason did they give for the alleged lease violation?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">Steve:</div>
                            <div class="transcript-text">They said I have plants on my balcony which is apparently not allowed. But I've had them there for 2 years and no one said anything.</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Are you currently represented by an attorney in this matter?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">Steve:</div>
                            <div class="transcript-text">No, not yet. That's why I'm reaching out.</div>
                        </div>
                    </div>
                    <div class="lead-card-footer">
                        <a href="javascript:void(0)" class="transcript-toggle" onclick="toggleTranscript('transcript-qualified', this)">View Full Transcript ‚Üí</a>
                        <span class="lead-card-time">Delivered via email or CRM</span>
                    </div>
                </div>

                <!-- Declined Lead Example -->
                <div class="lead-card">
                    <div class="lead-card-header declined">
                        <span class="lead-badge declined">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            Not a Fit
                        </span>
                        <span class="lead-card-meta declined-meta">Reason: SOL exceeded</span>
                    </div>
                    <div class="lead-card-body">
                        <!-- Contact Information -->
                        <div class="lead-card-section contact-section">
                            <div class="lead-card-section-title">Contact Information</div>
                            <div class="contact-grid">
                                <div class="contact-item">
                                    <span class="contact-label">Name:</span>
                                    <span class="contact-value">James Wilson</span>
                                </div>
                                <div class="contact-item">
                                    <span class="contact-label">Phone:</span>
                                    <span class="contact-value">(510) 555-9821</span>
                                </div>
                                <div class="contact-item">
                                    <span class="contact-label">Email:</span>
                                    <span class="contact-value">jwilson@email.com</span>
                                </div>
                            </div>
                        </div>
                        <!-- Assessment Rationale -->
                        <div class="lead-card-summary declined-summary">
                            <div class="lead-card-summary-title">Assessment Rationale</div>
                            <p>Incident occurred 3 years ago. Statute of limitations has expired for premises liability claims in this jurisdiction. Caller was unaware of time limits. Advised to consult with attorney regarding potential exceptions.</p>
                        </div>
                        <!-- Case Information -->
                        <div class="lead-card-section">
                            <div class="lead-card-section-title">Case Information</div>
                            <div class="lead-card-details">
                                <div class="lead-detail">
                                    <div class="lead-detail-label">Case Type</div>
                                    <div class="lead-detail-value">Personal Injury</div>
                                </div>
                                <div class="lead-detail">
                                    <div class="lead-detail-label">Date Occurred</div>
                                    <div class="lead-detail-value">Dec 2022</div>
                                </div>
                                <div class="lead-detail">
                                    <div class="lead-detail-label">SOL Status</div>
                                    <div class="lead-detail-value" style="color: #ef4444;">Expired</div>
                                </div>
                            </div>
                        </div>
                        <!-- Key Factors -->
                        <div class="lead-card-factors">
                            <div class="lead-card-section-title">Key Factors</div>
                            <div class="factor-pills">
                                <span class="factor-pill negative">‚úó SOL exceeded (3+ years)</span>
                                <span class="factor-pill negative">‚úó No documentation</span>
                                <span class="factor-pill neutral">‚óã No prior treatment</span>
                            </div>
                        </div>
                    </div>
                    <div class="lead-card-transcript" id="transcript-declined">
                        <div class="lead-card-transcript-title">Full Conversation Transcript</div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Hello! I'm here to help you with a free case evaluation. To get started, may I have your name?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">James:</div>
                            <div class="transcript-text">James Wilson</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Thank you, James. Could you briefly describe what happened?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">James:</div>
                            <div class="transcript-text">I slipped and fell at a grocery store back in December 2022. Hurt my back pretty bad.</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">I'm sorry to hear that. Did you receive any medical treatment for your injuries?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">James:</div>
                            <div class="transcript-text">No, I couldn't afford it at the time. I just rested at home.</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role ai">Intake:</div>
                            <div class="transcript-text">Did you document the incident? For example, did you file an incident report with the store or take photos?</div>
                        </div>
                        <div class="transcript-message">
                            <div class="transcript-role user">James:</div>
                            <div class="transcript-text">No, I didn't think to do that. I just wanted to get out of there.</div>
                        </div>
                    </div>
                    <div class="lead-card-footer">
                        <a href="javascript:void(0)" class="transcript-toggle" onclick="toggleTranscript('transcript-declined', this)">View Full Transcript ‚Üí</a>
                        <span class="lead-card-time">Delivered via email or CRM</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Bar (HIDDEN)
    <div class="stats-bar">
        <div class="stats-container">
            <div class="stat">
                <div class="stat-number">Up to 70%</div>
                <div class="stat-label">of intake submissions are often unqualified</div>
            </div>
            <div class="stat">
                <div class="stat-number">$25-50</div>
                <div class="stat-label">each unqualified call can cost in staff time</div>
            </div>
            <div class="stat">
                <div class="stat-number">5-10+</div>
                <div class="stat-label">disconnected tools many firms rely on</div>
            </div>
            <div class="stat">
                <div class="stat-number">24/7</div>
                <div class="stat-label">intake coverage without hiring staff</div>
            </div>
        </div>
    </div>
    -->

    <!-- Problem Section (HIDDEN)
    <section class="section section-dark">
        <div class="container">
            <div class="section-header">
                <h2>Generic Intake Tools Don't Work</h2>
                <p>Forms and chatbots flood your inbox. Your staff wastes hours on inquiries that never sign. Real cases slip through the cracks.</p>
            </div>
            <div class="problem-grid">
                <div class="problem-card">
                    <div class="problem-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3>No Legal Training</h3>
                    <p>Generic chatbots don't understand SOL deadlines, jurisdiction issues, or practice-specific disqualifiers.</p>
                </div>
                <div class="problem-card">
                    <div class="problem-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <h3>Raw Data Dumps</h3>
                    <p>Form submissions give you data. They don't tell you if the case is worth pursuing or why.</p>
                </div>
                <div class="problem-card">
                    <div class="problem-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <h3>No After-Hours Coverage</h3>
                    <p>Contact forms sit in your inbox until morning. Hot inquiries go cold while you sleep‚Äîor call another firm.</p>
                </div>
            </div>
        </div>
    </section>
    -->

    <!-- CRM Integration Note (HIDDEN)
    <div class="crm-note">
        <div class="container">
            <p>Already use Lawmatics, Clio, or Filevine? PreIntake.ai integrates seamlessly‚Äîreviewed inquiries flow directly into your existing system.</p>
        </div>
    </div>
    -->

    <!-- Trust & Privacy Section -->
    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>Your Data, Your Control</h2>
                <p>Unlike competitors who store everything, PreIntake.ai is built with privacy at its core.</p>
            </div>
            <div class="trust-grid">
                <div class="trust-card">
                    <div class="trust-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                    <h3>Zero Data Retention</h3>
                    <p>We never store client intake data. Inquiries are processed in real-time, delivered to you, then immediately discarded. Your clients' information never sits on our servers.</p>
                </div>
                <div class="trust-card">
                    <div class="trust-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h3>Real-Time Delivery</h3>
                    <p>All reviewed inquiries arrive in your inbox or CRM within seconds of intake completion. No batching, no delays‚Äîimmediate action on hot inquiries.</p>
                </div>
                <div class="trust-card">
                    <div class="trust-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                    </div>
                    <h3>Your Branded Experience</h3>
                    <p>The intake widget embeds seamlessly on your website with your branding. Clients see your firm, not ours. You control the look and feel.</p>
                </div>
            </div>

        </div>
    </section>

    <!-- 3 Simple Steps Section -->
    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>Get Started in 3 Simple Steps</h2>
                <p>From demo to live intake in minutes, not weeks.</p>
            </div>
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Request Your Custom Demo</h3>
                        <p>Enter your website URL. We analyze your practice areas and build a personalized AI intake demo‚Äîfree, in under 5 minutes.</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Create Your Account</h3>
                        <p>Love what you see? Activate your account and we'll finalize your custom intake configuration for production use.</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Add One Line of Code</h3>
                        <p>Copy a single script tag to your website. That's it‚Äîyour AI intake is live and reviewing inquiries 24/7.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section class="section section-dark" id="pricing">
        <div class="container">
            <div class="section-header">
                <h2>Simple, Transparent Pricing</h2>
                <p>One-time setup, straightforward monthly subscription.<br />No hidden fees. Cancel anytime.</p>
            </div>
            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="pricing-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                    <div class="pricing-label">One-Time Setup</div>
                    <div class="pricing-amount">$149</div>
                    <div class="pricing-desc">Custom AI intake tailored to your firm's practice areas, branding, and assessment criteria</div>
                </div>
                <div class="pricing-card featured">
                    <div class="pricing-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </div>
                    <div class="pricing-label">Monthly Subscription</div>
                    <div class="pricing-amount">$99<span>/mo</span></div>
                    <div class="pricing-desc">Unlimited AI-powered intake reviews, inquiry routing, and real-time delivery via email or CRM</div>
                </div>
            </div>
            <p style="text-align: center; margin-top: 2rem; color: #64748b; font-size: 0.95rem; max-width: 500px; margin-left: auto; margin-right: auto;">
                Expert-level review tailored to your practice area. Every inquiry arrives in your inbox with a complete assessment. Cancel anytime‚Äîno long-term contracts.
            </p>
            <!-- Get Started CTA (shown for ?demo= visitors) -->
            <div class="pricing-cta-container" id="pricing-cta-container" style="display: none;">
                <a href="#" class="pricing-get-started-btn" id="pricing-get-started-btn">
                    Get Started
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Demo CTA Section -->
    <section class="cta-section" id="demo">
        <div class="container">
            <h2 id="demo-section-title">Get Your Custom Demo</h2>

            <!-- Campaign CTA View (shown for ?demo= visitors instead of form) -->
            <div class="campaign-cta-view" id="campaign-cta-view">
                <h3>Your Personalized Demo is Ready</h3>
                <p>See exactly how AI-powered intake will work for your firm‚Äîusing your branding and practice areas.</p>
                <a href="#" class="campaign-demo-btn" id="campaign-demo-btn">
                    See How It Works
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </a>
            </div>

            <!-- Campaign Loading State -->
            <div class="campaign-loading" id="campaign-loading" style="display: none;">
                <div class="campaign-loading-spinner"></div>
                <span>Loading your demo...</span>
            </div>

            <div class="demo-form-container" id="demo-form-container">
                <form class="demo-form" id="demo-form">
                    <div class="form-error" id="form-error"></div>
                    <!-- Honeypot field - hidden from humans, bots will fill it -->
                    <div class="hp-field" aria-hidden="true">
                        <label for="company_fax">Fax Number</label>
                        <input type="text" id="company_fax" name="company_fax" tabindex="-1" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="name">Your Name</label>
                        <input type="text" id="name" name="name" placeholder="Jane Smith" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="jane@smithlaw.com" required>
                    </div>
                    <div class="form-group">
                        <label for="website">Firm Website</label>
                        <input type="url" id="website" name="website" placeholder="https://smithlaw.com" required>
                    </div>
                    <p class="hosted-toggle" style="margin-top: -0.5rem; margin-bottom: 0;">Don't have a website? <a href="#" id="show-hosted-form">Try our hosted solution ‚Üí</a></p>
                    <button type="submit" class="demo-submit" id="submit-btn">Analyze My Website & Build My Demo</button>
                    <p style="color: white; font-style: italic; margin-top: 0.30rem; font-size: 0.9rem;">Demo ready in about a minute.</p>
                </form>
            </div>

            <!-- Hosted Form (for firms without websites) -->
            <div class="demo-form-container" id="hosted-form-container" style="display: none;">
                <form class="demo-form" id="hosted-form">
                    <div class="form-error" id="hosted-form-error"></div>
                    <!-- Honeypot field for spam protection (hidden) -->
                    <div class="honeypot-field" style="position: absolute; left: -9999px; opacity: 0; height: 0; overflow: hidden;">
                        <label for="hosted_company_fax">Fax Number</label>
                        <input type="text" id="hosted_company_fax" name="company_fax" tabindex="-1" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="hosted-name">Your Name</label>
                        <input type="text" id="hosted-name" name="name" placeholder="Jane Smith" required>
                    </div>
                    <div class="form-group">
                        <label for="hosted-email">Email Address</label>
                        <input type="email" id="hosted-email" name="email" placeholder="jane@smithlaw.com" required>
                    </div>
                    <div class="form-group">
                        <label for="hosted-firm-name">Firm Name <span style="font-weight: 400; font-style: italic;">(optional)</span></label>
                        <input type="text" id="hosted-firm-name" name="firmName" placeholder="Smith Law Group">
                    </div>
                    <div class="form-group">
                        <label for="hosted-phone">Phone Number <span style="font-weight: 400; font-style: italic;">(optional)</span></label>
                        <input type="tel" id="hosted-phone" name="phone" placeholder="(555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label for="hosted-state">State</label>
                        <select id="hosted-state" name="state" required>
                            <option value="">Select your state...</option>
                            <option value="Alabama">Alabama</option>
                            <option value="Alaska">Alaska</option>
                            <option value="Arizona">Arizona</option>
                            <option value="Arkansas">Arkansas</option>
                            <option value="California" selected>California</option>
                            <option value="Colorado">Colorado</option>
                            <option value="Connecticut">Connecticut</option>
                            <option value="Delaware">Delaware</option>
                            <option value="Florida">Florida</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Hawaii">Hawaii</option>
                            <option value="Idaho">Idaho</option>
                            <option value="Illinois">Illinois</option>
                            <option value="Indiana">Indiana</option>
                            <option value="Iowa">Iowa</option>
                            <option value="Kansas">Kansas</option>
                            <option value="Kentucky">Kentucky</option>
                            <option value="Louisiana">Louisiana</option>
                            <option value="Maine">Maine</option>
                            <option value="Maryland">Maryland</option>
                            <option value="Massachusetts">Massachusetts</option>
                            <option value="Michigan">Michigan</option>
                            <option value="Minnesota">Minnesota</option>
                            <option value="Mississippi">Mississippi</option>
                            <option value="Missouri">Missouri</option>
                            <option value="Montana">Montana</option>
                            <option value="Nebraska">Nebraska</option>
                            <option value="Nevada">Nevada</option>
                            <option value="New Hampshire">New Hampshire</option>
                            <option value="New Jersey">New Jersey</option>
                            <option value="New Mexico">New Mexico</option>
                            <option value="New York">New York</option>
                            <option value="North Carolina">North Carolina</option>
                            <option value="North Dakota">North Dakota</option>
                            <option value="Ohio">Ohio</option>
                            <option value="Oklahoma">Oklahoma</option>
                            <option value="Oregon">Oregon</option>
                            <option value="Pennsylvania">Pennsylvania</option>
                            <option value="Rhode Island">Rhode Island</option>
                            <option value="South Carolina">South Carolina</option>
                            <option value="South Dakota">South Dakota</option>
                            <option value="Tennessee">Tennessee</option>
                            <option value="Texas">Texas</option>
                            <option value="Utah">Utah</option>
                            <option value="Vermont">Vermont</option>
                            <option value="Virginia">Virginia</option>
                            <option value="Washington">Washington</option>
                            <option value="West Virginia">West Virginia</option>
                            <option value="Wisconsin">Wisconsin</option>
                            <option value="Wyoming">Wyoming</option>
                            <option value="District of Columbia">District of Columbia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hosted-practice-area">Practice Area(s) <span style="font-weight: 400; font-style: italic;">‚Äî Hold Ctrl/Cmd to select multiple</span></label>
                        <select id="hosted-practice-area" name="practiceArea" multiple required size="5">
                            <option value="Personal Injury">Personal Injury</option>
                            <option value="Immigration">Immigration</option>
                            <option value="Family Law">Family Law</option>
                            <option value="Criminal Defense">Criminal Defense</option>
                            <option value="Bankruptcy">Bankruptcy</option>
                            <option value="Estate Planning">Estate Planning</option>
                            <option value="Employment Law">Employment Law</option>
                            <option value="Workers Compensation">Workers Compensation</option>
                            <option value="Real Estate">Real Estate</option>
                            <option value="Tax Law">Tax Law</option>
                            <option value="Business Law">Business Law</option>
                            <option value="General Practice">General Practice</option>
                        </select>
                    </div>
                    <p class="hosted-toggle" style="margin-top: -0.5rem; margin-bottom: 0;">Have a website? <a href="#" id="show-website-form">Use website-based setup ‚Üí</a></p>
                    <button type="submit" class="demo-submit" id="hosted-submit-btn">Build My Hosted Demo</button>
                    <p style="color: white; font-style: italic; margin-top: 0.30rem; font-size: 0.9rem;">Demo ready in under a minute.</p>
                </form>
            </div>

            <!-- Analyzing state (hidden by default) -->
            <div class="demo-form-container analyzing-state" id="analyzing-state" style="display: none;">
                <div class="analyzing-spinner"></div>
                <h3>Analyzing Your Website</h3>
                <p>We're scanning your firm's website to understand your practice areas and intake requirements.</p>
                <div class="analyzing-steps">
                    <div class="analyzing-step active" id="step-scanning">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <span>Scanning website pages...</span>
                    </div>
                    <div class="analyzing-step" id="step-extracting">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                        </div>
                        <span>Identifying practice areas...</span>
                    </div>
                    <div class="analyzing-step" id="step-configuring">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <span>Preparing confirmation...</span>
                    </div>
                </div>
            </div>

            <!-- Progress state for unified flow (hidden by default) -->
            <div class="demo-form-container analyzing-state" id="progress-state" style="display: none;">
                <div class="analyzing-spinner"></div>
                <h3>Building Your Demo</h3>
                <p>This typically takes about 60 seconds. You'll receive an email when your demo is ready.</p>
                <div class="analyzing-steps">
                    <div class="analyzing-step active" id="progress-validating">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span>Validating your information...</span>
                    </div>
                    <div class="analyzing-step" id="progress-analyzing">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <span>Analyzing your website...</span>
                    </div>
                    <div class="analyzing-step" id="progress-researching">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                        </div>
                        <span>Identifying practice areas...</span>
                    </div>
                    <div class="analyzing-step" id="progress-generating">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                            </svg>
                        </div>
                        <span>Building your personalized demo...</span>
                    </div>
                    <div class="analyzing-step" id="progress-sending">
                        <div class="analyzing-step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <span>Sending your demo link...</span>
                    </div>
                </div>
            </div>

            <!-- Building demo state (hidden by default) -->
            <div class="demo-form-container building-demo" id="building-demo" style="display: none;">
                <div class="demo-success-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 40px; height: 40px;">
                        <path d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z" />
                        <path d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286A48.4 48.4 0 016 13.18v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z" />
                        <path d="M4.462 19.462c.42-.419.753-.89 1-1.394.453.213.902.434 1.347.661a6.743 6.743 0 01-1.286 1.794.75.75 0 11-1.06-1.06z" />
                    </svg>
                </div>
                <h3>Building Your Custom Demo</h3>
                <p>We're generating your personalized AI intake experience.</p>
                <div class="building-progress">
                    <div class="spinner-small"></div>
                    <span id="building-progress-text">Generating your demo...</span>
                </div>
            </div>

            <!-- Verification pending state (hidden by default) -->
            <div class="demo-form-container verification-pending" id="verification-pending" style="display: none;">
                <div class="demo-success-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <h3>Check Your Email</h3>
                <p>We've sent a verification link to <strong id="verification-email"></strong></p>
                <p class="check-email">Click the link in the email to verify your address and launch your custom demo.</p>
                <p style="font-size: 0.85rem; margin-top: 1.5rem; color: var(--text-muted);">The link will expire in 24 hours. If you don't see the email, check your spam folder.</p>
                <p style="font-size: 0.85rem; color: var(--text-muted);">Didn't receive the email? <a href="#" onclick="location.reload(); return false;" style="color: #c9a962;">Try again</a></p>
            </div>

            <!-- Fallback success state - shown only if auto-redirect fails -->
            <div class="demo-form-container demo-success" id="demo-success" style="display: none;">
                <div class="demo-success-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h3>Demo Generation in Progress</h3>
                <p>Your custom AI intake demo is being built. This may take a few minutes for complex sites.</p>
                <p class="check-email">You'll receive an email with your private demo link shortly.</p>
                <p style="font-size: 0.85rem; margin-top: 1rem; color: var(--text-muted);">No need to wait here‚Äîwe'll send the link to your email when it's ready.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <div id="preintake-footer"></div>

    <!-- Practice Area Confirmation Modal -->
    <div class="modal-overlay" id="practice-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Practice Areas Detected</h3>
                <p>We found these practice areas on your website. Confirm they're correct or make changes.</p>
            </div>
            <div class="modal-body">
                <div class="practice-tags" id="practice-tags">
                    <!-- Tags will be dynamically inserted here -->
                </div>
                <div class="add-practice-area">
                    <input type="text" class="add-practice-input" id="add-practice-input" placeholder="Add a practice area..." maxlength="50">
                    <button type="button" class="add-practice-btn" id="add-practice-btn">Add</button>
                </div>
                <div class="primary-area-selector">
                    <label class="primary-area-label">Primary Practice Area</label>
                    <select class="primary-area-select" id="primary-area-select">
                        <!-- Options will be dynamically inserted here -->
                    </select>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-btn modal-btn-secondary" id="modal-cancel-btn">Back</button>
                <button type="button" class="modal-btn modal-btn-primary" id="modal-confirm-btn">Confirm & Build Demo</button>
            </div>
        </div>
    </div>

    <!-- Validation Error Modal -->
    <div class="modal-overlay" id="validation-error-modal">
        <div class="modal-content" style="max-width: 420px;">
            <div class="modal-header">
                <div style="font-size: 48px; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                <h3 style="color: #dc2626;">Website Validation Failed</h3>
            </div>
            <div class="modal-body" style="text-align: center; padding: 1rem 1.5rem 1.5rem;">
                <p id="validation-error-message" style="color: #475569; font-size: 1rem; line-height: 1.6;"></p>
            </div>
            <div class="modal-actions" style="justify-content: center;">
                <button type="button" class="modal-btn modal-btn-primary" onclick="closeValidationModal()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Function endpoints
        const SUBMIT_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/submitDemoRequest';
        const STATUS_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/getPreIntakeFirmStatus';
        const CONFIRM_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/confirmPracticeAreas';
        const VERIFY_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/verifyDemoEmail';
        const CONFIG_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/getWidgetConfig';

        // Request timeout (30 seconds)
        const DEFAULT_TIMEOUT = 30000;

        /**
         * Fetch with timeout support
         */
        async function fetchWithTimeout(url, options = {}, timeout = DEFAULT_TIMEOUT) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);

            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                return response;
            } finally {
                clearTimeout(timeoutId);
            }
        }

        // Rate limiting configuration
        const RATE_LIMIT_KEY = 'preintake_submissions';
        const MAX_SUBMISSIONS_PER_DAY = 3;

        // State management
        let currentLeadId = null;
        let practiceAreas = [];
        let primaryArea = null;

        // Check rate limit (client-side)
        function checkRateLimit() {
            try {
                const stored = localStorage.getItem(RATE_LIMIT_KEY);
                if (!stored) return { allowed: true, remaining: MAX_SUBMISSIONS_PER_DAY };

                const data = JSON.parse(stored);
                const today = new Date().toDateString();

                if (data.date !== today) {
                    return { allowed: true, remaining: MAX_SUBMISSIONS_PER_DAY };
                }

                const remaining = MAX_SUBMISSIONS_PER_DAY - data.count;
                return { allowed: remaining > 0, remaining: Math.max(0, remaining) };
            } catch (e) {
                return { allowed: true, remaining: MAX_SUBMISSIONS_PER_DAY };
            }
        }

        // Record submission for rate limiting
        function recordSubmission() {
            try {
                const today = new Date().toDateString();
                const stored = localStorage.getItem(RATE_LIMIT_KEY);
                let data = stored ? JSON.parse(stored) : { date: today, count: 0 };

                if (data.date !== today) {
                    data = { date: today, count: 0 };
                }

                data.count++;
                localStorage.setItem(RATE_LIMIT_KEY, JSON.stringify(data));
            } catch (e) {
                // Silently fail if localStorage not available
            }
        }

        // Email validation function
        function isValidEmail(email) {
            const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;

            if (!emailRegex.test(email)) {
                return { valid: false, reason: 'Please enter a valid email address (e.g., jane@smithlaw.com)' };
            }

            const domain = email.split('@')[1].toLowerCase();
            const typoPatterns = [
                { pattern: /^g{1,2}mail\./, suggestion: 'gmail.com' },
                { pattern: /^gmial\./, suggestion: 'gmail.com' },
                { pattern: /^gmal\./, suggestion: 'gmail.com' },
                { pattern: /^gamil\./, suggestion: 'gmail.com' },
                { pattern: /^yahooo?\./, suggestion: 'yahoo.com' },
                { pattern: /^yaho\./, suggestion: 'yahoo.com' },
                { pattern: /^hotmai?l\./, suggestion: 'hotmail.com' },
                { pattern: /^outloo?k\./, suggestion: 'outlook.com' }
            ];

            for (const typo of typoPatterns) {
                if (typo.pattern.test(domain) && domain !== typo.suggestion) {
                    return { valid: false, reason: `Did you mean ${email.split('@')[0]}@${typo.suggestion}?` };
                }
            }

            const fakeDomains = ['test.com', 'example.com', 'fake.com', 'asdf.com', 'aaa.com', 'abc.com'];
            if (fakeDomains.includes(domain)) {
                return { valid: false, reason: 'Please enter your actual business email address.' };
            }

            return { valid: true };
        }

        // =====================================
        // Practice Area Tag Management
        // =====================================

        function renderPracticeTags() {
            const container = document.getElementById('practice-tags');
            const primarySelect = document.getElementById('primary-area-select');

            if (practiceAreas.length === 0) {
                container.innerHTML = '<div class="practice-tags-empty">No practice areas detected. Add at least one practice area.</div>';
                primarySelect.innerHTML = '<option value="">-- Select primary area --</option>';
                return;
            }

            container.innerHTML = practiceAreas.map(area => `
                <span class="practice-tag ${area === primaryArea ? 'primary' : ''}">
                    ${area}
                    <button type="button" class="practice-tag-remove" onclick="removePracticeArea('${area.replace(/'/g, "\\'")}')">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </span>
            `).join('');

            // Update primary area dropdown
            primarySelect.innerHTML = practiceAreas.map(area =>
                `<option value="${area}" ${area === primaryArea ? 'selected' : ''}>${area}</option>`
            ).join('');
        }

        function addPracticeArea(areaName) {
            const name = areaName.trim();
            if (!name) return;
            if (practiceAreas.length >= 10) {
                alert('Maximum of 10 practice areas allowed.');
                return;
            }
            if (practiceAreas.some(a => a.toLowerCase() === name.toLowerCase())) {
                return; // Already exists
            }
            practiceAreas.push(name);
            if (practiceAreas.length === 1) {
                primaryArea = name; // First area becomes primary
            }
            renderPracticeTags();
        }

        function removePracticeArea(areaName) {
            practiceAreas = practiceAreas.filter(a => a !== areaName);
            if (primaryArea === areaName) {
                primaryArea = practiceAreas[0] || null;
            }
            renderPracticeTags();
            updateConfirmButton();
        }

        function setPrimaryArea(areaName) {
            if (practiceAreas.includes(areaName)) {
                primaryArea = areaName;
                renderPracticeTags();
            }
        }

        function updateConfirmButton() {
            const confirmBtn = document.getElementById('modal-confirm-btn');
            confirmBtn.disabled = practiceAreas.length === 0;
        }

        // =====================================
        // Modal Management
        // =====================================

        function showModal() {
            const modal = document.getElementById('practice-modal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function hideModal() {
            const modal = document.getElementById('practice-modal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // =====================================
        // Analysis Step Animation
        // =====================================

        function updateAnalysisStep(step) {
            const steps = ['step-scanning', 'step-extracting', 'step-configuring'];
            steps.forEach((stepId, index) => {
                const stepEl = document.getElementById(stepId);
                if (index < step) {
                    stepEl.classList.remove('active');
                    stepEl.classList.add('complete');
                } else if (index === step) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('complete');
                } else {
                    stepEl.classList.remove('active', 'complete');
                }
            });
        }

        // =====================================
        // Progress Step Animation (Unified Flow)
        // =====================================

        function updateProgressStep(step) {
            const steps = ['progress-validating', 'progress-analyzing', 'progress-researching', 'progress-generating', 'progress-sending'];
            steps.forEach((stepId, index) => {
                const stepEl = document.getElementById(stepId);
                if (!stepEl) return;
                if (index < step) {
                    stepEl.classList.remove('active');
                    stepEl.classList.add('complete');
                } else if (index === step) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('complete');
                } else {
                    stepEl.classList.remove('active', 'complete');
                }
            });
        }

        // Set progress step labels for hosted forms (no website to analyze)
        function setHostedProgressLabels() {
            const stepLabels = {
                'progress-validating': 'Validating your information...',
                'progress-analyzing': 'Configuring your practice areas...',
                'progress-researching': 'Building your personalized demo...',
                'progress-generating': 'Finalizing demo content...',
                'progress-sending': 'Sending your demo link...'
            };
            for (const [stepId, label] of Object.entries(stepLabels)) {
                const stepEl = document.getElementById(stepId);
                if (stepEl) {
                    const spanEl = stepEl.querySelector('span');
                    if (spanEl) spanEl.textContent = label;
                }
            }
        }

        // Reset progress step labels to website-based defaults
        function setWebsiteProgressLabels() {
            const stepLabels = {
                'progress-validating': 'Validating your information...',
                'progress-analyzing': 'Analyzing your website...',
                'progress-researching': 'Identifying practice areas...',
                'progress-generating': 'Building your personalized demo...',
                'progress-sending': 'Sending your demo link...'
            };
            for (const [stepId, label] of Object.entries(stepLabels)) {
                const stepEl = document.getElementById(stepId);
                if (stepEl) {
                    const spanEl = stepEl.querySelector('span');
                    if (spanEl) spanEl.textContent = label;
                }
            }
        }

        // Map backend status to progress step number
        function getProgressStepFromStatus(status) {
            switch (status) {
                case 'pending': return 0;
                case 'analyzing': return 1;
                case 'researching': return 2;
                case 'generating_demo': return 3;
                case 'demo_ready': return 4;
                default: return 0;
            }
        }

        // =====================================
        // Poll for Auto-Confirmed Demo (Unified Flow)
        // =====================================

        async function pollForAutoConfirmedDemo(leadId, maxAttempts = 60) {
            // Validate leadId
            if (!leadId) {
                console.error('pollForAutoConfirmedDemo: leadId is undefined or empty');
                throw new Error('Invalid lead ID. Please try again.');
            }

            const pollInterval = 2000; // 2 seconds
            let attempts = 0;
            let consecutiveErrors = 0;
            const maxConsecutiveErrors = 5; // Stop after 5 consecutive errors

            while (attempts < maxAttempts) {
                try {
                    const pollUrl = `${STATUS_ENDPOINT}?leadId=${leadId}`;
                    const response = await fetchWithTimeout(pollUrl);

                    if (!response.ok) {
                        console.error(`Poll HTTP error: ${response.status} ${response.statusText}`);
                        consecutiveErrors++;
                        if (consecutiveErrors >= maxConsecutiveErrors) {
                            throw new Error('Unable to check demo status. Please refresh the page.');
                        }
                        attempts++;
                        await new Promise(resolve => setTimeout(resolve, pollInterval));
                        continue;
                    }

                    const data = await response.json();
                    consecutiveErrors = 0; // Reset on success

                    // Update progress step based on status
                    const step = getProgressStepFromStatus(data.status);
                    updateProgressStep(step);

                    // Demo is ready when status is 'demo_ready'
                    if (data.status === 'demo_ready') {
                        updateProgressStep(5); // Show all 5 steps complete (index 5 marks 0-4 as complete)
                        return { success: true, email: data.email };
                    } else if (data.status === 'analysis_failed' || data.status === 'demo_failed') {
                        throw new Error(data.error || 'Something went wrong. Please try again.');
                    }

                } catch (error) {
                    console.error('Poll error:', error.message || error);
                    if (error.message && (error.message.includes('failed') || error.message.includes('Invalid lead'))) {
                        throw error;
                    }
                    consecutiveErrors++;
                    if (consecutiveErrors >= maxConsecutiveErrors) {
                        console.error('Too many consecutive polling errors, stopping');
                        throw new Error('Unable to check demo status. Please refresh the page.');
                    }
                }

                attempts++;
                await new Promise(resolve => setTimeout(resolve, pollInterval));
            }

            // Timeout - but demo might still be processing
            return { success: true, timedOut: true };
        }

        // =====================================
        // Poll for Analysis Results
        // =====================================

        async function pollForAnalysis(leadId, maxAttempts = 60) {
            const pollInterval = 2000; // 2 seconds
            let attempts = 0;

            while (attempts < maxAttempts) {
                try {
                    const response = await fetchWithTimeout(`${STATUS_ENDPOINT}?leadId=${leadId}`);
                    const data = await response.json();

                    // Analysis is complete when status is 'awaiting_confirmation'
                    // (Deep Research has finished and practice areas are available)
                    if (data.status === 'awaiting_confirmation' &&
                        data.practiceAreas && data.practiceAreas.length > 0) {
                        updateAnalysisStep(2); // Show all steps complete
                        return data;
                    } else if (data.status === 'analysis_failed') {
                        throw new Error(data.error || 'Website analysis failed. Please check the URL and try again.');
                    }

                    // Update step animation based on status
                    if (data.status === 'analyzing') {
                        updateAnalysisStep(0); // Scanning
                    } else if (data.status === 'researching') {
                        updateAnalysisStep(1); // Identifying practice areas
                    }

                } catch (error) {
                    console.error('Poll error:', error);
                    if (error.message.includes('analysis failed') || error.message.includes('Website analysis failed')) {
                        throw error;
                    }
                }

                attempts++;
                await new Promise(resolve => setTimeout(resolve, pollInterval));
            }

            throw new Error('Analysis timed out. Please try again.');
        }

        // Poll for demo completion after practice area confirmation
        async function pollForDemoCompletion(leadId, maxAttempts = 90, updateCallback = null) {
            const pollInterval = 2000; // 2 seconds
            let attempts = 0;

            while (attempts < maxAttempts) {
                try {
                    const response = await fetchWithTimeout(`${STATUS_ENDPOINT}?leadId=${leadId}`);
                    const data = await response.json();

                    // Demo is ready when status is 'demo_ready' and demoUrl is available
                    if (data.status === 'demo_ready' && data.demoUrl) {
                        return data;
                    } else if (data.status === 'demo_failed' || data.status === 'analysis_failed') {
                        throw new Error(data.error || 'Demo generation failed. Please try again.');
                    }

                    // Update progress callback if provided
                    if (updateCallback) {
                        updateCallback(data.status, attempts);
                    }

                } catch (error) {
                    console.error('Demo poll error:', error);
                    if (error.message.includes('failed')) {
                        throw error;
                    }
                }

                attempts++;
                await new Promise(resolve => setTimeout(resolve, pollInterval));
            }

            throw new Error('Demo generation timed out. You will receive an email when your demo is ready.');
        }

        // =====================================
        // Main Form Handler
        // =====================================

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('demo-form');
            const formContainer = document.getElementById('demo-form-container');
            const analyzingContainer = document.getElementById('analyzing-state');
            const verificationContainer = document.getElementById('verification-pending');
            const buildingContainer = document.getElementById('building-demo');
            const successContainer = document.getElementById('demo-success');
            const progressContainer = document.getElementById('progress-state');
            const submitBtn = document.getElementById('submit-btn');
            const errorDiv = document.getElementById('form-error');

            // Modal elements
            const addPracticeInput = document.getElementById('add-practice-input');
            const addPracticeBtn = document.getElementById('add-practice-btn');
            const primaryAreaSelect = document.getElementById('primary-area-select');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');

            // Hosted form elements
            const hostedFormContainer = document.getElementById('hosted-form-container');
            const hostedForm = document.getElementById('hosted-form');
            const showHostedFormLink = document.getElementById('show-hosted-form');
            const showWebsiteFormLink = document.getElementById('show-website-form');
            const hostedSubmitBtn = document.getElementById('hosted-submit-btn');
            const hostedErrorDiv = document.getElementById('hosted-form-error');

            // Toggle to hosted form
            showHostedFormLink.addEventListener('click', function(e) {
                e.preventDefault();
                formContainer.style.display = 'none';
                hostedFormContainer.style.display = 'block';
            });

            // Toggle back to website form
            showWebsiteFormLink.addEventListener('click', function(e) {
                e.preventDefault();
                hostedFormContainer.style.display = 'none';
                formContainer.style.display = 'block';
            });

            // Add practice area button handler
            addPracticeBtn.addEventListener('click', function() {
                addPracticeArea(addPracticeInput.value);
                addPracticeInput.value = '';
                updateConfirmButton();
            });

            // Add practice area on Enter key
            addPracticeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addPracticeArea(addPracticeInput.value);
                    addPracticeInput.value = '';
                    updateConfirmButton();
                }
            });

            // Primary area change handler
            primaryAreaSelect.addEventListener('change', function() {
                setPrimaryArea(this.value);
            });

            // Modal cancel button
            modalCancelBtn.addEventListener('click', function() {
                hideModal();
                // Show form again
                analyzingContainer.style.display = 'none';
                formContainer.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            });

            // Modal confirm button
            modalConfirmBtn.addEventListener('click', async function() {
                if (practiceAreas.length === 0) return;

                modalConfirmBtn.disabled = true;
                modalConfirmBtn.textContent = 'Building Demo...';

                try {
                    // Confirm practice areas with backend
                    const response = await fetchWithTimeout(CONFIRM_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            leadId: currentLeadId,
                            practiceAreas: practiceAreas,
                            primaryArea: primaryArea
                        })
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to confirm practice areas');
                    }

                    // Record successful submission
                    recordSubmission();

                    // Hide modal and show building demo state
                    hideModal();
                    analyzingContainer.style.display = 'none';
                    formContainer.style.display = 'none';
                    buildingContainer.style.display = 'block';

                    // Scroll to the building container (which is now visible)
                    buildingContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

                    // Get the progress text element for updates
                    const progressText = document.getElementById('building-progress-text');

                    // Poll for demo completion (no rotating messages - generation is fast ~2 seconds)
                    const demoResult = await pollForDemoCompletion(currentLeadId, 90);

                    // Demo is ready - redirect to demo URL
                    if (demoResult.demoUrl) {
                        // Update UI to show success before redirect
                        if (progressText) {
                            progressText.textContent = 'Demo ready! Redirecting...';
                        }

                        // Brief delay so user sees the success message
                        await new Promise(resolve => setTimeout(resolve, 1000));

                        // Redirect to demo
                        window.location.href = demoResult.demoUrl;
                    } else {
                        // Edge case: demo ready but no URL - show success screen
                        buildingContainer.style.display = 'none';
                        successContainer.style.display = 'block';
                    }

                } catch (error) {
                    // On error or timeout, show success screen as fallback
                    // User will still receive email with demo link
                    console.error('Demo polling error:', error);
                    buildingContainer.style.display = 'none';
                    successContainer.style.display = 'block';

                    // If it's a real error (not timeout), show alert
                    if (!error.message.includes('timed out')) {
                        alert(error.message || 'Something went wrong. Please check your email for the demo link.');
                    }
                }
            });

            // Form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                errorDiv.classList.remove('show');

                // Check honeypot
                const honeypot = document.getElementById('company_fax').value;
                if (honeypot) {
                    formContainer.style.display = 'none';
                    successContainer.style.display = 'block';
                    return;
                }

                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const website = document.getElementById('website').value.trim();

                const ADMIN_EMAILS = ['scscot@gmail.com', 'rparr@executionists.com'];
                const isAdmin = ADMIN_EMAILS.includes(email.toLowerCase());

                if (!isAdmin) {
                    const rateCheck = checkRateLimit();
                    if (!rateCheck.allowed) {
                        showError('Too many requests. Please try again tomorrow.');
                        return;
                    }
                }

                if (!name || !email || !website) {
                    showError('Please fill in all fields.');
                    return;
                }

                const emailInput = document.getElementById('email');
                const emailValidation = isValidEmail(email);
                if (!emailValidation.valid) {
                    showError(emailValidation.reason);
                    emailInput.focus();
                    emailInput.select();
                    return;
                }

                // Show loading state on button only (don't switch containers yet)
                submitBtn.disabled = true;
                submitBtn.classList.add('loading');

                try {
                    // Submit form data (no practice areas - AI will detect them)
                    const response = await fetchWithTimeout(SUBMIT_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, website })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        // Check if a demo already exists for this website (409 Conflict)
                        if (response.status === 409 && data.existingLeadId) {
                            // Redirect to existing demo
                            window.location.href = `/?demo=${data.existingLeadId}`;
                            return;
                        }
                        // Check if this is a law firm validation error (400 status)
                        if (response.status === 400 && data.error && data.error.includes('law firm')) {
                            showValidationErrorModal(website, data.error);
                            submitBtn.disabled = false;
                            submitBtn.classList.remove('loading');
                            return;
                        }
                        if (data.field === 'email') {
                            emailInput.focus();
                            emailInput.select();
                        }
                        throw new Error(data.error || 'Something went wrong. Please try again.');
                    }

                    currentLeadId = data.leadId;

                    // NEW UNIFIED FLOW: Auto-confirm and wait for demo ready
                    if (data.status === 'processing') {
                        // Show progress UI and poll for demo completion
                        formContainer.style.display = 'none';
                        setWebsiteProgressLabels(); // Ensure website-specific step labels
                        progressContainer.style.display = 'block';
                        updateProgressStep(0); // Start at validating
                        recordSubmission(); // Record for rate limiting
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('loading');

                        try {
                            const result = await pollForAutoConfirmedDemo(currentLeadId);

                            // Show "Check your email" screen
                            progressContainer.style.display = 'none';
                            document.getElementById('verification-email').textContent = data.email;
                            verificationContainer.style.display = 'block';

                            // Update the verification message for unified flow
                            const checkEmailMsg = verificationContainer.querySelector('.check-email');
                            if (checkEmailMsg) {
                                checkEmailMsg.textContent = 'Click the link in the email to see your personalized AI intake demo.';
                            }
                            const expireMsg = verificationContainer.querySelector('p[style*="font-size: 0.85rem"]');
                            if (expireMsg && !expireMsg.querySelector('a')) {
                                expireMsg.textContent = 'Your demo link is ready. Check your inbox (or spam folder).';
                            }
                        } catch (pollError) {
                            // Show timeout/error message but still tell them to check email
                            progressContainer.style.display = 'none';
                            document.getElementById('verification-email').textContent = data.email;
                            verificationContainer.style.display = 'block';

                            const checkEmailMsg = verificationContainer.querySelector('.check-email');
                            if (checkEmailMsg) {
                                checkEmailMsg.textContent = 'Your demo is taking a bit longer. You\'ll receive an email when it\'s ready.';
                            }
                        }
                        return;
                    }

                    // Check if verification is required (legacy flow - kept for backward compatibility)
                    if (data.requiresVerification) {
                        // Show verification pending screen directly (no analyzing spinner flash)
                        formContainer.style.display = 'none';
                        document.getElementById('verification-email').textContent = data.email;
                        verificationContainer.style.display = 'block';
                        recordSubmission(); // Record for rate limiting
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('loading');
                        return;
                    }

                    // Legacy flow: Show analyzing and poll for results (if email already verified)
                    formContainer.style.display = 'none';
                    analyzingContainer.style.display = 'block';
                    updateAnalysisStep(0);

                    const analysisResult = await pollForAnalysis(currentLeadId);

                    // Populate practice areas from analysis
                    practiceAreas = analysisResult.practiceAreas || [];
                    primaryArea = analysisResult.primaryArea || practiceAreas[0] || null;

                    // Render tags and show modal
                    renderPracticeTags();
                    updateConfirmButton();
                    showModal();

                } catch (error) {
                    showError(error.message || 'Something went wrong. Please try again.');
                    analyzingContainer.style.display = 'none';
                    progressContainer.style.display = 'none';
                    formContainer.style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                }
            });

            // Helper to show errors on hosted form
            function showHostedError(message) {
                hostedErrorDiv.textContent = message;
                hostedErrorDiv.classList.add('show');
            }

            // Hosted Form submission (no website required)
            hostedForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                hostedErrorDiv.classList.remove('show');

                // Check honeypot
                const honeypot = document.getElementById('hosted_company_fax').value;
                if (honeypot) {
                    hostedFormContainer.style.display = 'none';
                    successContainer.style.display = 'block';
                    return;
                }

                const name = document.getElementById('hosted-name').value.trim();
                const email = document.getElementById('hosted-email').value.trim();
                const firmNameInput = document.getElementById('hosted-firm-name').value.trim();
                // Default firm name to user's name if not provided (e.g., "Jane Smith, Attorney at Law")
                const firmName = firmNameInput || `${name}, Attorney at Law`;
                const phone = document.getElementById('hosted-phone').value.trim();
                const state = document.getElementById('hosted-state').value;
                const practiceAreaSelect = document.getElementById('hosted-practice-area');
                const practiceAreas = Array.from(practiceAreaSelect.selectedOptions).map(opt => opt.value);

                const ADMIN_EMAILS = ['scscot@gmail.com', 'rparr@executionists.com'];
                const isAdmin = ADMIN_EMAILS.includes(email.toLowerCase());

                if (!isAdmin) {
                    const rateCheck = checkRateLimit();
                    if (!rateCheck.allowed) {
                        showHostedError('Too many requests. Please try again tomorrow.');
                        return;
                    }
                }

                if (!name || !email || !state || practiceAreas.length === 0) {
                    showHostedError('Please fill in all required fields, select your state, and select at least one practice area.');
                    return;
                }

                const emailValidation = isValidEmail(email);
                if (!emailValidation.valid) {
                    showHostedError(emailValidation.reason);
                    document.getElementById('hosted-email').focus();
                    document.getElementById('hosted-email').select();
                    return;
                }

                // Show loading state
                hostedSubmitBtn.disabled = true;
                hostedSubmitBtn.classList.add('loading');

                try {
                    // Submit form data with hosted flag (no website)
                    const requestBody = {
                        name,
                        email,
                        firmName,
                        phone: phone || null,
                        state,
                        practiceAreas,
                        primaryArea: practiceAreas[0],
                        hosted: true  // Flag to indicate hosted solution (no website)
                    };

                    const response = await fetchWithTimeout(SUBMIT_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        // Check if a demo already exists for this email (409 Conflict)
                        if (response.status === 409 && data.existingLeadId) {
                            window.location.href = `/?demo=${data.existingLeadId}`;
                            return;
                        }
                        if (data.field === 'email') {
                            document.getElementById('hosted-email').focus();
                            document.getElementById('hosted-email').select();
                        }
                        throw new Error(data.error || 'Something went wrong. Please try again.');
                    }

                    currentLeadId = data.leadId;

                    // Show progress UI and poll for demo completion
                    hostedFormContainer.style.display = 'none';
                    setHostedProgressLabels(); // Use hosted-specific step labels
                    progressContainer.style.display = 'block';
                    updateProgressStep(0);
                    recordSubmission();
                    hostedSubmitBtn.disabled = false;
                    hostedSubmitBtn.classList.remove('loading');

                    try {
                        const result = await pollForAutoConfirmedDemo(currentLeadId);

                        // Show "Check your email" screen
                        progressContainer.style.display = 'none';
                        document.getElementById('verification-email').textContent = data.email;
                        verificationContainer.style.display = 'block';

                        const checkEmailMsg = verificationContainer.querySelector('.check-email');
                        if (checkEmailMsg) {
                            checkEmailMsg.textContent = 'Click the link in the email to see your personalized AI intake demo.';
                        }
                        const expireMsg = verificationContainer.querySelector('p[style*="font-size: 0.85rem"]');
                        if (expireMsg && !expireMsg.querySelector('a')) {
                            expireMsg.textContent = 'Your demo link is ready. Check your inbox (or spam folder).';
                        }
                    } catch (pollError) {
                        progressContainer.style.display = 'none';
                        document.getElementById('verification-email').textContent = data.email;
                        verificationContainer.style.display = 'block';

                        const checkEmailMsg = verificationContainer.querySelector('.check-email');
                        if (checkEmailMsg) {
                            checkEmailMsg.textContent = 'Your demo is taking a bit longer. You\'ll receive an email when it\'s ready.';
                        }
                    }

                } catch (error) {
                    showHostedError(error.message || 'Something went wrong. Please try again.');
                    progressContainer.style.display = 'none';
                    hostedFormContainer.style.display = 'block';
                    hostedSubmitBtn.disabled = false;
                    hostedSubmitBtn.classList.remove('loading');
                }
            });

            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
            }

            // =====================================
            // Verification Token Detection
            // =====================================
            // Check if user arrived via email verification link
            async function checkVerificationToken() {
                const urlParams = new URLSearchParams(window.location.search);
                const verifyToken = urlParams.get('verify');

                if (!verifyToken) return;

                // Clean URL without refreshing page
                window.history.replaceState({}, document.title, window.location.pathname);

                // Show analyzing state while we verify
                formContainer.style.display = 'none';
                analyzingContainer.style.display = 'block';
                updateAnalysisStep(0);

                // Scroll to the analyzing container (which is now visible)
                // Note: Can't scroll to demo-form-container since it's hidden
                analyzingContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Track when we started showing the analyzing state
                const startTime = Date.now();
                const MIN_DISPLAY_TIME = 3000; // Show analyzing for at least 3 seconds

                try {
                    // Call verification endpoint
                    const response = await fetchWithTimeout(`${VERIFY_ENDPOINT}?token=${verifyToken}`);
                    const data = await response.json();

                    if (!response.ok) {
                        if (response.status === 410 && data.expired) {
                            throw new Error('Your verification link has expired. Please submit a new demo request.');
                        } else if (response.status === 404) {
                            throw new Error('Invalid verification link. Please submit a new demo request.');
                        }
                        throw new Error(data.error || 'Verification failed. Please try again.');
                    }

                    // If demo is already ready, redirect immediately
                    if (data.demoReady && data.demoUrl) {
                        window.location.href = data.demoUrl;
                        return;
                    }

                    // Email verified successfully!
                    currentLeadId = data.leadId;

                    // Poll for analysis results
                    const analysisResult = await pollForAnalysis(currentLeadId);

                    // Ensure minimum display time before showing modal
                    const elapsed = Date.now() - startTime;
                    if (elapsed < MIN_DISPLAY_TIME) {
                        await new Promise(resolve => setTimeout(resolve, MIN_DISPLAY_TIME - elapsed));
                    }

                    // Populate practice areas from analysis
                    practiceAreas = analysisResult.practiceAreas || [];
                    primaryArea = analysisResult.primaryArea || practiceAreas[0] || null;

                    // Render tags and show modal
                    renderPracticeTags();
                    updateConfirmButton();
                    showModal();

                } catch (error) {
                    showError(error.message || 'Verification failed. Please try again.');
                    analyzingContainer.style.display = 'none';
                    formContainer.style.display = 'block';
                }
            }

            // =====================================
            // Firm Name Display (?firm= parameter)
            // =====================================
            // For visitors arriving from email campaign WITHOUT pre-generated demo
            function checkFirmParameter() {
                const urlParams = new URLSearchParams(window.location.search);
                const firmName = urlParams.get('firm');

                if (!firmName) return false;

                // Clean URL without refreshing page (remove ?firm= but keep at top of page)
                window.history.replaceState({}, document.title, window.location.pathname);

                // Show personalized welcome banner with firm name
                const welcomeBanner = document.getElementById('campaign-welcome');
                const firmNameSpan = document.getElementById('campaign-firm-name');
                if (welcomeBanner && firmNameSpan) {
                    firmNameSpan.textContent = decodeURIComponent(firmName);
                    welcomeBanner.classList.add('visible');
                }

                // Keep default CTA visible ("Create Your Custom Demo")
                // No changes to hero CTAs needed

                return true; // Handled firm parameter
            }

            // =====================================
            // Completed Demo Handler (?completed= parameter)
            // =====================================
            // For visitors returning from a completed demo intake
            // Shows welcome banner, sets up Get Started buttons, hides demo form
            function handleCompletedDemo() {
                const urlParams = new URLSearchParams(window.location.search);
                const leadId = urlParams.get('completed');
                const firmName = urlParams.get('firm');

                if (!leadId) return false;

                // Clean URL without refreshing page
                window.history.replaceState({}, document.title, window.location.pathname);

                // Show personalized welcome banner with firm name
                if (firmName) {
                    const welcomeBanner = document.getElementById('campaign-welcome');
                    const firmNameSpan = document.getElementById('campaign-firm-name');
                    if (welcomeBanner && firmNameSpan) {
                        firmNameSpan.textContent = decodeURIComponent(firmName);
                        welcomeBanner.classList.add('visible');
                    }
                }

                // Hide the demo request form (they already completed a demo)
                const demoSection = document.getElementById('demo');
                if (demoSection) {
                    demoSection.style.display = 'none';
                }

                // Show and configure the pricing section "Get Started" button
                const pricingCtaContainer = document.getElementById('pricing-cta-container');
                const pricingGetStartedBtn = document.getElementById('pricing-get-started-btn');
                if (pricingCtaContainer && pricingGetStartedBtn) {
                    pricingGetStartedBtn.href = `/create-account.html?firm=${leadId}`;
                    pricingCtaContainer.style.display = 'block';
                }

                // Setup floating buttons for "Get Started" and "View Demo Again"
                const floatingButtons = document.getElementById('floating-demo-buttons');
                const getStartedBtn = document.getElementById('get-started-btn');
                const viewDemoBtn = document.getElementById('view-demo-btn');

                if (floatingButtons && getStartedBtn && viewDemoBtn) {
                    getStartedBtn.href = `/create-account.html?firm=${leadId}`;
                    viewDemoBtn.textContent = 'View Demo Again';
                    viewDemoBtn.href = '#';
                    viewDemoBtn.onclick = (e) => {
                        e.preventDefault();
                        // Redirect back to demo
                        window.location.href = `/?demo=${leadId}&firm=${encodeURIComponent(firmName || '')}`;
                    };
                    floatingButtons.classList.add('visible');
                }

                // Update sticky CTA to link to create account
                const stickyCta = document.getElementById('sticky-cta');
                if (stickyCta) {
                    stickyCta.href = `/create-account.html?firm=${leadId}`;
                    stickyCta.textContent = 'Get Started ‚Üí';
                }

                // Hide the "Create Your Custom Demo" hero CTA
                const defaultHeroCta = document.getElementById('default-hero-cta');
                if (defaultHeroCta) {
                    defaultHeroCta.style.display = 'none';
                }

                return true;
            }

            // =====================================
            // Campaign Demo Detection (?demo= parameter)
            // =====================================
            // For visitors arriving from email campaign with pre-generated demo
            // Opens demo in a full-screen modal overlay
            // If user already has a subscription, shows "Account Active" modal instead
            async function checkCampaignDemo() {
                const urlParams = new URLSearchParams(window.location.search);
                const demoLeadId = urlParams.get('demo');
                const firmNameFromUrl = urlParams.get('firm');
                const autoOpen = urlParams.get('autoopen') === 'true';

                if (!demoLeadId) return false;

                const STATUS_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/getPreIntakeFirmStatus';
                const TRACK_ENDPOINT = 'https://us-west1-teambuilder-plus-fe74d.cloudfunctions.net/trackDemoView';

                // Track visit first (before any checks)
                fetch(`${TRACK_ENDPOINT}?firmId=${demoLeadId}&type=visit`).catch(() => {});

                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);

                // Show firm name welcome banner IMMEDIATELY (before async API calls)
                const welcomeBanner = document.getElementById('campaign-welcome');
                const firmNameSpan = document.getElementById('campaign-firm-name');
                if (firmNameFromUrl) {
                    firmNameSpan.textContent = decodeURIComponent(firmNameFromUrl);
                    welcomeBanner.classList.add('visible');
                }

                // Construct demo URL (embed=true hides sidebar CTA; firm name is embedded in demo config)
                const demoUrl = `https://preintake.ai/demo/${demoLeadId}?embed=true`;

                // Setup modal elements IMMEDIATELY (before status check)
                const modal = document.getElementById('demo-modal');
                const iframe = document.getElementById('demo-modal-iframe');
                const closeBtn = document.getElementById('demo-modal-close');
                const floatingButtons = document.getElementById('floating-demo-buttons');
                const getStartedBtn = document.getElementById('get-started-btn');
                const viewDemoBtn = document.getElementById('view-demo-btn');

                // Configure modal and buttons
                getStartedBtn.href = `/create-account.html?firm=${demoLeadId}`;

                // Hide the demo request form for ?demo= visitors (they already have a demo)
                const demoSection = document.getElementById('demo');
                if (demoSection) {
                    demoSection.style.display = 'none';
                }

                // Show and configure the pricing section "Get Started" button
                const pricingCtaContainer = document.getElementById('pricing-cta-container');
                const pricingGetStartedBtn = document.getElementById('pricing-get-started-btn');
                if (pricingCtaContainer && pricingGetStartedBtn) {
                    pricingGetStartedBtn.href = `/create-account.html?firm=${demoLeadId}`;
                    pricingCtaContainer.style.display = 'block';
                }

                // Modify the header "Demo" link to open the demo modal instead
                const navDemoLink = document.getElementById('nav-demo-link');
                if (navDemoLink) {
                    navDemoLink.textContent = 'View Demo';
                    navDemoLink.href = '#';
                    navDemoLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        openDemoModal();
                    });
                }

                // Open modal function
                function openDemoModal() {
                    // Reload iframe fresh each time (add timestamp to bust cache)
                    iframe.src = demoUrl + (demoUrl.includes('?') ? '&' : '?') + '_t=' + Date.now();
                    modal.classList.add('show');
                    floatingButtons.classList.remove('visible');
                    document.body.style.overflow = 'hidden';
                    // Note: "view" is tracked when user clicks "Start Demo" in the iframe
                    // (via postMessage from demo template)
                }

                // Track demo state for exit confirmation
                let demoIntakeCompleted = false;
                let demoFirmEmail = '';

                // Listen for messages from iframe
                window.addEventListener('message', function(e) {
                    // Demo started - user clicked "Start Demo"
                    if (e.data?.type === 'demo-started' && e.data?.firmId === demoLeadId) {
                        // Track actual demo view (user engaged with demo)
                        fetch(`${TRACK_ENDPOINT}?firmId=${demoLeadId}&type=view`).catch(() => {});
                        sessionStorage.setItem('tbp_demo_viewed', demoLeadId);

                        // Update header button to "Get Started" dynamically
                        const accountBtn = document.querySelector('.nav-account');
                        if (accountBtn) {
                            accountBtn.href = `/create-account.html?firm=${demoLeadId}`;
                            accountBtn.textContent = 'Get Started ‚Üí';
                            accountBtn.classList.add('nav-get-started');
                        }

                        // Store firm email for exit confirmation modal
                        if (e.data.firmEmail) {
                            demoFirmEmail = e.data.firmEmail;
                        }
                    }
                    // Intake completed - user finished the conversation and email was sent
                    if (e.data?.type === 'intake-completed' && e.data?.firmId === demoLeadId) {
                        demoIntakeCompleted = true;
                    }
                    // Demo complete - user clicked OK on success modal, redirect to homepage
                    if (e.data?.type === 'demo-complete-redirect' && e.data?.firmId === demoLeadId) {
                        // Close modal first, then redirect parent window
                        forceCloseDemoModal();
                        window.location.href = e.data.redirectUrl || '/';
                    }
                });

                // Exit confirmation modal elements
                const exitConfirmModal = document.getElementById('exit-confirm-modal');
                const exitConfirmEmail = document.getElementById('exit-confirm-email');
                const exitConfirmContinue = document.getElementById('exit-confirm-continue');
                const exitConfirmEnd = document.getElementById('exit-confirm-end');

                // Show exit confirmation modal
                function showExitConfirmModal() {
                    exitConfirmEmail.textContent = demoFirmEmail || 'your email';
                    exitConfirmModal.classList.add('show');
                }

                // Hide exit confirmation modal
                function hideExitConfirmModal() {
                    exitConfirmModal.classList.remove('show');
                }

                // Continue demo button - just close confirmation modal
                exitConfirmContinue.addEventListener('click', hideExitConfirmModal);

                // End demo anyway button - close both modals
                exitConfirmEnd.addEventListener('click', function() {
                    hideExitConfirmModal();
                    forceCloseDemoModal();
                });

                // Close modal function (with confirmation check)
                function closeDemoModal() {
                    // If intake not completed, show confirmation modal
                    if (!demoIntakeCompleted && demoFirmEmail) {
                        showExitConfirmModal();
                        return;
                    }
                    forceCloseDemoModal();
                }

                // Force close demo modal (bypass confirmation)
                function forceCloseDemoModal() {
                    modal.classList.remove('show');
                    floatingButtons.classList.add('visible');
                    document.body.style.overflow = '';
                    // Clear iframe to stop any ongoing processes
                    iframe.src = 'about:blank';
                    // Reset completion state for next demo view
                    demoIntakeCompleted = false;
                    // Hide hero CTA since demo was viewed
                    const defaultHeroCta = document.getElementById('default-hero-cta');
                    if (defaultHeroCta) {
                        defaultHeroCta.style.display = 'none';
                    }
                }

                // "End Demo" closes modal (with confirmation)
                closeBtn.addEventListener('click', closeDemoModal);

                // "View Demo" floating button reopens modal
                viewDemoBtn.addEventListener('click', openDemoModal);

                // Close on escape key (with confirmation)
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        // First check if exit confirm modal is open
                        if (exitConfirmModal.classList.contains('show')) {
                            hideExitConfirmModal();
                        } else if (modal.classList.contains('show')) {
                            closeDemoModal();
                        }
                    }
                });

                // Close on overlay click (outside iframe container) - with confirmation
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeDemoModal();
                    }
                });

                // Hide sticky CTA for campaign visitors
                const stickyCta = document.getElementById('sticky-cta');
                if (stickyCta) {
                    stickyCta.style.display = 'none';
                }

                // Change hero CTA to "Begin Your Custom Demo" and wire it to open modal
                const defaultHeroCta = document.getElementById('default-hero-cta');
                if (defaultHeroCta) {
                    // Update button text (keep arrow icon)
                    defaultHeroCta.innerHTML = `
                        Begin Your Custom Demo
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                    `;
                    // Change href and add click handler to open modal
                    defaultHeroCta.href = '#';
                    defaultHeroCta.addEventListener('click', (e) => {
                        e.preventDefault();
                        openDemoModal();
                    });
                }

                // Hide campaign hero CTA (using modified default CTA instead)
                const campaignHeroCta = document.getElementById('campaign-hero-cta');
                if (campaignHeroCta) {
                    campaignHeroCta.style.display = 'none';
                }

                // Auto-open modal if ?autoopen=true (from "View Demo Again" button)
                // Otherwise let user click the hero CTA to start demo
                if (autoOpen) {
                    openDemoModal();
                }

                // Check subscription status in background (non-blocking)
                // If they have an active subscription, close demo and show Account Active modal
                fetch(`${STATUS_ENDPOINT}?leadId=${demoLeadId}`)
                    .then(response => response.ok ? response.json() : null)
                    .then(statusData => {
                        // Only show account active modal if we got valid data AND they have a subscription
                        if (statusData && statusData.subscriptionStatus) {
                            // They have a subscription - close demo modal and show account active
                            closeDemoModal();
                            showAccountActiveModal(statusData);
                        }
                    })
                    .catch(err => {
                        // Status check failed - keep showing demo (fail open)
                        console.warn('Status check failed:', err);
                    });

                return true;
            }

            // Show Account Already Active modal for subscribers
            function showAccountActiveModal(statusData) {
                const modal = document.getElementById('account-active-modal');
                const firmNameEl = document.getElementById('account-active-firm-name');
                const statusEl = document.getElementById('account-active-status');
                const emailEl = document.getElementById('account-active-email');
                const closeBtn = document.getElementById('account-active-close-btn');

                // Populate modal with firm data
                firmNameEl.textContent = statusData.firmName || 'Your Firm';

                // Format subscription status for display
                const statusMap = {
                    'active': 'Active',
                    'cancelled': 'Cancelled',
                    'past_due': 'Past Due',
                    'unpaid': 'Unpaid',
                    'trialing': 'Trial',
                    'incomplete': 'Incomplete',
                    'incomplete_expired': 'Expired'
                };
                statusEl.textContent = statusMap[statusData.subscriptionStatus] || statusData.subscriptionStatus || 'Active';

                // Mask email for privacy (show first 3 chars and domain)
                if (statusData.deliveryEmail) {
                    const email = statusData.deliveryEmail;
                    const atIndex = email.indexOf('@');
                    if (atIndex > 3) {
                        emailEl.textContent = email.substring(0, 3) + '***' + email.substring(atIndex);
                    } else {
                        emailEl.textContent = email;
                    }
                } else {
                    emailEl.textContent = '(configured)';
                }

                // Show modal
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';

                // Hide sticky CTA
                const stickyCta = document.getElementById('sticky-cta');
                if (stickyCta) {
                    stickyCta.style.display = 'none';
                }

                // Hide demo section
                const demoSection = document.getElementById('demo');
                if (demoSection) {
                    demoSection.style.display = 'none';
                }

                // Close modal handler
                function closeAccountActiveModal() {
                    modal.classList.remove('show');
                    document.body.style.overflow = '';
                }

                closeBtn.addEventListener('click', closeAccountActiveModal);

                // Close on escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && modal.classList.contains('show')) {
                        closeAccountActiveModal();
                    }
                });

                // Close on overlay click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeAccountActiveModal();
                    }
                });
            }

            // Check for ?demo= parameter first (pre-generated demo modal)
            // Then check for ?completed= parameter (returned from completed demo)
            // Then check for ?firm= parameter (just welcome banner, no demo)
            // Finally check for verification token
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('demo')) {
                // ?demo= takes priority - open demo modal
                checkCampaignDemo().then(handled => {
                    if (!handled) {
                        checkVerificationToken();
                    }
                });
            } else if (urlParams.get('completed')) {
                // ?completed= - user returned from completed demo intake
                // Show welcome banner, set up Get Started buttons, hide demo form
                handleCompletedDemo();
            } else if (urlParams.get('firm')) {
                // ?firm= only (no demo) - just show welcome banner
                checkFirmParameter();
                checkVerificationToken();
            } else {
                // No special parameters - check verification token
                checkVerificationToken();

                // Check if user has previously viewed a demo in this session
                checkPreviouslyViewedDemo();
            }
        });

        // =====================================
        // Previously Viewed Demo Handler
        // =====================================
        // For users returning to homepage after viewing a demo
        // Hides hero CTA and shows floating buttons with correct links
        function checkPreviouslyViewedDemo() {
            const viewedDemoId = sessionStorage.getItem('tbp_demo_viewed');
            if (!viewedDemoId) return;

            // Hide the "Create Your Custom Demo" hero CTA
            const defaultHeroCta = document.getElementById('default-hero-cta');
            if (defaultHeroCta) {
                defaultHeroCta.style.display = 'none';
            }

            // Show floating buttons with correct demo link
            const floatingButtons = document.getElementById('floating-demo-buttons');
            const getStartedBtn = document.getElementById('get-started-btn');
            const viewDemoBtn = document.getElementById('view-demo-btn');

            if (floatingButtons && getStartedBtn && viewDemoBtn) {
                getStartedBtn.href = `/create-account.html?firm=${viewedDemoId}`;
                viewDemoBtn.textContent = 'View Demo Again';
                viewDemoBtn.href = `/?demo=${viewedDemoId}`;
                floatingButtons.classList.add('visible');
            }
        }

        // Validation error modal functions
        function showValidationErrorModal(url, errorMessage) {
            const modal = document.getElementById('validation-error-modal');
            const messageEl = document.getElementById('validation-error-message');
            messageEl.innerHTML = `Our AI analysis of <strong>${url}</strong> has determined it is not a law firm or attorney website.<br><br>PreIntake.ai is designed exclusively for legal professionals. Please enter a valid law firm website URL.`;
            modal.classList.add('show');
        }

        function closeValidationModal() {
            const modal = document.getElementById('validation-error-modal');
            modal.classList.remove('show');
        }
    </script>

    <!-- Transcript Toggle -->
    <script>
        function toggleTranscript(transcriptId, linkElement) {
            const transcript = document.getElementById(transcriptId);
            if (transcript.classList.contains('expanded')) {
                transcript.classList.remove('expanded');
                linkElement.textContent = 'View Full Transcript ‚Üí';
            } else {
                transcript.classList.add('expanded');
                linkElement.textContent = 'Hide Transcript ‚Üë';
            }
        }
    </script>

    <!-- Sticky CTA Button -->
    <a href="#demo" class="sticky-cta" id="sticky-cta">See It In Action ‚Üí</a>
    <script>
        (function() {
            const stickyCta = document.getElementById('sticky-cta');
            const hero = document.getElementById('hero');
            const demoSection = document.getElementById('demo');

            function updateStickyVisibility() {
                const heroBottom = hero.getBoundingClientRect().bottom;
                const demoTop = demoSection.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                // Show when scrolled past hero, hide when demo section enters viewport
                if (heroBottom < 0 && demoTop > windowHeight) {
                    stickyCta.classList.add('visible');
                } else {
                    stickyCta.classList.remove('visible');
                }
            }

            // Smooth scroll to demo section
            stickyCta.addEventListener('click', function(e) {
                e.preventDefault();
                demoSection.scrollIntoView({ behavior: 'smooth' });
            });

            window.addEventListener('scroll', updateStickyVisibility, { passive: true });
            updateStickyVisibility();
        })();
    </script>

    <!-- Campaign Demo Modal (for ?demo= visitors) -->
    <div class="demo-modal-overlay" id="demo-modal">
        <div class="demo-modal-container">
            <button class="demo-modal-close" id="demo-modal-close">
                End Demo
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="demo-modal-iframe-wrapper">
                <iframe class="demo-modal-iframe" id="demo-modal-iframe" src="" title="PreIntake Demo"></iframe>
            </div>
        </div>
    </div>

    <!-- Floating Buttons (shown after demo modal closes) -->
    <div class="floating-demo-buttons" id="floating-demo-buttons">
        <a href="#" class="get-started-btn" id="get-started-btn">
            Get Started
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
        </a>
        <button class="view-demo-btn" id="view-demo-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            View Demo
        </button>
    </div>

    <!-- Account Already Active Modal (for subscribers who visit demo URL) -->
    <div class="account-active-modal-overlay" id="account-active-modal">
        <div class="account-active-modal">
            <div class="account-active-modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <h2>Your Account is Active</h2>
            <p>Good news! Your PreIntake.ai subscription is already set up and delivering leads to your team.</p>
            <div class="account-active-modal-details">
                <div class="account-active-modal-details-row">
                    <span class="account-active-modal-details-label">Firm</span>
                    <span class="account-active-modal-details-value" id="account-active-firm-name">‚Äî</span>
                </div>
                <div class="account-active-modal-details-row">
                    <span class="account-active-modal-details-label">Status</span>
                    <span class="account-active-modal-details-value" id="account-active-status">Active</span>
                </div>
                <div class="account-active-modal-details-row">
                    <span class="account-active-modal-details-label">Leads delivered to</span>
                    <span class="account-active-modal-details-value" id="account-active-email">‚Äî</span>
                </div>
            </div>
            <button class="account-active-modal-btn" id="account-active-close-btn">
                Got It
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </button>
            <p class="account-active-modal-contact">
                Need help? <a href="mailto:support@preintake.ai">Contact support</a>
            </p>
        </div>
    </div>

    <!-- Exit Confirmation Modal (shown when user tries to end demo before completing intake) -->
    <div class="exit-confirm-modal-overlay" id="exit-confirm-modal">
        <div class="exit-confirm-modal">
            <div class="exit-confirm-modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h2>Complete the Demo?</h2>
            <p>To see the full value of PreIntake.ai, complete the intake conversation. You'll receive a sample lead notification at:</p>
            <p class="exit-confirm-modal-email" id="exit-confirm-email">‚Äî</p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">This shows exactly what your team receives for every inquiry.</p>
            <div class="exit-confirm-modal-buttons">
                <button class="exit-confirm-btn-continue" id="exit-confirm-continue">
                    Continue Demo
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>
                <button class="exit-confirm-btn-end" id="exit-confirm-end">
                    End Demo Anyway
                </button>
            </div>
        </div>
    </div>
</body>
</html>
