<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test reCAPTCHA Token - Fixed</title>
    <script
        src="https://www.google.com/recaptcha/enterprise.js?render=6Lfwj5orAAAAADS--lFfBYWuz1b4LiQVUlOHZiyE"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }

        .token-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #dee2e6;
        }

        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .copy-btn {
            background: #28a745;
        }

        .copy-btn:hover {
            background: #1e7e34;
        }

        .error {
            color: #721c24;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        .loading {
            color: #856404;
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>

<body>
    <h1>reCAPTCHA Token Generator</h1>
    <p>This page helps you generate reCAPTCHA tokens for testing the assessment API.</p>

    <button id="generateBtn" onclick="generateToken()">Generate Token</button>
    <button id="copyBtn" class="copy-btn" onclick="copyToken()" style="display:none;">Copy Token</button>

    <div id="status" style="display:none;"></div>

    <div id="tokenDisplay" class="token-display" style="display:none;">
        <strong>Generated Token:</strong>
        <div id="tokenValue"></div>
    </div>

    <div id="usageInstructions" style="display:none;">
        <h3>Usage Instructions:</h3>
        <p>To test the reCAPTCHA assessment, use this command:</p>
        <code id="commandExample"
            style="background: #f8f9fa; padding: 10px; display: block; border-radius: 3px; font-family: monospace;"></code>
    </div>

    <script>
        let currentToken = '';

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = type;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        function generateToken() {
            const generateBtn = document.getElementById('generateBtn');
            const copyBtn = document.getElementById('copyBtn');

            // Reset UI
            hideStatus();
            document.getElementById('tokenDisplay').style.display = 'none';
            document.getElementById('usageInstructions').style.display = 'none';
            copyBtn.style.display = 'none';

            // Check if reCAPTCHA is available
            if (typeof grecaptcha === 'undefined') {
                showStatus('reCAPTCHA not loaded. Please refresh the page.', 'error');
                return;
            }

            // Disable button and show loading
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            showStatus('Generating reCAPTCHA token...', 'loading');

            try {
                // Use the correct reCAPTCHA Enterprise API
                grecaptcha.enterprise.ready(function () {
                    grecaptcha.enterprise.execute('6Lfwj5orAAAAADS--lFfBYWuz1b4LiQVUlOHZiyE', { action: 'submit' })
                        .then(function (token) {
                            currentToken = token;

                            // Update UI
                            document.getElementById('tokenValue').textContent = token;
                            document.getElementById('tokenDisplay').style.display = 'block';
                            copyBtn.style.display = 'inline-block';

                            // Show usage instructions
                            const apiKey = 'AIzaSyD5hsgDvBZO-LRue0-G7fXgef2D-ie9-nQ'; // Your Firebase API key
                            document.getElementById('commandExample').textContent =
                                `./scripts/send_recaptcha_assessment.sh "${token}" "${apiKey}" "submit"`;
                            document.getElementById('usageInstructions').style.display = 'block';

                            showStatus('Token generated successfully!', 'success');

                            // Re-enable button
                            generateBtn.disabled = false;
                            generateBtn.textContent = 'Generate Token';
                        })
                        .catch(function (error) {
                            console.error('Error generating token:', error);
                            showStatus('Error: ' + error.message, 'error');

                            // Re-enable button
                            generateBtn.disabled = false;
                            generateBtn.textContent = 'Generate Token';
                        });
                });
            } catch (error) {
                console.error('Error:', error);
                showStatus('Error: ' + error.message, 'error');

                // Re-enable button
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Token';
            }
        }

        function copyToken() {
            if (currentToken) {
                navigator.clipboard.writeText(currentToken)
                    .then(() => {
                        showStatus('Token copied to clipboard!', 'success');
                        setTimeout(hideStatus, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy token:', err);
                        showStatus('Failed to copy token. Please select and copy manually.', 'error');
                    });
            }
        }

        // Check if reCAPTCHA is loaded on page load
        window.addEventListener('load', function () {
            if (typeof grecaptcha === 'undefined') {
                showStatus('reCAPTCHA Enterprise script failed to load. Please check your internet connection and refresh the page.', 'error');
            }
        });
    </script>
</body>

</html>