<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Build Pro - The Ultimate Team Building Platform</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="https://img.icons8.com/plasticine/100/organization.png" type="image/png">
    
    <!-- Smart App Banner for iOS Safari -->
    <!-- This will be dynamically updated with referral code -->
    <meta name="apple-itunes-app" content="app-id=YOUR_APP_ID">
    
    <!-- Apple Touch Icon for Universal Links -->
    <link rel="apple-touch-icon" href="assets/icons/app_icon.png">

    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            /* slate-50 */
            color: #1e293b;
            /* slate-800 */
        }

        /* Custom gradient for hero and CTA */
        .gradient-bg {
            background-color: #0f172a;
            background-image:
                radial-gradient(at 27% 37%, hsla(215, 98%, 60%, 0.1) 0px, transparent 50%),
                radial-gradient(at 97% 21%, hsla(135, 98%, 60%, 0.1) 0px, transparent 50%),
                radial-gradient(at 75% 80%, hsla(285, 98%, 60%, 0.1) 0px, transparent 50%);
        }

        /* Animation for elements appearing on scroll */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .revealed {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body class="antialiased">

    <!-- Header -->
    <header class="bg-slate-900/70 backdrop-blur-lg sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="assets/icons/app_icon.png" alt="Team Build Pro Logo" class="h-8 w-8 md:h-10 md:w-10">
                <span class="text-lg md:text-2xl font-bold text-white">Team Build Pro</span>
            </div>
            <div class="hidden md:flex items-center space-x-4">
                <a href="#features" class="text-slate-300 hover:text-white transition-colors">Features</a>
                <a href="#pricing" class="text-slate-300 hover:text-white transition-colors">Pricing</a>
                <a href="#faq" class="text-slate-300 hover:text-white transition-colors">FAQ</a>
            </div>
            <a href="#"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 md:px-5 md:py-2.5 rounded-lg shadow-lg transition-transform transform hover:scale-105 text-sm md:text-base">
                Get Started Free
            </a>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="gradient-bg text-white pt-16 pb-20 md:pt-20 md:pb-24">
            <div class="container mx-auto px-4 text-center">
                <div class="max-w-4xl mx-auto">
                    <span
                        class="inline-block bg-blue-100 text-blue-800 font-semibold px-3 py-1.5 md:px-4 md:py-2 rounded-full text-sm md:text-xl mb-4 mt-4">
                        The #1 Platform for Team Builders
                    </span>
                    <h1 class="text-3xl md:text-6xl font-extrabold leading-tight mb-6">
                        Build Your Foundation. <span class="text-blue-500">Accelerate Your Momentum.</span>
                    </h1>
                    <p class="text-base md:text-xl text-slate-300 max-w-2xl mx-auto mb-8 md:mb-10 px-2">
                        The ultimate app for direct sales professionals to build, manage, and scale your
                        organization with unstoppable momentum.
                    </p>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-3 md:gap-4 px-4">
                        <a href="#"
                            class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-3 md:px-8 md:py-4 rounded-lg shadow-xl transition-transform transform hover:scale-105 text-center">
                            Start Your 30-Day Free Trial
                        </a>
                        <a href="#features"
                            class="w-full sm:w-auto bg-slate-700 hover:bg-slate-600 text-white font-semibold px-6 py-3 md:px-8 md:py-4 rounded-lg transition text-center">
                            Learn More
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-16 sm:py-20 md:py-28">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-2xl mx-auto mb-12 md:mb-16">
                    <h2 class="text-2xl md:text-4xl font-extrabold text-slate-900 px-2">A Smarter Way to Build Your Team</h2>
                    <p class="mt-4 text-base md:text-lg text-slate-600 px-2">Team Build Pro gives you the tools to turn a cold start into
                        a running start.</p>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Feature 1: Build & Grow -->
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200/50 reveal-on-scroll">
                        <div
                            class="bg-blue-100 text-blue-600 w-12 h-12 rounded-full flex items-center justify-center mb-5">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Build & Grow Globally</h3>
                        <p class="text-slate-600">Expand your team worldwide and monitor qualification progress in
                            real-time. Get a powerful head start by pre-building your team.</p>
                    </div>

                    <!-- Feature 2: Powerful Insights -->
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200/50 reveal-on-scroll">
                        <div
                            class="bg-purple-100 text-purple-600 w-12 h-12 rounded-full flex items-center justify-center mb-5">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Powerful Insights</h3>
                        <p class="text-slate-600">Access real-time team analytics and generate comprehensive reports to
                            track growth and monitor key performance metrics instantly.</p>
                    </div>

                    <!-- Feature 3: Secure Communication -->
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200/50 reveal-on-scroll">
                        <div
                            class="bg-emerald-100 text-emerald-600 w-12 h-12 rounded-full flex items-center justify-center mb-5">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Secure Communication</h3>
                        <p class="text-slate-600">Communicate globally with a built-in, secure messaging system. Receive
                            daily team growth updates and milestone notifications.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How it Works Section -->
        <section class="py-16 sm:py-20 md:py-28 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-2xl mx-auto mb-12 md:mb-16">
                    <h2 class="text-2xl md:text-4xl font-extrabold text-slate-900 px-2">A Simple Process for Success</h2>
                    <p class="mt-4 text-base md:text-lg text-slate-600 px-2">Our proven 3-step process helps you build momentum from the
                        very beginning.</p>
                </div>
                <div class="relative">
                    <!-- Dotted line for desktop -->
                    <!-- <div
                        class="hidden lg:block absolute top-1/2 left-0 w-full h-0.5 border-t-2 border-dashed border-slate-300 -translate-y-1/2">
                    </div> -->

                    <div class="grid md:grid-cols-3 gap-12 relative">
                        <!-- Step 1 -->
                        <div class="text-center reveal-on-scroll">
                            <div
                                class="bg-white border-2 border-slate-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 relative z-10">
                                <div
                                    class="bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold">
                                    1</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Invite & Connect</h3>
                            <p class="text-slate-600">Connect with like-minded professionals who are open to exploring
                                your opportunity and invite them to your pre-build network.</p>
                        </div>
                        <!-- Step 2 -->
                        <div class="text-center reveal-on-scroll">
                            <div
                                class="bg-white border-2 border-slate-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 relative z-10">
                                <div
                                    class="bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold">
                                    2</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Cultivate Momentum</h3>
                            <p class="text-slate-600">Foster authentic relationships as your network grows, creating a
                                thriving community of professionals who support each other's success.</p>
                        </div>
                        <!-- Step 3 -->
                        <div class="text-center reveal-on-scroll">
                            <div
                                class="bg-white border-2 border-slate-200 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 relative z-10">
                                <div
                                    class="bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold">
                                    3</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Launch with Success</h3>
                            <p class="text-slate-600">When the time is right, invite your pre-built team to join your
                                official opportunity, turning potential into performance.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="py-16 sm:py-20 md:py-28">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-2xl mx-auto mb-12 md:mb-16">
                    <h2 class="text-2xl md:text-4xl font-extrabold text-slate-900 px-2">Simple, Transparent Pricing</h2>
                    <p class="mt-4 text-base md:text-lg text-slate-600 px-2">One plan, all features. Start your free trial today, no
                        credit card required.</p>
                </div>
                <div class="max-w-md mx-auto bg-white rounded-2xl shadow-2xl border border-slate-200/50 p-8">
                    <h3 class="text-2xl font-bold text-center mb-2">Pro Plan</h3>
                    <p class="text-slate-500 text-center mb-6">Full access to all our premium features.</p>
                    <div class="text-center mb-8">
                        <span class="text-5xl font-extrabold">$4.95</span>
                        <span class="text-slate-500 font-medium">/ month</span>
                    </div>
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-center"><svg class="h-6 w-6 text-emerald-500 mr-3" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>Unlimited Team Members</li>
                        <li class="flex items-center"><svg class="h-6 w-6 text-emerald-500 mr-3" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>Real-time Analytics</li>
                        <li class="flex items-center"><svg class="h-6 w-6 text-emerald-500 mr-3" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>Secure Messaging</li>
                        <li class="flex items-center"><svg class="h-6 w-6 text-emerald-500 mr-3" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>Global Network Building</li>
                        <li class="flex items-center"><svg class="h-6 w-6 text-emerald-500 mr-3" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>24/7 Customer Support</li>
                    </ul>
                    <a href="#"
                        class="w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 block">
                        Start 30-Day Free Trial
                    </a>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="py-16 sm:py-20 md:py-28 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center max-w-2xl mx-auto mb-12 md:mb-16">
                    <h2 class="text-2xl md:text-4xl font-extrabold text-slate-900 px-2">Frequently Asked Questions</h2>
                    <p class="mt-4 text-base md:text-lg text-slate-600 px-2">Have questions? We've got answers. If you have other
                        questions, feel free to reach out.</p>
                </div>
                <div class="max-w-3xl mx-auto space-y-4" x-data="{ open: 0 }">
                    <!-- FAQ Item 1 -->
                    <div class="border border-slate-200 rounded-lg">
                        <button @click="open = (open === 1 ? 0 : 1)"
                            class="w-full flex justify-between items-center text-left p-5 font-semibold">
                            <span>Is Team Build Pro a business opportunity?</span>
                            <svg class="w-5 h-5 transition-transform" :class="{ 'rotate-180': open === 1 }" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div x-show="open === 1" x-transition class="p-5 pt-0 text-slate-600">
                            No. Team Build Pro is not a business opportunity or income platform of any kind. We are a
                            software
                            tool designed exclusively to help professionals build and track their teams. We do not
                            provide any form of user compensation.
                        </div>
                    </div>
                    <!-- FAQ Item 2 -->
                    <div class="border border-slate-200 rounded-lg">
                        <button @click="open = (open === 2 ? 0 : 2)"
                            class="w-full flex justify-between items-center text-left p-5 font-semibold">
                            <span>Who is this platform for?</span>
                            <svg class="w-5 h-5 transition-transform" :class="{ 'rotate-180': open === 2 }" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div x-show="open === 2" x-transition class="p-5 pt-0 text-slate-600">
                            Our platform is perfect for direct sales professionals, affiliate marketers, team leaders,
                            and
                            any entrepreneur looking to build a collaborative organization. Whether you're just starting
                            or you're a seasoned mentor, our tools scale with you.
                        </div>
                    </div>
                    <!-- FAQ Item 3 -->
                    <div class="border border-slate-200 rounded-lg">
                        <button @click="open = (open === 3 ? 0 : 3)"
                            class="w-full flex justify-between items-center text-left p-5 font-semibold">
                            <span>Do I need a credit card for the free trial?</span>
                            <svg class="w-5 h-5 transition-transform" :class="{ 'rotate-180': open === 3 }" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div x-show="open === 3" x-transition class="p-5 pt-0 text-slate-600">
                            No. You can enjoy full access to all premium features for 30 days completely free, with no
                            credit card required to start. You can decide to subscribe at any point during or after your
                            trial.
                        </div>
                    </div>
                    <!-- FAQ Item 4 -->
                    <div class="border border-slate-200 rounded-lg">
                        <button @click="open = (open === 4 ? 0 : 4)"
                            class="w-full flex justify-between items-center text-left p-5 font-semibold">
                            <span>Can I cancel my subscription at any time?</span>
                            <svg class="w-5 h-5 transition-transform" :class="{ 'rotate-180': open === 4 }" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div x-show="open === 4" x-transition class="p-5 pt-0 text-slate-600">
                            Yes. You can cancel your subscription at any time with no long-term commitments or
                            cancellation fees. You will retain access until the end of your current billing period.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="gradient-bg">
            <div class="container mx-auto px-4 py-16 md:py-20 text-center">
                <h2 class="text-2xl md:text-4xl font-extrabold text-white px-2">Ready to Build Your Empire?</h2>
                <p class="mt-4 text-base md:text-lg text-slate-300 max-w-2xl mx-auto mb-8 md:mb-10 px-2">
                    Join thousands of professionals who are building their teams faster than ever before. Start your
                    free 30-day trial today.
                </p>
                <a href="#"
                    class="bg-white hover:bg-slate-200 text-blue-600 font-bold px-6 py-3 md:px-8 md:py-4 rounded-lg shadow-xl transition-transform transform hover:scale-105 inline-block">
                    Claim Your Free Trial
                </a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400">
        <div class="container mx-auto px-4 py-8 text-center">
            <div class="flex justify-center items-center space-x-3 mb-4">
                <img src="assets/icons/app_icon.png" alt="Team Build Pro Logo" class="h-8 w-8">
                <span class="text-xl font-bold text-white">Team Build Pro</span>
            </div>
            <div class="flex flex-wrap justify-center gap-4 md:gap-6 mb-4 text-sm md:text-base">
                <a href="#features" class="hover:text-white transition-colors">Features</a>
                <a href="#pricing" class="hover:text-white transition-colors">Pricing</a>
                <a href="#faq" class="hover:text-white transition-colors">FAQ</a>
                <a href="contact_us.html" class="hover:text-white transition-colors">Contact</a>
                <a href="privacy_policy.html" class="hover:text-white transition-colors">Privacy Policy</a>
                <a href="terms_of_service.html" class="hover:text-white transition-colors">Terms of Service</a>
            </div>
            <p class="text-sm md:text-base">&copy; <span id="currentYear"></span> Team Build Pro. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- AlpineJS for FAQ interactivity -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA45ZN9KUuaYT0OHYZ9DmX2Jc8028Ftcvc",
            authDomain: "teambuilder-plus-fe74d.firebaseapp.com",
            projectId: "teambuilder-plus-fe74d",
            storageBucket: "teambuilder-plus-fe74d.firebasestorage.app",
            messagingSenderId: "312163687148",
            appId: "1:312163687148:web:43385dff773dab0b3763c9",
            measurementId: "G-G4E4TBBPZ7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Function to parse referral code from URL (supports both path and query parameter)
        function getReferralCode() {
            // Handle file:// protocol for local testing
            if (window.location.protocol === 'file:') {
                console.log('Local file detected, no referral code processing');
                return null;
            }

            // First, try to get referral code from query parameter (?ref=code)
            const urlParams = new URLSearchParams(window.location.search);
            const queryRef = urlParams.get('ref');

            if (queryRef && isValidReferralCode(queryRef)) {
                console.log('Found referral code in query parameter:', queryRef);
                return queryRef;
            }

            // Fallback: try to get referral code from URL path (/code)
            const path = window.location.pathname;
            const referralCode = path.substring(1); // Remove leading slash

            // Exclude known pages and common paths from being treated as referral codes
            const excludedPaths = [
                'privacy_policy.html',
                'terms_of_service.html',
                'contact_us.html',
                'index.html',
                '',
                'favicon.ico',
                'robots.txt',
                'sitemap.xml'
            ];

            // Also exclude paths that contain file extensions or are clearly not referral codes
            if (excludedPaths.includes(referralCode) ||
                referralCode.includes('.') ||
                referralCode.includes('/') ||
                !isValidReferralCode(referralCode)) {
                return null;
            }

            console.log('Found referral code in URL path:', referralCode);
            return referralCode;
        }

        // Function to validate referral codes (same validation as our Flutter app)
        function isValidReferralCode(referralCode) {
            if (!referralCode || referralCode.trim().length === 0) {
                return false;
            }

            // Reject codes that are too long (likely file paths)
            if (referralCode.length > 50) {
                console.log('Rejecting overly long referral code');
                return false;
            }

            // Reject codes that are too short
            if (referralCode.length < 3) {
                return false;
            }

            // Reject codes that contain file path indicators
            if (referralCode.includes('/') || referralCode.includes('\\') || referralCode.includes(':')) {
                console.log('Rejecting referral code with path indicators');
                return false;
            }

            // Reject codes that look like file paths or URLs
            if (referralCode.startsWith('file://') || referralCode.startsWith('C:') || referralCode.startsWith('/')) {
                console.log('Rejecting file path referral code');
                return false;
            }

            return true;
        }

        // Function to create and insert invite section
        function createInviteSection(firstName, lastName) {
            const inviteSection = document.createElement('div');
            inviteSection.id = 'invite-section';
            inviteSection.className = 'text-center mb-4 px-2';
            inviteSection.innerHTML = `
                <p class="text-white text-base md:text-xl font-medium">
                    <span class="text-white">Welcome!</span> You were invited by 
                    <span class="font-bold text-white">${firstName} ${lastName}</span>
                </p>
            `;

            // Insert just above "The #1 Platform for Team Builders"
            const heroSection = document.querySelector('.gradient-bg .container .max-w-4xl');
            const platformSpan = heroSection.querySelector('span');
            heroSection.insertBefore(inviteSection, platformSpan);
        }

        // Function to query Firestore for user data
        async function fetchUserByReferralCode(referralCode) {
            try {
                console.log('Fetching user data for referral code:', referralCode);

                // Query by referralCode field instead of document ID
                const querySnapshot = await db.collection('users')
                    .where('referralCode', '==', referralCode)
                    .limit(1)
                    .get();

                if (!querySnapshot.empty) {
                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    const firstName = userData.firstName || '';
                    const lastName = userData.lastName || '';

                    if (firstName && lastName) {
                        console.log('User found:', firstName, lastName);
                        createInviteSection(firstName, lastName);
                        return { firstName, lastName };
                    } else {
                        console.log('User document exists but missing name fields');
                        return null;
                    }
                } else {
                    console.log('No user found with referral code:', referralCode);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                return null;
            }
        }

        // Smart App Banner Functions
        
        // Function to update Smart App Banner with referral code
        function updateSmartAppBanner(referralCode) {
            const appId = 'teambuilder-plus-fe74d'; // Replace with your actual App Store ID
            const metaTag = document.querySelector('meta[name="apple-itunes-app"]');
            
            if (referralCode && referralCode.trim() !== '') {
                // Update the meta tag with the referral code
                const content = `app-id=${appId}, app-argument=teambuildpro://app/?ref=${referralCode}`;
                metaTag.setAttribute('content', content);
                console.log('Smart App Banner updated with referral code:', referralCode);
            } else {
                // Default without referral code
                const content = `app-id=${appId}`;
                metaTag.setAttribute('content', content);
                console.log('Smart App Banner set without referral code');
            }
        }

        // Function to create manual App Store button (fallback for non-Safari browsers)
        function createAppStoreButton(referralCode) {
            const appId = 'teambuilder-plus-fe74d'; // Replace with your actual App Store ID
            const appStoreUrl = `https://apps.apple.com/app/id${appId}`;
            
            // Create button container
            const buttonContainer = document.createElement('div');
            buttonContainer.id = 'app-store-button-container';
            buttonContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 12px;
                text-align: center;
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            `;
            
            // Create message
            const message = document.createElement('span');
            message.style.cssText = `
                font-size: 14px;
                margin-right: 12px;
            `;
            if (referralCode) {
                message.textContent = `Get the Team Build Pro app to join with referral code: ${referralCode}`;
            } else {
                message.textContent = 'Get the Team Build Pro app for the best experience';
            }
            
            // Create download button
            const button = document.createElement('a');
            button.href = appStoreUrl;
            button.target = '_blank';
            button.style.cssText = `
                background: rgba(255,255,255,0.2);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                text-decoration: none;
                font-weight: 600;
                font-size: 14px;
                margin: 0 8px;
                border: 1px solid rgba(255,255,255,0.3);
                transition: all 0.3s ease;
            `;
            button.textContent = 'Download App';
            
            // Add hover effect
            button.addEventListener('mouseenter', () => {
                button.style.background = 'rgba(255,255,255,0.3)';
                button.style.transform = 'translateY(-1px)';
            });
            button.addEventListener('mouseleave', () => {
                button.style.background = 'rgba(255,255,255,0.2)';
                button.style.transform = 'translateY(0)';
            });
            
            // Create close button
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '×';
            closeButton.style.cssText = `
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                position: absolute;
                right: 15px;
                top: 50%;
                transform: translateY(-50%);
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                transition: background 0.3s ease;
            `;
            closeButton.addEventListener('mouseenter', () => {
                closeButton.style.background = 'rgba(255,255,255,0.2)';
            });
            closeButton.addEventListener('mouseleave', () => {
                closeButton.style.background = 'none';
            });
            closeButton.onclick = () => {
                buttonContainer.style.transform = 'translateY(-100%)';
                setTimeout(() => buttonContainer.remove(), 300);
            };
            
            buttonContainer.appendChild(message);
            buttonContainer.appendChild(button);
            buttonContainer.appendChild(closeButton);
            
            // Add slide-in animation
            buttonContainer.style.transform = 'translateY(-100%)';
            buttonContainer.style.transition = 'transform 0.3s ease';
            
            return buttonContainer;
        }

        // Function to detect if running on iOS Safari
        function isIOSSafari() {
            const ua = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(ua);
            const isSafari = /Safari/.test(ua) && !/Chrome|CriOS|FxiOS/.test(ua);
            return isIOS && isSafari;
        }

        // Function to detect if running on mobile device
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Function to initialize app banner
        function initializeAppBanner(referralCode) {
            if (isIOSSafari()) {
                // Use Smart App Banner for iOS Safari
                updateSmartAppBanner(referralCode);
                console.log('Smart App Banner initialized for iOS Safari');
            } else if (isMobileDevice()) {
                // Show manual button for other mobile browsers
                const button = createAppStoreButton(referralCode);
                document.body.insertBefore(button, document.body.firstChild);
                
                // Trigger slide-in animation
                setTimeout(() => {
                    button.style.transform = 'translateY(0)';
                }, 100);
                
                console.log('Manual App Store button created for mobile browser');
            } else {
                console.log('Desktop browser detected, no app banner shown');
            }
        }

        // Main initialization function
        async function initializeReferralSystem() {
            const referralCode = getReferralCode();

            if (referralCode) {
                console.log('Processing referral code:', referralCode);
                const userData = await fetchUserByReferralCode(referralCode);
                
                // Initialize app banner with referral code
                initializeAppBanner(referralCode);
            } else {
                console.log('No referral code found in URL');
                
                // Initialize app banner without referral code
                initializeAppBanner(null);
            }
        }

        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Intersection Observer for scroll animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('revealed');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal-on-scroll').forEach(el => {
            observer.observe(el);
        });

        // Initialize referral system when page loads
        document.addEventListener('DOMContentLoaded', initializeReferralSystem);
    </script>
</body>

</html>